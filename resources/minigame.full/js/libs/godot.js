const createAudioContext = wx.createWebAudioContext;

var Godot=(()=>{var _scriptName="undefined"!=typeof document?document.currentScript?.src:void 0;return function(moduleArg={}){var moduleRtn,readyPromiseResolve,readyPromiseReject,Module=moduleArg,readyPromise=new Promise(((resolve,reject)=>{readyPromiseResolve=resolve,readyPromiseReject=reject}));["_memory","__Z14godot_web_mainiPPc","___indirect_function_table","_main","onRuntimeInitialized"].forEach((prop=>{Object.getOwnPropertyDescriptor(readyPromise,prop)||Object.defineProperty(readyPromise,prop,{get:()=>abort("You are getting "+prop+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>abort("You are setting "+prop+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})}));var readAsync,readBinary,ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="undefined"!=typeof WorkerGlobalScope,ENVIRONMENT_IS_NODE="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node&&"renderer"!=process.type,ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER,moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=(status,toThrow)=>{throw toThrow},scriptDirectory="";if(ENVIRONMENT_IS_SHELL){if("object"==typeof process&&"function"==typeof require||"object"==typeof window||"undefined"!=typeof WorkerGlobalScope)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)")}else{if(!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER)throw new Error("environment detection error");if(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:"undefined"!=typeof document&&document.currentScript&&(scriptDirectory=document.currentScript.src),_scriptName&&(scriptDirectory=_scriptName),scriptDirectory=scriptDirectory.startsWith("blob:")?"":scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1),"object"!=typeof window&&"undefined"==typeof WorkerGlobalScope)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");ENVIRONMENT_IS_WORKER&&(readBinary=url=>{var xhr=new XMLHttpRequest;return xhr.open("GET",url,!1),xhr.responseType="arraybuffer",xhr.send(null),new Uint8Array(xhr.response)}),readAsync=url=>(assert(!isFileURI(url),"readAsync does not work with file:// URLs"),fetch(url,{credentials:"same-origin"}).then((response=>response.ok?response.arrayBuffer():Promise.reject(new Error(response.status+" : "+response.url)))))}var prop,out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,prop="fetchSettings",Object.getOwnPropertyDescriptor(Module,prop)&&abort(`\`Module.${prop}\` was supplied but \`${prop}\` not included in INCOMING_MODULE_JS_API`),Module.arguments&&(arguments_=Module.arguments),legacyModuleProp("arguments","arguments_"),Module.thisProgram&&(thisProgram=Module.thisProgram),legacyModuleProp("thisProgram","thisProgram"),assert(void 0===Module.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),assert(void 0===Module.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),assert(void 0===Module.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),assert(void 0===Module.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),assert(void 0===Module.read,"Module.read option was removed"),assert(void 0===Module.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),assert(void 0===Module.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),assert(void 0===Module.setWindowTitle,"Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),assert(void 0===Module.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),legacyModuleProp("asm","wasmExports"),legacyModuleProp("readAsync","readAsync"),legacyModuleProp("readBinary","readBinary"),legacyModuleProp("setWindowTitle","setWindowTitle"),assert(!ENVIRONMENT_IS_NODE,"node environment detected but not enabled at build time.  Add `node` to `-sENVIRONMENT` to enable."),assert(!ENVIRONMENT_IS_SHELL,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var wasmMemory,wasmBinary=Module.wasmBinary;legacyModuleProp("wasmBinary","wasmBinary"),"object"!=typeof WebAssembly&&err("no native wasm support detected");var EXITSTATUS,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAP64,HEAPF64,ABORT=!1;function assert(condition,text){condition||abort("Assertion failed"+(text?": "+text:""))}function updateMemoryViews(){var b=wasmMemory.buffer;Module.HEAP8=HEAP8=new Int8Array(b),Module.HEAP16=HEAP16=new Int16Array(b),Module.HEAPU8=HEAPU8=new Uint8Array(b),Module.HEAPU16=HEAPU16=new Uint16Array(b),Module.HEAP32=HEAP32=new Int32Array(b),Module.HEAPU32=HEAPU32=new Uint32Array(b),Module.HEAPF32=HEAPF32=new Float32Array(b),Module.HEAPF64=HEAPF64=new Float64Array(b),Module.HEAP64=HEAP64=new BigInt64Array(b),Module.HEAPU64=new BigUint64Array(b)}function checkStackCookie(){if(!ABORT){var max=_emscripten_stack_get_end();0==max&&(max+=4);var cookie1=HEAPU32[max>>2],cookie2=HEAPU32[max+4>>2];34821223==cookie1&&2310721022==cookie2||abort(`Stack overflow! Stack cookie has been overwritten at ${ptrToString(max)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${ptrToString(cookie2)} ${ptrToString(cookie1)}`),1668509029!=HEAPU32[0]&&abort("Runtime error: The application has corrupted its heap memory area (address zero)!")}}assert(!Module.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),assert(!Module.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),assert(!Module.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1;assert(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),assert(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),assert(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),assert(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null,runDependencyTracking={};function getUniqueRunDependency(id){for(var orig=id;;){if(!runDependencyTracking[id])return id;id=orig+Math.random()}}function addRunDependency(id){runDependencies++,Module.monitorRunDependencies?.(runDependencies),id?(assert(!runDependencyTracking[id]),runDependencyTracking[id]=1,null===runDependencyWatcher&&"undefined"!=typeof setInterval&&(runDependencyWatcher=setInterval((()=>{if(ABORT)return clearInterval(runDependencyWatcher),void(runDependencyWatcher=null);var shown=!1;for(var dep in runDependencyTracking)shown||(shown=!0,err("still waiting on run dependencies:")),err(`dependency: ${dep}`);shown&&err("(end of list)")}),1e4))):err("warning: run dependency added without ID")}function removeRunDependency(id){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),id?(assert(runDependencyTracking[id]),delete runDependencyTracking[id]):err("warning: run dependency removed without ID"),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var callback=dependenciesFulfilled;dependenciesFulfilled=null,callback()}}function abort(what){Module.onAbort?.(what),err(what="Aborted("+what+")"),ABORT=!0;var e=new WebAssembly.RuntimeError(what);throw readyPromiseReject(e),e}var wasmBinaryFile,isDataURI=filename=>filename.startsWith("data:application/octet-stream;base64,"),isFileURI=filename=>filename.startsWith("file://");function createExportWrapper(name,nargs){return(...args)=>{assert(runtimeInitialized,`native function \`${name}\` called before runtime initialization`),assert(!runtimeExited,`native function \`${name}\` called after runtime exit (use NO_EXIT_RUNTIME to keep it alive after main() exits)`);var f=wasmExports[name];return assert(f,`exported native function \`${name}\` not found`),assert(args.length<=nargs,`native function \`${name}\` called with ${args.length} args but expects ${nargs}`),f(...args)}}function findWasmBinary(){var path,f="godot.web.template_release.wasm32.nothreads.minigame.wasm";return isDataURI(f)?f:(path=f,Module.locateFile?Module.locateFile(path,scriptDirectory):scriptDirectory+path)}function getBinarySync(file){if(file==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(file);throw"both async and sync fetching of the wasm failed"}function instantiateArrayBuffer(binaryFile,imports,receiver){return function(binaryFile){return wasmBinary?Promise.resolve().then((()=>getBinarySync(binaryFile))):readAsync(binaryFile).then((response=>new Uint8Array(response)),(()=>getBinarySync(binaryFile)))}(binaryFile).then((binary=>WebAssembly.instantiate(binary,imports))).then(receiver,(reason=>{err(`failed to asynchronously prepare wasm: ${reason}`),isFileURI(wasmBinaryFile)&&err(`warning: Loading from a file URI (${wasmBinaryFile}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),abort(reason)}))}if((()=>{var h16=new Int16Array(1),h8=new Int8Array(h16.buffer);if(h16[0]=25459,115!==h8[0]||99!==h8[1])throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),Module.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function legacyModuleProp(prop,newName,incoming=!0){Object.getOwnPropertyDescriptor(Module,prop)||Object.defineProperty(Module,prop,{configurable:!0,get(){abort(`\`Module.${prop}\` has been replaced by \`${newName}\``+(incoming?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":""))}})}function isExportedByForceFilesystem(name){return"FS_createPath"===name||"FS_createDataFile"===name||"FS_createPreloadedFile"===name||"FS_unlink"===name||"addRunDependency"===name||"FS_createLazyFile"===name||"FS_createDevice"===name||"removeRunDependency"===name}function unexportedRuntimeSymbol(sym){Object.getOwnPropertyDescriptor(Module,sym)||Object.defineProperty(Module,sym,{configurable:!0,get(){var msg=`'${sym}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;isExportedByForceFilesystem(sym)&&(msg+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),abort(msg)}})}class ExitStatus{name="ExitStatus";constructor(status){this.message=`Program terminated with exit(${status})`,this.status=status}}var callRuntimeCallbacks=callbacks=>{for(;callbacks.length>0;)callbacks.shift()(Module)};var noExitRuntime=Module.noExitRuntime||!1,ptrToString=ptr=>(assert("number"==typeof ptr),"0x"+(ptr>>>=0).toString(16).padStart(8,"0"));var wasmTable,warnOnce=text=>{warnOnce.shown||={},warnOnce.shown[text]||(warnOnce.shown[text]=1,err(text))},UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder:void 0,UTF8ArrayToString=(heapOrArray,idx=0,maxBytesToRead=NaN)=>{for(var endIdx=idx+maxBytesToRead,endPtr=idx;heapOrArray[endPtr]&&!(endPtr>=endIdx);)++endPtr;if(endPtr-idx>16&&heapOrArray.buffer&&UTF8Decoder)return UTF8Decoder.decode(heapOrArray.subarray(idx,endPtr));for(var str="";idx<endPtr;){var u0=heapOrArray[idx++];if(128&u0){var u1=63&heapOrArray[idx++];if(192!=(224&u0)){var u2=63&heapOrArray[idx++];if(224==(240&u0)?u0=(15&u0)<<12|u1<<6|u2:(240!=(248&u0)&&warnOnce("Invalid UTF-8 leading byte "+ptrToString(u0)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),u0=(7&u0)<<18|u1<<12|u2<<6|63&heapOrArray[idx++]),u0<65536)str+=String.fromCharCode(u0);else{var ch=u0-65536;str+=String.fromCharCode(55296|ch>>10,56320|1023&ch)}}else str+=String.fromCharCode((31&u0)<<6|u1)}else str+=String.fromCharCode(u0)}return str},UTF8ToString=(ptr,maxBytesToRead)=>(assert("number"==typeof ptr,`UTF8ToString expects a number (got ${typeof ptr})`),ptr?UTF8ArrayToString(HEAPU8,ptr,maxBytesToRead):""),getWasmTableEntry=funcPtr=>wasmTable.get(funcPtr),PATH={isAbs:path=>"/"===path.charAt(0),splitPath:filename=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(filename).slice(1),normalizeArray:(parts,allowAboveRoot)=>{for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up;up--)parts.unshift("..");return parts},normalize:path=>{var isAbsolute=PATH.isAbs(path),trailingSlash="/"===path.substr(-1);return(path=PATH.normalizeArray(path.split("/").filter((p=>!!p)),!isAbsolute).join("/"))||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},dirname:path=>{var result=PATH.splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},basename:path=>{if("/"===path)return"/";var lastSlash=(path=(path=PATH.normalize(path)).replace(/\/$/,"")).lastIndexOf("/");return-1===lastSlash?path:path.substr(lastSlash+1)},join:(...paths)=>PATH.normalize(paths.join("/")),join2:(l,r)=>PATH.normalize(l+"/"+r)},randomFill=view=>(randomFill=(()=>{if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues)return view=>crypto.getRandomValues(view);abort("no cryptographic support found for randomDevice. consider polyfilling it if you want to use something insecure like Math.random(), e.g. put this in a --pre-js: var crypto = { getRandomValues: (array) => { for (var i = 0; i < array.length; i++) array[i] = (Math.random()*256)|0 } };")})())(view),PATH_FS={resolve:(...args)=>{for(var resolvedPath="",resolvedAbsolute=!1,i=args.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?args[i]:FS.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");if(!path)return"";resolvedPath=path+"/"+resolvedPath,resolvedAbsolute=PATH.isAbs(path)}return(resolvedAbsolute?"/":"")+(resolvedPath=PATH.normalizeArray(resolvedPath.split("/").filter((p=>!!p)),!resolvedAbsolute).join("/"))||"."},relative:(from,to)=>{function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=PATH_FS.resolve(from).substr(1),to=PATH_FS.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}var outputParts=[];for(i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return(outputParts=outputParts.concat(toParts.slice(samePartsLength))).join("/")}},FS_stdin_getChar_buffer=[],lengthBytesUTF8=str=>{for(var len=0,i=0;i<str.length;++i){var c=str.charCodeAt(i);c<=127?len++:c<=2047?len+=2:c>=55296&&c<=57343?(len+=4,++i):len+=3}return len},stringToUTF8Array=(str,heap,outIdx,maxBytesToWrite)=>{if(assert("string"==typeof str,`stringToUTF8Array expects a string (got ${typeof str})`),!(maxBytesToWrite>0))return 0;for(var startIdx=outIdx,endIdx=outIdx+maxBytesToWrite-1,i=0;i<str.length;++i){var u=str.charCodeAt(i);if(u>=55296&&u<=57343)u=65536+((1023&u)<<10)|1023&str.charCodeAt(++i);if(u<=127){if(outIdx>=endIdx)break;heap[outIdx++]=u}else if(u<=2047){if(outIdx+1>=endIdx)break;heap[outIdx++]=192|u>>6,heap[outIdx++]=128|63&u}else if(u<=65535){if(outIdx+2>=endIdx)break;heap[outIdx++]=224|u>>12,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}else{if(outIdx+3>=endIdx)break;u>1114111&&warnOnce("Invalid Unicode code point "+ptrToString(u)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),heap[outIdx++]=240|u>>18,heap[outIdx++]=128|u>>12&63,heap[outIdx++]=128|u>>6&63,heap[outIdx++]=128|63&u}}return heap[outIdx]=0,outIdx-startIdx};function intArrayFromString(stringy,dontAddNull,length){var len=length>0?length:lengthBytesUTF8(stringy)+1,u8array=new Array(len),numBytesWritten=stringToUTF8Array(stringy,u8array,0,u8array.length);return dontAddNull&&(u8array.length=numBytesWritten),u8array}var TTY={ttys:[],init(){},shutdown(){},register(dev,ops){TTY.ttys[dev]={input:[],output:[],ops:ops},FS.registerDevice(dev,TTY.stream_ops)},stream_ops:{open(stream){var tty=TTY.ttys[stream.node.rdev];if(!tty)throw new FS.ErrnoError(43);stream.tty=tty,stream.seekable=!1},close(stream){stream.tty.ops.fsync(stream.tty)},fsync(stream){stream.tty.ops.fsync(stream.tty)},read(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.get_char)throw new FS.ErrnoError(60);for(var bytesRead=0,i=0;i<length;i++){var result;try{result=stream.tty.ops.get_char(stream.tty)}catch(e){throw new FS.ErrnoError(29)}if(void 0===result&&0===bytesRead)throw new FS.ErrnoError(6);if(null==result)break;bytesRead++,buffer[offset+i]=result}return bytesRead&&(stream.node.timestamp=Date.now()),bytesRead},write(stream,buffer,offset,length,pos){if(!stream.tty||!stream.tty.ops.put_char)throw new FS.ErrnoError(60);try{for(var i=0;i<length;i++)stream.tty.ops.put_char(stream.tty,buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}return length&&(stream.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:tty=>(()=>{if(!FS_stdin_getChar_buffer.length){var result=null;if("undefined"!=typeof window&&"function"==typeof window.prompt&&null!==(result=window.prompt("Input: "))&&(result+="\n"),!result)return null;FS_stdin_getChar_buffer=intArrayFromString(result,!0)}return FS_stdin_getChar_buffer.shift()})(),put_char(tty,val){null===val||10===val?(out(UTF8ArrayToString(tty.output)),tty.output=[]):0!=val&&tty.output.push(val)},fsync(tty){tty.output&&tty.output.length>0&&(out(UTF8ArrayToString(tty.output)),tty.output=[])},ioctl_tcgets:tty=>({c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}),ioctl_tcsets:(tty,optional_actions,data)=>0,ioctl_tiocgwinsz:tty=>[24,80]},default_tty1_ops:{put_char(tty,val){null===val||10===val?(err(UTF8ArrayToString(tty.output)),tty.output=[]):0!=val&&tty.output.push(val)},fsync(tty){tty.output&&tty.output.length>0&&(err(UTF8ArrayToString(tty.output)),tty.output=[])}}},zeroMemory=(address,size)=>{HEAPU8.fill(0,address,address+size)},mmapAlloc=size=>{abort("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},MEMFS={ops_table:null,mount:mount=>MEMFS.createNode(null,"/",16895,0),createNode(parent,name,mode,dev){if(FS.isBlkdev(mode)||FS.isFIFO(mode))throw new FS.ErrnoError(63);MEMFS.ops_table||={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}};var node=FS.createNode(parent,name,mode,dev);return FS.isDir(node.mode)?(node.node_ops=MEMFS.ops_table.dir.node,node.stream_ops=MEMFS.ops_table.dir.stream,node.contents={}):FS.isFile(node.mode)?(node.node_ops=MEMFS.ops_table.file.node,node.stream_ops=MEMFS.ops_table.file.stream,node.usedBytes=0,node.contents=null):FS.isLink(node.mode)?(node.node_ops=MEMFS.ops_table.link.node,node.stream_ops=MEMFS.ops_table.link.stream):FS.isChrdev(node.mode)&&(node.node_ops=MEMFS.ops_table.chrdev.node,node.stream_ops=MEMFS.ops_table.chrdev.stream),node.timestamp=Date.now(),parent&&(parent.contents[name]=node,parent.timestamp=node.timestamp),node},getFileDataAsTypedArray:node=>node.contents?node.contents.subarray?node.contents.subarray(0,node.usedBytes):new Uint8Array(node.contents):new Uint8Array(0),expandFileStorage(node,newCapacity){var prevCapacity=node.contents?node.contents.length:0;if(!(prevCapacity>=newCapacity)){newCapacity=Math.max(newCapacity,prevCapacity*(prevCapacity<1048576?2:1.125)>>>0),0!=prevCapacity&&(newCapacity=Math.max(newCapacity,256));var oldContents=node.contents;node.contents=new Uint8Array(newCapacity),node.usedBytes>0&&node.contents.set(oldContents.subarray(0,node.usedBytes),0)}},resizeFileStorage(node,newSize){if(node.usedBytes!=newSize)if(0==newSize)node.contents=null,node.usedBytes=0;else{var oldContents=node.contents;node.contents=new Uint8Array(newSize),oldContents&&node.contents.set(oldContents.subarray(0,Math.min(newSize,node.usedBytes))),node.usedBytes=newSize}},node_ops:{getattr(node){var attr={};return attr.dev=FS.isChrdev(node.mode)?node.id:1,attr.ino=node.id,attr.mode=node.mode,attr.nlink=1,attr.uid=0,attr.gid=0,attr.rdev=node.rdev,FS.isDir(node.mode)?attr.size=4096:FS.isFile(node.mode)?attr.size=node.usedBytes:FS.isLink(node.mode)?attr.size=node.link.length:attr.size=0,attr.atime=new Date(node.timestamp),attr.mtime=new Date(node.timestamp),attr.ctime=new Date(node.timestamp),attr.blksize=4096,attr.blocks=Math.ceil(attr.size/attr.blksize),attr},setattr(node,attr){void 0!==attr.mode&&(node.mode=attr.mode),void 0!==attr.timestamp&&(node.timestamp=attr.timestamp),void 0!==attr.size&&MEMFS.resizeFileStorage(node,attr.size)},lookup(parent,name){throw new FS.ErrnoError(44)},mknod:(parent,name,mode,dev)=>MEMFS.createNode(parent,name,mode,dev),rename(old_node,new_dir,new_name){if(FS.isDir(old_node.mode)){var new_node;try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(new_node)for(var i in new_node.contents)throw new FS.ErrnoError(55)}delete old_node.parent.contents[old_node.name],old_node.parent.timestamp=Date.now(),old_node.name=new_name,new_dir.contents[new_name]=old_node,new_dir.timestamp=old_node.parent.timestamp},unlink(parent,name){delete parent.contents[name],parent.timestamp=Date.now()},rmdir(parent,name){var node=FS.lookupNode(parent,name);for(var i in node.contents)throw new FS.ErrnoError(55);delete parent.contents[name],parent.timestamp=Date.now()},readdir(node){var entries=[".",".."];for(var key of Object.keys(node.contents))entries.push(key);return entries},symlink(parent,newname,oldpath){var node=MEMFS.createNode(parent,newname,41471,0);return node.link=oldpath,node},readlink(node){if(!FS.isLink(node.mode))throw new FS.ErrnoError(28);return node.link}},stream_ops:{read(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=stream.node.usedBytes)return 0;var size=Math.min(stream.node.usedBytes-position,length);if(assert(size>=0),size>8&&contents.subarray)buffer.set(contents.subarray(position,position+size),offset);else for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i];return size},write(stream,buffer,offset,length,position,canOwn){if(assert(!(buffer instanceof ArrayBuffer)),buffer.buffer===HEAP8.buffer&&(canOwn=!1),!length)return 0;var node=stream.node;if(node.timestamp=Date.now(),buffer.subarray&&(!node.contents||node.contents.subarray)){if(canOwn)return assert(0===position,"canOwn must imply no weird position inside the file"),node.contents=buffer.subarray(offset,offset+length),node.usedBytes=length,length;if(0===node.usedBytes&&0===position)return node.contents=buffer.slice(offset,offset+length),node.usedBytes=length,length;if(position+length<=node.usedBytes)return node.contents.set(buffer.subarray(offset,offset+length),position),length}if(MEMFS.expandFileStorage(node,position+length),node.contents.subarray&&buffer.subarray)node.contents.set(buffer.subarray(offset,offset+length),position);else for(var i=0;i<length;i++)node.contents[position+i]=buffer[offset+i];return node.usedBytes=Math.max(node.usedBytes,position+length),length},llseek(stream,offset,whence){var position=offset;if(1===whence?position+=stream.position:2===whence&&FS.isFile(stream.node.mode)&&(position+=stream.node.usedBytes),position<0)throw new FS.ErrnoError(28);return position},allocate(stream,offset,length){MEMFS.expandFileStorage(stream.node,offset+length),stream.node.usedBytes=Math.max(stream.node.usedBytes,offset+length)},mmap(stream,length,position,prot,flags){if(!FS.isFile(stream.node.mode))throw new FS.ErrnoError(43);var ptr,allocated,contents=stream.node.contents;if(2&flags||!contents||contents.buffer!==HEAP8.buffer){if(allocated=!0,!(ptr=mmapAlloc()))throw new FS.ErrnoError(48);contents&&((position>0||position+length<contents.length)&&(contents=contents.subarray?contents.subarray(position,position+length):Array.prototype.slice.call(contents,position,position+length)),HEAP8.set(contents,ptr))}else allocated=!1,ptr=contents.byteOffset;return{ptr:ptr,allocated:allocated}},msync:(stream,buffer,offset,length,mmapFlags)=>(MEMFS.stream_ops.write(stream,buffer,0,length,offset,!1),0)}},preloadPlugins=Module.preloadPlugins||[],FS_getMode=(canRead,canWrite)=>{var mode=0;return canRead&&(mode|=365),canWrite&&(mode|=146),mode},IDBFS={dbs:{},indexedDB:()=>{if("undefined"!=typeof indexedDB)return indexedDB;var ret=null;return"object"==typeof window&&(ret=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),assert(ret,"IDBFS used, but indexedDB not supported"),ret},DB_VERSION:21,DB_STORE_NAME:"FILE_DATA",queuePersist:mount=>{function onPersistComplete(){"again"===mount.idbPersistState?startPersist():mount.idbPersistState=0}function startPersist(){mount.idbPersistState="idb",IDBFS.syncfs(mount,!1,onPersistComplete)}mount.idbPersistState?"idb"===mount.idbPersistState&&(mount.idbPersistState="again"):mount.idbPersistState=setTimeout(startPersist,0)},mount:mount=>{var mnt=MEMFS.mount(mount);if(mount?.opts?.autoPersist){mnt.idbPersistState=0;var memfs_node_ops=mnt.node_ops;mnt.node_ops=Object.assign({},mnt.node_ops),mnt.node_ops.mknod=(parent,name,mode,dev)=>{var node=memfs_node_ops.mknod(parent,name,mode,dev);return node.node_ops=mnt.node_ops,node.idbfs_mount=mnt.mount,node.memfs_stream_ops=node.stream_ops,node.stream_ops=Object.assign({},node.stream_ops),node.stream_ops.write=(stream,buffer,offset,length,position,canOwn)=>(stream.node.isModified=!0,node.memfs_stream_ops.write(stream,buffer,offset,length,position,canOwn)),node.stream_ops.close=stream=>{var n=stream.node;if(n.isModified&&(IDBFS.queuePersist(n.idbfs_mount),n.isModified=!1),n.memfs_stream_ops.close)return n.memfs_stream_ops.close(stream)},node},mnt.node_ops.mkdir=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.mkdir(...args)),mnt.node_ops.rmdir=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.rmdir(...args)),mnt.node_ops.symlink=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.symlink(...args)),mnt.node_ops.unlink=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.unlink(...args)),mnt.node_ops.rename=(...args)=>(IDBFS.queuePersist(mnt.mount),memfs_node_ops.rename(...args))}return mnt},syncfs:(mount,populate,callback)=>{IDBFS.getLocalSet(mount,((err,local)=>{if(err)return callback(err);IDBFS.getRemoteSet(mount,((err,remote)=>{if(err)return callback(err);var src=populate?remote:local,dst=populate?local:remote;IDBFS.reconcile(src,dst,callback)}))}))},quit:()=>{Object.values(IDBFS.dbs).forEach((value=>value.close())),IDBFS.dbs={}},getDB:(name,callback)=>{var req,db=IDBFS.dbs[name];if(db)return callback(null,db);try{req=IDBFS.indexedDB().open(name,IDBFS.DB_VERSION)}catch(e){return callback(e)}if(!req)return callback("Unable to connect to IndexedDB");req.onupgradeneeded=e=>{var fileStore,db=e.target.result,transaction=e.target.transaction;(fileStore=db.objectStoreNames.contains(IDBFS.DB_STORE_NAME)?transaction.objectStore(IDBFS.DB_STORE_NAME):db.createObjectStore(IDBFS.DB_STORE_NAME)).indexNames.contains("timestamp")||fileStore.createIndex("timestamp","timestamp",{unique:!1})},req.onsuccess=()=>{db=req.result,IDBFS.dbs[name]=db,callback(null,db)},req.onerror=e=>{callback(e.target.error),e.preventDefault()}},getLocalSet:(mount,callback)=>{var entries={};function isRealDir(p){return"."!==p&&".."!==p}function toAbsolute(root){return p=>PATH.join2(root,p)}for(var check=FS.readdir(mount.mountpoint).filter(isRealDir).map(toAbsolute(mount.mountpoint));check.length;){var stat,path=check.pop();try{stat=FS.stat(path)}catch(e){return callback(e)}FS.isDir(stat.mode)&&check.push(...FS.readdir(path).filter(isRealDir).map(toAbsolute(path))),entries[path]={timestamp:stat.mtime}}return callback(null,{type:"local",entries:entries})},getRemoteSet:(mount,callback)=>{var entries={};IDBFS.getDB(mount.mountpoint,((err,db)=>{if(err)return callback(err);try{var transaction=db.transaction([IDBFS.DB_STORE_NAME],"readonly");transaction.onerror=e=>{callback(e.target.error),e.preventDefault()},transaction.objectStore(IDBFS.DB_STORE_NAME).index("timestamp").openKeyCursor().onsuccess=event=>{var cursor=event.target.result;if(!cursor)return callback(null,{type:"remote",db:db,entries:entries});entries[cursor.primaryKey]={timestamp:cursor.key},cursor.continue()}}catch(e){return callback(e)}}))},loadLocalEntry:(path,callback)=>{var stat,node;try{node=FS.lookupPath(path).node,stat=FS.stat(path)}catch(e){return callback(e)}return FS.isDir(stat.mode)?callback(null,{timestamp:stat.mtime,mode:stat.mode}):FS.isFile(stat.mode)?(node.contents=MEMFS.getFileDataAsTypedArray(node),callback(null,{timestamp:stat.mtime,mode:stat.mode,contents:node.contents})):callback(new Error("node type not supported"))},storeLocalEntry:(path,entry,callback)=>{try{if(FS.isDir(entry.mode))FS.mkdirTree(path,entry.mode);else{if(!FS.isFile(entry.mode))return callback(new Error("node type not supported"));FS.writeFile(path,entry.contents,{canOwn:!0})}FS.chmod(path,entry.mode),FS.utime(path,entry.timestamp,entry.timestamp)}catch(e){return callback(e)}callback(null)},removeLocalEntry:(path,callback)=>{try{var stat=FS.stat(path);FS.isDir(stat.mode)?FS.rmdir(path):FS.isFile(stat.mode)&&FS.unlink(path)}catch(e){return callback(e)}callback(null)},loadRemoteEntry:(store,path,callback)=>{var req=store.get(path);req.onsuccess=event=>callback(null,event.target.result),req.onerror=e=>{callback(e.target.error),e.preventDefault()}},storeRemoteEntry:(store,path,entry,callback)=>{try{var req=store.put(entry,path)}catch(e){return void callback(e)}req.onsuccess=event=>callback(),req.onerror=e=>{callback(e.target.error),e.preventDefault()}},removeRemoteEntry:(store,path,callback)=>{var req=store.delete(path);req.onsuccess=event=>callback(),req.onerror=e=>{callback(e.target.error),e.preventDefault()}},reconcile:(src,dst,callback)=>{var total=0,create=[];Object.keys(src.entries).forEach((key=>{var e=src.entries[key],e2=dst.entries[key];e2&&e.timestamp.getTime()==e2.timestamp.getTime()||(create.push(key),total++)}));var remove=[];if(Object.keys(dst.entries).forEach((key=>{src.entries[key]||(remove.push(key),total++)})),!total)return callback(null);var errored=!1,transaction=("remote"===src.type?src.db:dst.db).transaction([IDBFS.DB_STORE_NAME],"readwrite"),store=transaction.objectStore(IDBFS.DB_STORE_NAME);function done(err){if(err&&!errored)return errored=!0,callback(err)}transaction.onerror=transaction.onabort=e=>{done(e.target.error),e.preventDefault()},transaction.oncomplete=e=>{errored||callback(null)},create.sort().forEach((path=>{"local"===dst.type?IDBFS.loadRemoteEntry(store,path,((err,entry)=>{if(err)return done(err);IDBFS.storeLocalEntry(path,entry,done)})):IDBFS.loadLocalEntry(path,((err,entry)=>{if(err)return done(err);IDBFS.storeRemoteEntry(store,path,entry,done)}))})),remove.sort().reverse().forEach((path=>{"local"===dst.type?IDBFS.removeLocalEntry(path,done):IDBFS.removeRemoteEntry(store,path,done)}))}},ERRNO_CODES={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:class extends Error{name="ErrnoError";constructor(errno){for(var key in super(runtimeInitialized?(errno=>UTF8ToString(_strerror(errno)))(errno):""),this.errno=errno,ERRNO_CODES)if(ERRNO_CODES[key]===errno){this.code=key;break}}},filesystems:null,syncFSRequests:0,readFiles:{},FSStream:class{shared={};get object(){return this.node}set object(val){this.node=val}get isRead(){return 1!=(2097155&this.flags)}get isWrite(){return!!(2097155&this.flags)}get isAppend(){return 1024&this.flags}get flags(){return this.shared.flags}set flags(val){this.shared.flags=val}get position(){return this.shared.position}set position(val){this.shared.position=val}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(parent,name,mode,rdev){parent||(parent=this),this.parent=parent,this.mount=parent.mount,this.id=FS.nextInode++,this.name=name,this.mode=mode,this.rdev=rdev}get read(){return(this.mode&this.readMode)===this.readMode}set read(val){val?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(val){val?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return FS.isDir(this.mode)}get isDevice(){return FS.isChrdev(this.mode)}},lookupPath(path,opts={}){if(!(path=PATH_FS.resolve(path)))return{path:"",node:null};if((opts=Object.assign({follow_mount:!0,recurse_count:0},opts)).recurse_count>8)throw new FS.ErrnoError(32);for(var parts=path.split("/").filter((p=>!!p)),current=FS.root,current_path="/",i=0;i<parts.length;i++){var islast=i===parts.length-1;if(islast&&opts.parent)break;if(current=FS.lookupNode(current,parts[i]),current_path=PATH.join2(current_path,parts[i]),FS.isMountpoint(current)&&(!islast||islast&&opts.follow_mount)&&(current=current.mounted.root),!islast||opts.follow)for(var count=0;FS.isLink(current.mode);){var link=FS.readlink(current_path);if(current_path=PATH_FS.resolve(PATH.dirname(current_path),link),current=FS.lookupPath(current_path,{recurse_count:opts.recurse_count+1}).node,count++>40)throw new FS.ErrnoError(32)}}return{path:current_path,node:current}},getPath(node){for(var path;;){if(FS.isRoot(node)){var mount=node.mount.mountpoint;return path?"/"!==mount[mount.length-1]?`${mount}/${path}`:mount+path:mount}path=path?`${node.name}/${path}`:node.name,node=node.parent}},hashName(parentid,name){for(var hash=0,i=0;i<name.length;i++)hash=(hash<<5)-hash+name.charCodeAt(i)|0;return(parentid+hash>>>0)%FS.nameTable.length},hashAddNode(node){var hash=FS.hashName(node.parent.id,node.name);node.name_next=FS.nameTable[hash],FS.nameTable[hash]=node},hashRemoveNode(node){var hash=FS.hashName(node.parent.id,node.name);if(FS.nameTable[hash]===node)FS.nameTable[hash]=node.name_next;else for(var current=FS.nameTable[hash];current;){if(current.name_next===node){current.name_next=node.name_next;break}current=current.name_next}},lookupNode(parent,name){var errCode=FS.mayLookup(parent);if(errCode)throw new FS.ErrnoError(errCode);for(var hash=FS.hashName(parent.id,name),node=FS.nameTable[hash];node;node=node.name_next){var nodeName=node.name;if(node.parent.id===parent.id&&nodeName===name)return node}return FS.lookup(parent,name)},createNode(parent,name,mode,rdev){assert("object"==typeof parent);var node=new FS.FSNode(parent,name,mode,rdev);return FS.hashAddNode(node),node},destroyNode(node){FS.hashRemoveNode(node)},isRoot:node=>node===node.parent,isMountpoint:node=>!!node.mounted,isFile:mode=>32768==(61440&mode),isDir:mode=>16384==(61440&mode),isLink:mode=>40960==(61440&mode),isChrdev:mode=>8192==(61440&mode),isBlkdev:mode=>24576==(61440&mode),isFIFO:mode=>4096==(61440&mode),isSocket:mode=>!(49152&~mode),flagsToPermissionString(flag){var perms=["r","w","rw"][3&flag];return 512&flag&&(perms+="w"),perms},nodePermissions:(node,perms)=>FS.ignorePermissions||(!perms.includes("r")||292&node.mode)&&(!perms.includes("w")||146&node.mode)&&(!perms.includes("x")||73&node.mode)?0:2,mayLookup(dir){if(!FS.isDir(dir.mode))return 54;var errCode=FS.nodePermissions(dir,"x");return errCode||(dir.node_ops.lookup?0:2)},mayCreate(dir,name){try{FS.lookupNode(dir,name);return 20}catch(e){}return FS.nodePermissions(dir,"wx")},mayDelete(dir,name,isdir){var node;try{node=FS.lookupNode(dir,name)}catch(e){return e.errno}var errCode=FS.nodePermissions(dir,"wx");if(errCode)return errCode;if(isdir){if(!FS.isDir(node.mode))return 54;if(FS.isRoot(node)||FS.getPath(node)===FS.cwd())return 10}else if(FS.isDir(node.mode))return 31;return 0},mayOpen:(node,flags)=>node?FS.isLink(node.mode)?32:FS.isDir(node.mode)&&("r"!==FS.flagsToPermissionString(flags)||512&flags)?31:FS.nodePermissions(node,FS.flagsToPermissionString(flags)):44,MAX_OPEN_FDS:4096,nextfd(){for(var fd=0;fd<=FS.MAX_OPEN_FDS;fd++)if(!FS.streams[fd])return fd;throw new FS.ErrnoError(33)},getStreamChecked(fd){var stream=FS.getStream(fd);if(!stream)throw new FS.ErrnoError(8);return stream},getStream:fd=>FS.streams[fd],createStream:(stream,fd=-1)=>(assert(fd>=-1),stream=Object.assign(new FS.FSStream,stream),-1==fd&&(fd=FS.nextfd()),stream.fd=fd,FS.streams[fd]=stream,stream),closeStream(fd){FS.streams[fd]=null},dupStream(origStream,fd=-1){var stream=FS.createStream(origStream,fd);return stream.stream_ops?.dup?.(stream),stream},chrdev_stream_ops:{open(stream){var device=FS.getDevice(stream.node.rdev);stream.stream_ops=device.stream_ops,stream.stream_ops.open?.(stream)},llseek(){throw new FS.ErrnoError(70)}},major:dev=>dev>>8,minor:dev=>255&dev,makedev:(ma,mi)=>ma<<8|mi,registerDevice(dev,ops){FS.devices[dev]={stream_ops:ops}},getDevice:dev=>FS.devices[dev],getMounts(mount){for(var mounts=[],check=[mount];check.length;){var m=check.pop();mounts.push(m),check.push(...m.mounts)}return mounts},syncfs(populate,callback){"function"==typeof populate&&(callback=populate,populate=!1),FS.syncFSRequests++,FS.syncFSRequests>1&&err(`warning: ${FS.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var mounts=FS.getMounts(FS.root.mount),completed=0;function doCallback(errCode){return assert(FS.syncFSRequests>0),FS.syncFSRequests--,callback(errCode)}function done(errCode){if(errCode)return done.errored?void 0:(done.errored=!0,doCallback(errCode));++completed>=mounts.length&&doCallback(null)}mounts.forEach((mount=>{if(!mount.type.syncfs)return done(null);mount.type.syncfs(mount,populate,done)}))},mount(type,opts,mountpoint){if("string"==typeof type)throw type;var node,root="/"===mountpoint,pseudo=!mountpoint;if(root&&FS.root)throw new FS.ErrnoError(10);if(!root&&!pseudo){var lookup=FS.lookupPath(mountpoint,{follow_mount:!1});if(mountpoint=lookup.path,node=lookup.node,FS.isMountpoint(node))throw new FS.ErrnoError(10);if(!FS.isDir(node.mode))throw new FS.ErrnoError(54)}var mount={type:type,opts:opts,mountpoint:mountpoint,mounts:[]},mountRoot=type.mount(mount);return mountRoot.mount=mount,mount.root=mountRoot,root?FS.root=mountRoot:node&&(node.mounted=mount,node.mount&&node.mount.mounts.push(mount)),mountRoot},unmount(mountpoint){var lookup=FS.lookupPath(mountpoint,{follow_mount:!1});if(!FS.isMountpoint(lookup.node))throw new FS.ErrnoError(28);var node=lookup.node,mount=node.mounted,mounts=FS.getMounts(mount);Object.keys(FS.nameTable).forEach((hash=>{for(var current=FS.nameTable[hash];current;){var next=current.name_next;mounts.includes(current.mount)&&FS.destroyNode(current),current=next}})),node.mounted=null;var idx=node.mount.mounts.indexOf(mount);assert(-1!==idx),node.mount.mounts.splice(idx,1)},lookup:(parent,name)=>parent.node_ops.lookup(parent,name),mknod(path,mode,dev){var parent=FS.lookupPath(path,{parent:!0}).node,name=PATH.basename(path);if(!name||"."===name||".."===name)throw new FS.ErrnoError(28);var errCode=FS.mayCreate(parent,name);if(errCode)throw new FS.ErrnoError(errCode);if(!parent.node_ops.mknod)throw new FS.ErrnoError(63);return parent.node_ops.mknod(parent,name,mode,dev)},statfs(path){var rtn={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:FS.nextInode,ffree:FS.nextInode-1,fsid:42,flags:2,namelen:255},parent=FS.lookupPath(path,{follow:!0}).node;return parent?.node_ops.statfs&&Object.assign(rtn,parent.node_ops.statfs(parent.mount.opts.root)),rtn},create:(path,mode=438)=>(mode&=4095,mode|=32768,FS.mknod(path,mode,0)),mkdir:(path,mode=511)=>(mode&=1023,mode|=16384,FS.mknod(path,mode,0)),mkdirTree(path,mode){for(var dirs=path.split("/"),d="",i=0;i<dirs.length;++i)if(dirs[i]){d+="/"+dirs[i];try{FS.mkdir(d,mode)}catch(e){if(20!=e.errno)throw e}}},mkdev:(path,mode,dev)=>(void 0===dev&&(dev=mode,mode=438),mode|=8192,FS.mknod(path,mode,dev)),symlink(oldpath,newpath){if(!PATH_FS.resolve(oldpath))throw new FS.ErrnoError(44);var parent=FS.lookupPath(newpath,{parent:!0}).node;if(!parent)throw new FS.ErrnoError(44);var newname=PATH.basename(newpath),errCode=FS.mayCreate(parent,newname);if(errCode)throw new FS.ErrnoError(errCode);if(!parent.node_ops.symlink)throw new FS.ErrnoError(63);return parent.node_ops.symlink(parent,newname,oldpath)},rename(old_path,new_path){var old_dir,new_dir,old_dirname=PATH.dirname(old_path),new_dirname=PATH.dirname(new_path),old_name=PATH.basename(old_path),new_name=PATH.basename(new_path);if(old_dir=FS.lookupPath(old_path,{parent:!0}).node,new_dir=FS.lookupPath(new_path,{parent:!0}).node,!old_dir||!new_dir)throw new FS.ErrnoError(44);if(old_dir.mount!==new_dir.mount)throw new FS.ErrnoError(75);var new_node,old_node=FS.lookupNode(old_dir,old_name),relative=PATH_FS.relative(old_path,new_dirname);if("."!==relative.charAt(0))throw new FS.ErrnoError(28);if("."!==(relative=PATH_FS.relative(new_path,old_dirname)).charAt(0))throw new FS.ErrnoError(55);try{new_node=FS.lookupNode(new_dir,new_name)}catch(e){}if(old_node!==new_node){var isdir=FS.isDir(old_node.mode),errCode=FS.mayDelete(old_dir,old_name,isdir);if(errCode)throw new FS.ErrnoError(errCode);if(errCode=new_node?FS.mayDelete(new_dir,new_name,isdir):FS.mayCreate(new_dir,new_name))throw new FS.ErrnoError(errCode);if(!old_dir.node_ops.rename)throw new FS.ErrnoError(63);if(FS.isMountpoint(old_node)||new_node&&FS.isMountpoint(new_node))throw new FS.ErrnoError(10);if(new_dir!==old_dir&&(errCode=FS.nodePermissions(old_dir,"w")))throw new FS.ErrnoError(errCode);FS.hashRemoveNode(old_node);try{old_dir.node_ops.rename(old_node,new_dir,new_name),old_node.parent=new_dir}catch(e){throw e}finally{FS.hashAddNode(old_node)}}},rmdir(path){var parent=FS.lookupPath(path,{parent:!0}).node,name=PATH.basename(path),node=FS.lookupNode(parent,name),errCode=FS.mayDelete(parent,name,!0);if(errCode)throw new FS.ErrnoError(errCode);if(!parent.node_ops.rmdir)throw new FS.ErrnoError(63);if(FS.isMountpoint(node))throw new FS.ErrnoError(10);parent.node_ops.rmdir(parent,name),FS.destroyNode(node)},readdir(path){var node=FS.lookupPath(path,{follow:!0}).node;if(!node.node_ops.readdir)throw new FS.ErrnoError(54);return node.node_ops.readdir(node)},unlink(path){var parent=FS.lookupPath(path,{parent:!0}).node;if(!parent)throw new FS.ErrnoError(44);var name=PATH.basename(path),node=FS.lookupNode(parent,name),errCode=FS.mayDelete(parent,name,!1);if(errCode)throw new FS.ErrnoError(errCode);if(!parent.node_ops.unlink)throw new FS.ErrnoError(63);if(FS.isMountpoint(node))throw new FS.ErrnoError(10);parent.node_ops.unlink(parent,name),FS.destroyNode(node)},readlink(path){var link=FS.lookupPath(path).node;if(!link)throw new FS.ErrnoError(44);if(!link.node_ops.readlink)throw new FS.ErrnoError(28);return link.node_ops.readlink(link)},stat(path,dontFollow){var node=FS.lookupPath(path,{follow:!dontFollow}).node;if(!node)throw new FS.ErrnoError(44);if(!node.node_ops.getattr)throw new FS.ErrnoError(63);return node.node_ops.getattr(node)},lstat:path=>FS.stat(path,!0),chmod(path,mode,dontFollow){var node;"string"==typeof path?node=FS.lookupPath(path,{follow:!dontFollow}).node:node=path;if(!node.node_ops.setattr)throw new FS.ErrnoError(63);node.node_ops.setattr(node,{mode:4095&mode|-4096&node.mode,timestamp:Date.now()})},lchmod(path,mode){FS.chmod(path,mode,!0)},fchmod(fd,mode){var stream=FS.getStreamChecked(fd);FS.chmod(stream.node,mode)},chown(path,uid,gid,dontFollow){var node;"string"==typeof path?node=FS.lookupPath(path,{follow:!dontFollow}).node:node=path;if(!node.node_ops.setattr)throw new FS.ErrnoError(63);node.node_ops.setattr(node,{timestamp:Date.now()})},lchown(path,uid,gid){FS.chown(path,uid,gid,!0)},fchown(fd,uid,gid){var stream=FS.getStreamChecked(fd);FS.chown(stream.node,uid,gid)},truncate(path,len){if(len<0)throw new FS.ErrnoError(28);var node;"string"==typeof path?node=FS.lookupPath(path,{follow:!0}).node:node=path;if(!node.node_ops.setattr)throw new FS.ErrnoError(63);if(FS.isDir(node.mode))throw new FS.ErrnoError(31);if(!FS.isFile(node.mode))throw new FS.ErrnoError(28);var errCode=FS.nodePermissions(node,"w");if(errCode)throw new FS.ErrnoError(errCode);node.node_ops.setattr(node,{size:len,timestamp:Date.now()})},ftruncate(fd,len){var stream=FS.getStreamChecked(fd);if(!(2097155&stream.flags))throw new FS.ErrnoError(28);FS.truncate(stream.node,len)},utime(path,atime,mtime){var node=FS.lookupPath(path,{follow:!0}).node;node.node_ops.setattr(node,{timestamp:Math.max(atime,mtime)})},open(path,flags,mode=438){if(""===path)throw new FS.ErrnoError(44);var node;if(mode=64&(flags="string"==typeof flags?(str=>{var flags={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[str];if(void 0===flags)throw new Error(`Unknown file open mode: ${str}`);return flags})(flags):flags)?4095&mode|32768:0,"object"==typeof path)node=path;else{path=PATH.normalize(path);try{node=FS.lookupPath(path,{follow:!(131072&flags)}).node}catch(e){}}var created=!1;if(64&flags)if(node){if(128&flags)throw new FS.ErrnoError(20)}else node=FS.mknod(path,mode,0),created=!0;if(!node)throw new FS.ErrnoError(44);if(FS.isChrdev(node.mode)&&(flags&=-513),65536&flags&&!FS.isDir(node.mode))throw new FS.ErrnoError(54);if(!created){var errCode=FS.mayOpen(node,flags);if(errCode)throw new FS.ErrnoError(errCode)}512&flags&&!created&&FS.truncate(node,0),flags&=-131713;var stream=FS.createStream({node:node,path:FS.getPath(node),flags:flags,seekable:!0,position:0,stream_ops:node.stream_ops,ungotten:[],error:!1});return stream.stream_ops.open&&stream.stream_ops.open(stream),!Module.logReadFiles||1&flags||path in FS.readFiles||(FS.readFiles[path]=1),stream},close(stream){if(FS.isClosed(stream))throw new FS.ErrnoError(8);stream.getdents&&(stream.getdents=null);try{stream.stream_ops.close&&stream.stream_ops.close(stream)}catch(e){throw e}finally{FS.closeStream(stream.fd)}stream.fd=null},isClosed:stream=>null===stream.fd,llseek(stream,offset,whence){if(FS.isClosed(stream))throw new FS.ErrnoError(8);if(!stream.seekable||!stream.stream_ops.llseek)throw new FS.ErrnoError(70);if(0!=whence&&1!=whence&&2!=whence)throw new FS.ErrnoError(28);return stream.position=stream.stream_ops.llseek(stream,offset,whence),stream.ungotten=[],stream.position},read(stream,buffer,offset,length,position){if(assert(offset>=0),length<0||position<0)throw new FS.ErrnoError(28);if(FS.isClosed(stream))throw new FS.ErrnoError(8);if(1==(2097155&stream.flags))throw new FS.ErrnoError(8);if(FS.isDir(stream.node.mode))throw new FS.ErrnoError(31);if(!stream.stream_ops.read)throw new FS.ErrnoError(28);var seeking=void 0!==position;if(seeking){if(!stream.seekable)throw new FS.ErrnoError(70)}else position=stream.position;var bytesRead=stream.stream_ops.read(stream,buffer,offset,length,position);return seeking||(stream.position+=bytesRead),bytesRead},write(stream,buffer,offset,length,position,canOwn){if(assert(offset>=0),length<0||position<0)throw new FS.ErrnoError(28);if(FS.isClosed(stream))throw new FS.ErrnoError(8);if(!(2097155&stream.flags))throw new FS.ErrnoError(8);if(FS.isDir(stream.node.mode))throw new FS.ErrnoError(31);if(!stream.stream_ops.write)throw new FS.ErrnoError(28);stream.seekable&&1024&stream.flags&&FS.llseek(stream,0,2);var seeking=void 0!==position;if(seeking){if(!stream.seekable)throw new FS.ErrnoError(70)}else position=stream.position;var bytesWritten=stream.stream_ops.write(stream,buffer,offset,length,position,canOwn);return seeking||(stream.position+=bytesWritten),bytesWritten},allocate(stream,offset,length){if(FS.isClosed(stream))throw new FS.ErrnoError(8);if(offset<0||length<=0)throw new FS.ErrnoError(28);if(!(2097155&stream.flags))throw new FS.ErrnoError(8);if(!FS.isFile(stream.node.mode)&&!FS.isDir(stream.node.mode))throw new FS.ErrnoError(43);if(!stream.stream_ops.allocate)throw new FS.ErrnoError(138);stream.stream_ops.allocate(stream,offset,length)},mmap(stream,length,position,prot,flags){if(2&prot&&!(2&flags)&&2!=(2097155&stream.flags))throw new FS.ErrnoError(2);if(1==(2097155&stream.flags))throw new FS.ErrnoError(2);if(!stream.stream_ops.mmap)throw new FS.ErrnoError(43);if(!length)throw new FS.ErrnoError(28);return stream.stream_ops.mmap(stream,length,position,prot,flags)},msync:(stream,buffer,offset,length,mmapFlags)=>(assert(offset>=0),stream.stream_ops.msync?stream.stream_ops.msync(stream,buffer,offset,length,mmapFlags):0),ioctl(stream,cmd,arg){if(!stream.stream_ops.ioctl)throw new FS.ErrnoError(59);return stream.stream_ops.ioctl(stream,cmd,arg)},readFile(path,opts={}){if(opts.flags=opts.flags||0,opts.encoding=opts.encoding||"binary","utf8"!==opts.encoding&&"binary"!==opts.encoding)throw new Error(`Invalid encoding type "${opts.encoding}"`);var ret,stream=FS.open(path,opts.flags),length=FS.stat(path).size,buf=new Uint8Array(length);return FS.read(stream,buf,0,length,0),"utf8"===opts.encoding?ret=UTF8ArrayToString(buf):"binary"===opts.encoding&&(ret=buf),FS.close(stream),ret},writeFile(path,data,opts={}){opts.flags=opts.flags||577;var stream=FS.open(path,opts.flags,opts.mode);if("string"==typeof data){var buf=new Uint8Array(lengthBytesUTF8(data)+1),actualNumBytes=stringToUTF8Array(data,buf,0,buf.length);FS.write(stream,buf,0,actualNumBytes,void 0,opts.canOwn)}else{if(!ArrayBuffer.isView(data))throw new Error("Unsupported data type");FS.write(stream,data,0,data.byteLength,void 0,opts.canOwn)}FS.close(stream)},cwd:()=>FS.currentPath,chdir(path){var lookup=FS.lookupPath(path,{follow:!0});if(null===lookup.node)throw new FS.ErrnoError(44);if(!FS.isDir(lookup.node.mode))throw new FS.ErrnoError(54);var errCode=FS.nodePermissions(lookup.node,"x");if(errCode)throw new FS.ErrnoError(errCode);FS.currentPath=lookup.path},createDefaultDirectories(){FS.mkdir("/tmp"),FS.mkdir("/home"),FS.mkdir("/home/web_user")},createDefaultDevices(){FS.mkdir("/dev"),FS.registerDevice(FS.makedev(1,3),{read:()=>0,write:(stream,buffer,offset,length,pos)=>length,llseek:()=>0}),FS.mkdev("/dev/null",FS.makedev(1,3)),TTY.register(FS.makedev(5,0),TTY.default_tty_ops),TTY.register(FS.makedev(6,0),TTY.default_tty1_ops),FS.mkdev("/dev/tty",FS.makedev(5,0)),FS.mkdev("/dev/tty1",FS.makedev(6,0));var randomBuffer=new Uint8Array(1024),randomLeft=0,randomByte=()=>(0===randomLeft&&(randomLeft=randomFill(randomBuffer).byteLength),randomBuffer[--randomLeft]);FS.createDevice("/dev","random",randomByte),FS.createDevice("/dev","urandom",randomByte),FS.mkdir("/dev/shm"),FS.mkdir("/dev/shm/tmp")},createSpecialDirectories(){FS.mkdir("/proc");var proc_self=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd"),FS.mount({mount(){var node=FS.createNode(proc_self,"fd",16895,73);return node.node_ops={lookup(parent,name){var fd=+name,stream=FS.getStreamChecked(fd),ret={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>stream.path}};return ret.parent=ret,ret}},node}},{},"/proc/self/fd")},createStandardStreams(input,output,error){input?FS.createDevice("/dev","stdin",input):FS.symlink("/dev/tty","/dev/stdin"),output?FS.createDevice("/dev","stdout",null,output):FS.symlink("/dev/tty","/dev/stdout"),error?FS.createDevice("/dev","stderr",null,error):FS.symlink("/dev/tty1","/dev/stderr");var stdin=FS.open("/dev/stdin",0),stdout=FS.open("/dev/stdout",1),stderr=FS.open("/dev/stderr",1);assert(0===stdin.fd,`invalid handle for stdin (${stdin.fd})`),assert(1===stdout.fd,`invalid handle for stdout (${stdout.fd})`),assert(2===stderr.fd,`invalid handle for stderr (${stderr.fd})`)},staticInit(){FS.nameTable=new Array(4096),FS.mount(MEMFS,{},"/"),FS.createDefaultDirectories(),FS.createDefaultDevices(),FS.createSpecialDirectories(),FS.filesystems={MEMFS:MEMFS,IDBFS:IDBFS}},init(input,output,error){assert(!FS.initialized,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),FS.initialized=!0,input??=Module.stdin,output??=Module.stdout,error??=Module.stderr,FS.createStandardStreams(input,output,error)},quit(){FS.initialized=!1,_fflush(0);for(var i=0;i<FS.streams.length;i++){var stream=FS.streams[i];stream&&FS.close(stream)}},findObject(path,dontResolveLastLink){var ret=FS.analyzePath(path,dontResolveLastLink);return ret.exists?ret.object:null},analyzePath(path,dontResolveLastLink){try{path=(lookup=FS.lookupPath(path,{follow:!dontResolveLastLink})).path}catch(e){}var ret={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var lookup=FS.lookupPath(path,{parent:!0});ret.parentExists=!0,ret.parentPath=lookup.path,ret.parentObject=lookup.node,ret.name=PATH.basename(path),lookup=FS.lookupPath(path,{follow:!dontResolveLastLink}),ret.exists=!0,ret.path=lookup.path,ret.object=lookup.node,ret.name=lookup.node.name,ret.isRoot="/"===lookup.path}catch(e){ret.error=e.errno}return ret},createPath(parent,path,canRead,canWrite){parent="string"==typeof parent?parent:FS.getPath(parent);for(var parts=path.split("/").reverse();parts.length;){var part=parts.pop();if(part){var current=PATH.join2(parent,part);try{FS.mkdir(current)}catch(e){}parent=current}}return current},createFile(parent,name,properties,canRead,canWrite){var path=PATH.join2("string"==typeof parent?parent:FS.getPath(parent),name),mode=FS_getMode(canRead,canWrite);return FS.create(path,mode)},createDataFile(parent,name,data,canRead,canWrite,canOwn){var path=name;parent&&(parent="string"==typeof parent?parent:FS.getPath(parent),path=name?PATH.join2(parent,name):parent);var mode=FS_getMode(canRead,canWrite),node=FS.create(path,mode);if(data){if("string"==typeof data){for(var arr=new Array(data.length),i=0,len=data.length;i<len;++i)arr[i]=data.charCodeAt(i);data=arr}FS.chmod(node,146|mode);var stream=FS.open(node,577);FS.write(stream,data,0,data.length,0,canOwn),FS.close(stream),FS.chmod(node,mode)}},createDevice(parent,name,input,output){var path=PATH.join2("string"==typeof parent?parent:FS.getPath(parent),name),mode=FS_getMode(!!input,!!output);FS.createDevice.major??=64;var dev=FS.makedev(FS.createDevice.major++,0);return FS.registerDevice(dev,{open(stream){stream.seekable=!1},close(stream){output?.buffer?.length&&output(10)},read(stream,buffer,offset,length,pos){for(var bytesRead=0,i=0;i<length;i++){var result;try{result=input()}catch(e){throw new FS.ErrnoError(29)}if(void 0===result&&0===bytesRead)throw new FS.ErrnoError(6);if(null==result)break;bytesRead++,buffer[offset+i]=result}return bytesRead&&(stream.node.timestamp=Date.now()),bytesRead},write(stream,buffer,offset,length,pos){for(var i=0;i<length;i++)try{output(buffer[offset+i])}catch(e){throw new FS.ErrnoError(29)}return length&&(stream.node.timestamp=Date.now()),i}}),FS.mkdev(path,mode,dev)},forceLoadFile(obj){if(obj.isDevice||obj.isFolder||obj.link||obj.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");try{obj.contents=readBinary(obj.url),obj.usedBytes=obj.contents.length}catch(e){throw new FS.ErrnoError(29)}},createLazyFile(parent,name,url,canRead,canWrite){class LazyUint8Array{lengthKnown=!1;chunks=[];get(idx){if(!(idx>this.length-1||idx<0)){var chunkOffset=idx%this.chunkSize,chunkNum=idx/this.chunkSize|0;return this.getter(chunkNum)[chunkOffset]}}setDataGetter(getter){this.getter=getter}cacheLength(){var xhr=new XMLHttpRequest;if(xhr.open("HEAD",url,!1),xhr.send(null),!(xhr.status>=200&&xhr.status<300||304===xhr.status))throw new Error("Couldn't load "+url+". Status: "+xhr.status);var header,datalength=Number(xhr.getResponseHeader("Content-length")),hasByteServing=(header=xhr.getResponseHeader("Accept-Ranges"))&&"bytes"===header,usesGzip=(header=xhr.getResponseHeader("Content-Encoding"))&&"gzip"===header,chunkSize=1048576;hasByteServing||(chunkSize=datalength);var lazyArray=this;lazyArray.setDataGetter((chunkNum=>{var start=chunkNum*chunkSize,end=(chunkNum+1)*chunkSize-1;if(end=Math.min(end,datalength-1),void 0===lazyArray.chunks[chunkNum]&&(lazyArray.chunks[chunkNum]=((from,to)=>{if(from>to)throw new Error("invalid range ("+from+", "+to+") or no bytes requested!");if(to>datalength-1)throw new Error("only "+datalength+" bytes available! programmer error!");var xhr=new XMLHttpRequest;if(xhr.open("GET",url,!1),datalength!==chunkSize&&xhr.setRequestHeader("Range","bytes="+from+"-"+to),xhr.responseType="arraybuffer",xhr.overrideMimeType&&xhr.overrideMimeType("text/plain; charset=x-user-defined"),xhr.send(null),!(xhr.status>=200&&xhr.status<300||304===xhr.status))throw new Error("Couldn't load "+url+". Status: "+xhr.status);return void 0!==xhr.response?new Uint8Array(xhr.response||[]):intArrayFromString(xhr.responseText||"",!0)})(start,end)),void 0===lazyArray.chunks[chunkNum])throw new Error("doXHR failed!");return lazyArray.chunks[chunkNum]})),!usesGzip&&datalength||(chunkSize=datalength=1,datalength=this.getter(0).length,chunkSize=datalength,out("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=datalength,this._chunkSize=chunkSize,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if("undefined"!=typeof XMLHttpRequest){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var properties={isDevice:!1,contents:new LazyUint8Array}}else properties={isDevice:!1,url:url};var node=FS.createFile(parent,name,properties,canRead,canWrite);properties.contents?node.contents=properties.contents:properties.url&&(node.contents=null,node.url=properties.url),Object.defineProperties(node,{usedBytes:{get:function(){return this.contents.length}}});var stream_ops={};function writeChunks(stream,buffer,offset,length,position){var contents=stream.node.contents;if(position>=contents.length)return 0;var size=Math.min(contents.length-position,length);if(assert(size>=0),contents.slice)for(var i=0;i<size;i++)buffer[offset+i]=contents[position+i];else for(i=0;i<size;i++)buffer[offset+i]=contents.get(position+i);return size}return Object.keys(node.stream_ops).forEach((key=>{var fn=node.stream_ops[key];stream_ops[key]=(...args)=>(FS.forceLoadFile(node),fn(...args))})),stream_ops.read=(stream,buffer,offset,length,position)=>(FS.forceLoadFile(node),writeChunks(stream,buffer,offset,length,position)),stream_ops.mmap=(stream,length,position,prot,flags)=>{FS.forceLoadFile(node);var ptr=mmapAlloc();if(!ptr)throw new FS.ErrnoError(48);return writeChunks(stream,HEAP8,ptr,length,position),{ptr:ptr,allocated:!0}},node.stream_ops=stream_ops,node},absolutePath(){abort("FS.absolutePath has been removed; use PATH_FS.resolve instead")},createFolder(){abort("FS.createFolder has been removed; use FS.mkdir instead")},createLink(){abort("FS.createLink has been removed; use FS.symlink instead")},joinPath(){abort("FS.joinPath has been removed; use PATH.join instead")},mmapAlloc(){abort("FS.mmapAlloc has been replaced by the top level function mmapAlloc")},standardizePath(){abort("FS.standardizePath has been removed; use PATH.normalize instead")}},SYSCALLS={DEFAULT_POLLMASK:5,calculateAt(dirfd,path,allowEmpty){if(PATH.isAbs(path))return path;var dir;-100===dirfd?dir=FS.cwd():dir=SYSCALLS.getStreamFromFD(dirfd).path;if(0==path.length){if(!allowEmpty)throw new FS.ErrnoError(44);return dir}return PATH.join2(dir,path)},doStat(func,path,buf){var stat=func(path);HEAP32[buf>>2]=stat.dev,HEAP32[buf+4>>2]=stat.mode,HEAPU32[buf+8>>2]=stat.nlink,HEAP32[buf+12>>2]=stat.uid,HEAP32[buf+16>>2]=stat.gid,HEAP32[buf+20>>2]=stat.rdev,HEAP64[buf+24>>3]=BigInt(stat.size),HEAP32[buf+32>>2]=4096,HEAP32[buf+36>>2]=stat.blocks;var atime=stat.atime.getTime(),mtime=stat.mtime.getTime(),ctime=stat.ctime.getTime();return HEAP64[buf+40>>3]=BigInt(Math.floor(atime/1e3)),HEAPU32[buf+48>>2]=atime%1e3*1e3*1e3,HEAP64[buf+56>>3]=BigInt(Math.floor(mtime/1e3)),HEAPU32[buf+64>>2]=mtime%1e3*1e3*1e3,HEAP64[buf+72>>3]=BigInt(Math.floor(ctime/1e3)),HEAPU32[buf+80>>2]=ctime%1e3*1e3*1e3,HEAP64[buf+88>>3]=BigInt(stat.ino),0},doMsync(addr,stream,len,flags,offset){if(!FS.isFile(stream.node.mode))throw new FS.ErrnoError(43);if(2&flags)return 0;var buffer=HEAPU8.slice(addr,addr+len);FS.msync(stream,buffer,offset,len,flags)},getStreamFromFD:fd=>FS.getStreamChecked(fd),varargs:void 0,getStr:ptr=>UTF8ToString(ptr)},SOCKFS={websocketArgs:{},callbacks:{},on(event,callback){SOCKFS.callbacks[event]=callback},emit(event,param){SOCKFS.callbacks[event]?.(param)},mount:mount=>(SOCKFS.websocketArgs=Module.websocket||{},(Module.websocket??={}).on=SOCKFS.on,FS.createNode(null,"/",16895,0)),createSocket(family,type,protocol){if(1==(type&=-526337)&&protocol&&6!=protocol)throw new FS.ErrnoError(66);var sock={family:family,type:type,protocol:protocol,server:null,error:null,peers:{},pending:[],recv_queue:[],sock_ops:SOCKFS.websocket_sock_ops},name=SOCKFS.nextname(),node=FS.createNode(SOCKFS.root,name,49152,0);node.sock=sock;var stream=FS.createStream({path:name,node:node,flags:2,seekable:!1,stream_ops:SOCKFS.stream_ops});return sock.stream=stream,sock},getSocket(fd){var stream=FS.getStream(fd);return stream&&FS.isSocket(stream.node.mode)?stream.node.sock:null},stream_ops:{poll(stream){var sock=stream.node.sock;return sock.sock_ops.poll(sock)},ioctl(stream,request,varargs){var sock=stream.node.sock;return sock.sock_ops.ioctl(sock,request,varargs)},read(stream,buffer,offset,length,position){var sock=stream.node.sock,msg=sock.sock_ops.recvmsg(sock,length);return msg?(buffer.set(msg.buffer,offset),msg.buffer.length):0},write(stream,buffer,offset,length,position){var sock=stream.node.sock;return sock.sock_ops.sendmsg(sock,buffer,offset,length)},close(stream){var sock=stream.node.sock;sock.sock_ops.close(sock)}},nextname:()=>(SOCKFS.nextname.current||(SOCKFS.nextname.current=0),`socket[${SOCKFS.nextname.current++}]`),websocket_sock_ops:{createPeer(sock,addr,port){var ws;if("object"==typeof addr&&(ws=addr,addr=null,port=null),ws)if(ws._socket)addr=ws._socket.remoteAddress,port=ws._socket.remotePort;else{var result=/ws[s]?:\/\/([^:]+):(\d+)/.exec(ws.url);if(!result)throw new Error("WebSocket URL must be in the format ws(s)://address:port");addr=result[1],port=parseInt(result[2],10)}else try{var url="ws:#".replace("#","//"),subProtocols="binary",opts=void 0;if(SOCKFS.websocketArgs.url&&(url=SOCKFS.websocketArgs.url),SOCKFS.websocketArgs.subprotocol?subProtocols=SOCKFS.websocketArgs.subprotocol:null===SOCKFS.websocketArgs.subprotocol&&(subProtocols="null"),"ws://"===url||"wss://"===url){var parts=addr.split("/");url=url+parts[0]+":"+port+"/"+parts.slice(1).join("/")}"null"!==subProtocols&&(opts=subProtocols=subProtocols.replace(/^ +| +$/g,"").split(/ *, */)),(ws=new WebSocket(url,opts)).binaryType="arraybuffer"}catch(e){throw new FS.ErrnoError(23)}var peer={addr:addr,port:port,socket:ws,msg_send_queue:[]};return SOCKFS.websocket_sock_ops.addPeer(sock,peer),SOCKFS.websocket_sock_ops.handlePeerEvents(sock,peer),2===sock.type&&void 0!==sock.sport&&peer.msg_send_queue.push(new Uint8Array([255,255,255,255,"p".charCodeAt(0),"o".charCodeAt(0),"r".charCodeAt(0),"t".charCodeAt(0),(65280&sock.sport)>>8,255&sock.sport])),peer},getPeer:(sock,addr,port)=>sock.peers[addr+":"+port],addPeer(sock,peer){sock.peers[peer.addr+":"+peer.port]=peer},removePeer(sock,peer){delete sock.peers[peer.addr+":"+peer.port]},handlePeerEvents(sock,peer){var first=!0,handleOpen=function(){sock.connecting=!1,SOCKFS.emit("open",sock.stream.fd);try{for(var queued=peer.msg_send_queue.shift();queued;)peer.socket.send(queued),queued=peer.msg_send_queue.shift()}catch(e){peer.socket.close()}};function handleMessage(data){if("string"==typeof data){data=(new TextEncoder).encode(data)}else{if(assert(void 0!==data.byteLength),0==data.byteLength)return;data=new Uint8Array(data)}var wasfirst=first;if(first=!1,wasfirst&&10===data.length&&255===data[0]&&255===data[1]&&255===data[2]&&255===data[3]&&data[4]==="p".charCodeAt(0)&&data[5]==="o".charCodeAt(0)&&data[6]==="r".charCodeAt(0)&&data[7]==="t".charCodeAt(0)){var newport=data[8]<<8|data[9];return SOCKFS.websocket_sock_ops.removePeer(sock,peer),peer.port=newport,void SOCKFS.websocket_sock_ops.addPeer(sock,peer)}sock.recv_queue.push({addr:peer.addr,port:peer.port,data:data}),SOCKFS.emit("message",sock.stream.fd)}ENVIRONMENT_IS_NODE?(peer.socket.on("open",handleOpen),peer.socket.on("message",(function(data,isBinary){isBinary&&handleMessage(new Uint8Array(data).buffer)})),peer.socket.on("close",(function(){SOCKFS.emit("close",sock.stream.fd)})),peer.socket.on("error",(function(error){sock.error=14,SOCKFS.emit("error",[sock.stream.fd,sock.error,"ECONNREFUSED: Connection refused"])}))):(peer.socket.onopen=handleOpen,peer.socket.onclose=function(){SOCKFS.emit("close",sock.stream.fd)},peer.socket.onmessage=function(event){handleMessage(event.data)},peer.socket.onerror=function(error){sock.error=14,SOCKFS.emit("error",[sock.stream.fd,sock.error,"ECONNREFUSED: Connection refused"])})},poll(sock){if(1===sock.type&&sock.server)return sock.pending.length?65:0;var mask=0,dest=1===sock.type?SOCKFS.websocket_sock_ops.getPeer(sock,sock.daddr,sock.dport):null;return(sock.recv_queue.length||!dest||dest&&dest.socket.readyState===dest.socket.CLOSING||dest&&dest.socket.readyState===dest.socket.CLOSED)&&(mask|=65),(!dest||dest&&dest.socket.readyState===dest.socket.OPEN)&&(mask|=4),(dest&&dest.socket.readyState===dest.socket.CLOSING||dest&&dest.socket.readyState===dest.socket.CLOSED)&&(sock.connecting?mask|=4:mask|=16),mask},ioctl(sock,request,arg){if(21531===request){var bytes=0;return sock.recv_queue.length&&(bytes=sock.recv_queue[0].data.length),HEAP32[arg>>2]=bytes,0}return 28},close(sock){if(sock.server){try{sock.server.close()}catch(e){}sock.server=null}for(var peers=Object.keys(sock.peers),i=0;i<peers.length;i++){var peer=sock.peers[peers[i]];try{peer.socket.close()}catch(e){}SOCKFS.websocket_sock_ops.removePeer(sock,peer)}return 0},bind(sock,addr,port){if(void 0!==sock.saddr||void 0!==sock.sport)throw new FS.ErrnoError(28);if(sock.saddr=addr,sock.sport=port,2===sock.type){sock.server&&(sock.server.close(),sock.server=null);try{sock.sock_ops.listen(sock,0)}catch(e){if("ErrnoError"!==e.name)throw e;if(138!==e.errno)throw e}}},connect(sock,addr,port){if(sock.server)throw new FS.ErrnoError(138);if(void 0!==sock.daddr&&void 0!==sock.dport){var dest=SOCKFS.websocket_sock_ops.getPeer(sock,sock.daddr,sock.dport);if(dest)throw dest.socket.readyState===dest.socket.CONNECTING?new FS.ErrnoError(7):new FS.ErrnoError(30)}var peer=SOCKFS.websocket_sock_ops.createPeer(sock,addr,port);sock.daddr=peer.addr,sock.dport=peer.port,sock.connecting=!0},listen(sock,backlog){if(!ENVIRONMENT_IS_NODE)throw new FS.ErrnoError(138)},accept(listensock){if(!listensock.server||!listensock.pending.length)throw new FS.ErrnoError(28);var newsock=listensock.pending.shift();return newsock.stream.flags=listensock.stream.flags,newsock},getname(sock,peer){var addr,port;if(peer){if(void 0===sock.daddr||void 0===sock.dport)throw new FS.ErrnoError(53);addr=sock.daddr,port=sock.dport}else addr=sock.saddr||0,port=sock.sport||0;return{addr:addr,port:port}},sendmsg(sock,buffer,offset,length,addr,port){if(2===sock.type){if(void 0!==addr&&void 0!==port||(addr=sock.daddr,port=sock.dport),void 0===addr||void 0===port)throw new FS.ErrnoError(17)}else addr=sock.daddr,port=sock.dport;var dest=SOCKFS.websocket_sock_ops.getPeer(sock,addr,port);if(1===sock.type&&(!dest||dest.socket.readyState===dest.socket.CLOSING||dest.socket.readyState===dest.socket.CLOSED))throw new FS.ErrnoError(53);ArrayBuffer.isView(buffer)&&(offset+=buffer.byteOffset,buffer=buffer.buffer);var data=buffer.slice(offset,offset+length);if(!dest||dest.socket.readyState!==dest.socket.OPEN)return 2===sock.type&&(dest&&dest.socket.readyState!==dest.socket.CLOSING&&dest.socket.readyState!==dest.socket.CLOSED||(dest=SOCKFS.websocket_sock_ops.createPeer(sock,addr,port))),dest.msg_send_queue.push(data),length;try{return dest.socket.send(data),length}catch(e){throw new FS.ErrnoError(28)}},recvmsg(sock,length){if(1===sock.type&&sock.server)throw new FS.ErrnoError(53);var queued=sock.recv_queue.shift();if(!queued){if(1===sock.type){var dest=SOCKFS.websocket_sock_ops.getPeer(sock,sock.daddr,sock.dport);if(!dest)throw new FS.ErrnoError(53);if(dest.socket.readyState===dest.socket.CLOSING||dest.socket.readyState===dest.socket.CLOSED)return null;throw new FS.ErrnoError(6)}throw new FS.ErrnoError(6)}var queuedLength=queued.data.byteLength||queued.data.length,queuedOffset=queued.data.byteOffset||0,queuedBuffer=queued.data.buffer||queued.data,bytesRead=Math.min(length,queuedLength),res={buffer:new Uint8Array(queuedBuffer,queuedOffset,bytesRead),addr:queued.addr,port:queued.port};if(1===sock.type&&bytesRead<queuedLength){var bytesRemaining=queuedLength-bytesRead;queued.data=new Uint8Array(queuedBuffer,queuedOffset+bytesRead,bytesRemaining),sock.recv_queue.unshift(queued)}return res}}},getSocketFromFD=fd=>{var socket=SOCKFS.getSocket(fd);if(!socket)throw new FS.ErrnoError(8);return socket},inetPton4=str=>{for(var b=str.split("."),i=0;i<4;i++){var tmp=Number(b[i]);if(isNaN(tmp))return null;b[i]=tmp}return(b[0]|b[1]<<8|b[2]<<16|b[3]<<24)>>>0},jstoi_q=str=>parseInt(str),inetPton6=str=>{var words,w,offset,z,parts=[];if(!/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i.test(str))return null;if("::"===str)return[0,0,0,0,0,0,0,0];for((str=str.startsWith("::")?str.replace("::","Z:"):str.replace("::",":Z:")).indexOf(".")>0?((words=(str=str.replace(new RegExp("[.]","g"),":")).split(":"))[words.length-4]=jstoi_q(words[words.length-4])+256*jstoi_q(words[words.length-3]),words[words.length-3]=jstoi_q(words[words.length-2])+256*jstoi_q(words[words.length-1]),words=words.slice(0,words.length-2)):words=str.split(":"),offset=0,z=0,w=0;w<words.length;w++)if("string"==typeof words[w])if("Z"===words[w]){for(z=0;z<8-words.length+1;z++)parts[w+z]=0;offset=z-1}else parts[w+offset]=_htons(parseInt(words[w],16));else parts[w+offset]=words[w];return[parts[1]<<16|parts[0],parts[3]<<16|parts[2],parts[5]<<16|parts[4],parts[7]<<16|parts[6]]},writeSockaddr=(sa,family,addr,port,addrlen)=>{switch(family){case 2:addr=inetPton4(addr),zeroMemory(sa,16),addrlen&&(HEAP32[addrlen>>2]=16),HEAP16[sa>>1]=family,HEAP32[sa+4>>2]=addr,HEAP16[sa+2>>1]=_htons(port);break;case 10:addr=inetPton6(addr),zeroMemory(sa,28),addrlen&&(HEAP32[addrlen>>2]=28),HEAP32[sa>>2]=family,HEAP32[sa+8>>2]=addr[0],HEAP32[sa+12>>2]=addr[1],HEAP32[sa+16>>2]=addr[2],HEAP32[sa+20>>2]=addr[3],HEAP16[sa+2>>1]=_htons(port);break;default:return 5}return 0},DNS={address_map:{id:1,addrs:{},names:{}},lookup_name(name){var addr,res=inetPton4(name);if(null!==res)return name;if(null!==(res=inetPton6(name)))return name;if(DNS.address_map.addrs[name])addr=DNS.address_map.addrs[name];else{var id=DNS.address_map.id++;assert(id<65535,"exceeded max address mappings of 65535"),addr="172.29."+(255&id)+"."+(65280&id),DNS.address_map.names[addr]=name,DNS.address_map.addrs[name]=addr}return addr},lookup_addr:addr=>DNS.address_map.names[addr]?DNS.address_map.names[addr]:null};var inetNtop4=addr=>(255&addr)+"."+(addr>>8&255)+"."+(addr>>16&255)+"."+(addr>>24&255),inetNtop6=ints=>{var str="",word=0,longest=0,lastzero=0,zstart=0,len=0,i=0,parts=[65535&ints[0],ints[0]>>16,65535&ints[1],ints[1]>>16,65535&ints[2],ints[2]>>16,65535&ints[3],ints[3]>>16],hasipv4=!0,v4part="";for(i=0;i<5;i++)if(0!==parts[i]){hasipv4=!1;break}if(hasipv4){if(v4part=inetNtop4(parts[6]|parts[7]<<16),-1===parts[5])return str="::ffff:",str+=v4part;if(0===parts[5])return str="::","0.0.0.0"===v4part&&(v4part=""),"0.0.0.1"===v4part&&(v4part="1"),str+=v4part}for(word=0;word<8;word++)0===parts[word]&&(word-lastzero>1&&(len=0),lastzero=word,len++),len>longest&&(zstart=word-(longest=len)+1);for(word=0;word<8;word++)longest>1&&0===parts[word]&&word>=zstart&&word<zstart+longest?word===zstart&&(str+=":",0===zstart&&(str+=":")):(str+=Number(_ntohs(65535&parts[word])).toString(16),str+=word<7?":":"");return str},readSockaddr=(sa,salen)=>{var addr,family=HEAP16[sa>>1],port=_ntohs(HEAPU16[sa+2>>1]);switch(family){case 2:if(16!==salen)return{errno:28};addr=HEAP32[sa+4>>2],addr=inetNtop4(addr);break;case 10:if(28!==salen)return{errno:28};addr=[HEAP32[sa+8>>2],HEAP32[sa+12>>2],HEAP32[sa+16>>2],HEAP32[sa+20>>2]],addr=inetNtop6(addr);break;default:return{errno:5}}return{family:family,addr:addr,port:port}},getSocketAddress=(addrp,addrlen)=>{var info=readSockaddr(addrp,addrlen);if(info.errno)throw new FS.ErrnoError(info.errno);return info.addr=DNS.lookup_addr(info.addr)||info.addr,info};var syscallGetVarargI=()=>{assert(null!=SYSCALLS.varargs);var ret=HEAP32[+SYSCALLS.varargs>>2];return SYSCALLS.varargs+=4,ret},syscallGetVarargP=syscallGetVarargI;var bigintToI53Checked=num=>num<-9007199254740992||num>9007199254740992?NaN:Number(num);var stringToUTF8=(str,outPtr,maxBytesToWrite)=>(assert("number"==typeof maxBytesToWrite,"stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),stringToUTF8Array(str,HEAPU8,outPtr,maxBytesToWrite));var runtimeKeepaliveCounter=0,__emscripten_runtime_keepalive_clear=()=>{noExitRuntime=!1,runtimeKeepaliveCounter=0};var MONTH_DAYS_LEAP_CUMULATIVE=[0,31,60,91,121,152,182,213,244,274,305,335],MONTH_DAYS_REGULAR_CUMULATIVE=[0,31,59,90,120,151,181,212,243,273,304,334];var GLctx,timers={},handleException=e=>{if(e instanceof ExitStatus||"unwind"==e)return EXITSTATUS;checkStackCookie(),quit_(0,e)},keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0,_proc_exit=code=>{EXITSTATUS=code,keepRuntimeAlive()||(Module.onExit?.(code),ABORT=!0),quit_(0,new ExitStatus(code))},exitJS=(status,implicit)=>{if(EXITSTATUS=status,keepRuntimeAlive()||(assert(!runtimeExited),checkStackCookie(),___funcs_on_exit(),callRuntimeCallbacks(__ATEXIT__),FS.quit(),TTY.shutdown(),IDBFS.quit(),runtimeExited=!0),keepRuntimeAlive()&&!implicit){var msg=`program exited (with status: ${status}), but keepRuntimeAlive() is set (counter=${runtimeKeepaliveCounter}) due to an async operation, so halting execution but not exiting the runtime or preventing further async execution (you can use emscripten_force_exit, if you want to force a true shutdown)`;readyPromiseReject(msg),err(msg)}_proc_exit(status)},_exit=exitJS,maybeExit=()=>{if(!runtimeExited&&!keepRuntimeAlive())try{_exit(EXITSTATUS)}catch(e){handleException(e)}},callUserCallback=func=>{if(runtimeExited||ABORT)err("user callback triggered after runtime exited or application aborted.  Ignoring.");else try{func(),maybeExit()}catch(e){handleException(e)}},_emscripten_get_now=()=>performance.now(),_emscripten_set_main_loop_timing=(mode,value)=>{if(MainLoop.timingMode=mode,MainLoop.timingValue=value,!MainLoop.func)return err("emscripten_set_main_loop_timing: Cannot set timing mode for main loop since a main loop does not exist! Call emscripten_set_main_loop first to set one up."),1;if(MainLoop.running||(runtimeKeepaliveCounter+=1,MainLoop.running=!0),0==mode)MainLoop.scheduler=function(){var timeUntilNextTick=0|Math.max(0,MainLoop.tickStartTime+value-_emscripten_get_now());setTimeout(MainLoop.runner,timeUntilNextTick)},MainLoop.method="timeout";else if(1==mode)MainLoop.scheduler=function(){MainLoop.requestAnimationFrame(MainLoop.runner)},MainLoop.method="rAF";else if(2==mode){if(void 0===MainLoop.setImmediate)if("undefined"==typeof setImmediate){var setImmediates=[];addEventListener("message",(event=>{"setimmediate"!==event.data&&"setimmediate"!==event.data.target||(event.stopPropagation(),setImmediates.shift()())}),!0),MainLoop.setImmediate=func=>{setImmediates.push(func),ENVIRONMENT_IS_WORKER?(Module.setImmediates??=[],Module.setImmediates.push(func),postMessage({target:"setimmediate"})):postMessage("setimmediate","*")}}else MainLoop.setImmediate=setImmediate;MainLoop.scheduler=function(){MainLoop.setImmediate(MainLoop.runner)},MainLoop.method="immediate"}return 0},webgl_enable_ANGLE_instanced_arrays=ctx=>{var ext=ctx.getExtension("ANGLE_instanced_arrays");if(ext)return ctx.vertexAttribDivisor=(index,divisor)=>ext.vertexAttribDivisorANGLE(index,divisor),ctx.drawArraysInstanced=(mode,first,count,primcount)=>ext.drawArraysInstancedANGLE(mode,first,count,primcount),ctx.drawElementsInstanced=(mode,count,type,indices,primcount)=>ext.drawElementsInstancedANGLE(mode,count,type,indices,primcount),1},webgl_enable_OES_vertex_array_object=ctx=>{var ext=ctx.getExtension("OES_vertex_array_object");if(ext)return ctx.createVertexArray=()=>ext.createVertexArrayOES(),ctx.deleteVertexArray=vao=>ext.deleteVertexArrayOES(vao),ctx.bindVertexArray=vao=>ext.bindVertexArrayOES(vao),ctx.isVertexArray=vao=>ext.isVertexArrayOES(vao),1},webgl_enable_WEBGL_draw_buffers=ctx=>{var ext=ctx.getExtension("WEBGL_draw_buffers");if(ext)return ctx.drawBuffers=(n,bufs)=>ext.drawBuffersWEBGL(n,bufs),1},webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance=ctx=>!!(ctx.dibvbi=ctx.getExtension("WEBGL_draw_instanced_base_vertex_base_instance")),webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance=ctx=>!!(ctx.mdibvbi=ctx.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")),webgl_enable_EXT_polygon_offset_clamp=ctx=>!!(ctx.extPolygonOffsetClamp=ctx.getExtension("EXT_polygon_offset_clamp")),webgl_enable_EXT_clip_control=ctx=>!!(ctx.extClipControl=ctx.getExtension("EXT_clip_control")),webgl_enable_WEBGL_polygon_mode=ctx=>!!(ctx.webglPolygonMode=ctx.getExtension("WEBGL_polygon_mode")),webgl_enable_WEBGL_multi_draw=ctx=>!!(ctx.multiDrawWebgl=ctx.getExtension("WEBGL_multi_draw")),getEmscriptenSupportedExtensions=ctx=>{var supportedExtensions=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_disjoint_timer_query","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","OES_element_index_uint","OES_fbo_render_mipmap","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_depth_texture","WEBGL_draw_buffers","EXT_color_buffer_float","EXT_conservative_depth","EXT_disjoint_timer_query_webgl2","EXT_texture_norm16","NV_shader_noperspective_interpolation","WEBGL_clip_cull_distance","EXT_clip_control","EXT_color_buffer_half_float","EXT_depth_clamp","EXT_float_blend","EXT_polygon_offset_clamp","EXT_texture_compression_bptc","EXT_texture_compression_rgtc","EXT_texture_filter_anisotropic","KHR_parallel_shader_compile","OES_texture_float_linear","WEBGL_blend_func_extended","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","WEBGL_multi_draw","WEBGL_polygon_mode"];return(ctx.getSupportedExtensions()||[]).filter((ext=>supportedExtensions.includes(ext)))},GL={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],samplers:[],transformFeedbacks:[],syncs:[],stringCache:{},stringiCache:{},unpackAlignment:4,unpackRowLength:0,recordError:errorCode=>{GL.lastError||(GL.lastError=errorCode)},getNewId:table=>{for(var ret=GL.counter++,i=table.length;i<ret;i++)table[i]=null;return ret},genObject:(n,buffers,createFunction,objectTable)=>{for(var i=0;i<n;i++){var buffer=GLctx[createFunction](),id=buffer&&GL.getNewId(objectTable);buffer?(buffer.name=id,objectTable[id]=buffer):GL.recordError(1282),HEAP32[buffers+4*i>>2]=id}},getSource:(shader,count,string,length)=>{for(var source="",i=0;i<count;++i){var len=length?HEAPU32[length+4*i>>2]:void 0;source+=UTF8ToString(HEAPU32[string+4*i>>2],len)}return source},createContext:(canvas,webGLContextAttributes)=>{webGLContextAttributes.renderViaOffscreenBackBuffer&&(webGLContextAttributes.preserveDrawingBuffer=!0);var ctx=webGLContextAttributes.majorVersion>1?canvas.getContext("webgl2",webGLContextAttributes):canvas.getContext("webgl",webGLContextAttributes);return ctx?GL.registerContext(ctx,webGLContextAttributes):0},enableOffscreenFramebufferAttributes:webGLContextAttributes=>{webGLContextAttributes.renderViaOffscreenBackBuffer=!0,webGLContextAttributes.preserveDrawingBuffer=!0},createOffscreenFramebuffer:context=>{var gl=context.GLctx,fbo=gl.createFramebuffer();gl.bindFramebuffer(36160,fbo),context.defaultFbo=fbo,context.defaultFboForbidBlitFramebuffer=!1,gl.getContextAttributes().antialias&&(context.defaultFboForbidBlitFramebuffer=!0),context.defaultColorTarget=gl.createTexture(),context.defaultDepthTarget=gl.createRenderbuffer(),GL.resizeOffscreenFramebuffer(context),gl.bindTexture(3553,context.defaultColorTarget),gl.texParameteri(3553,10241,9728),gl.texParameteri(3553,10240,9728),gl.texParameteri(3553,10242,33071),gl.texParameteri(3553,10243,33071),gl.texImage2D(3553,0,6408,gl.canvas.width,gl.canvas.height,0,6408,5121,null),gl.framebufferTexture2D(36160,36064,3553,context.defaultColorTarget,0),gl.bindTexture(3553,null);gl.createRenderbuffer();gl.bindRenderbuffer(36161,context.defaultDepthTarget),gl.renderbufferStorage(36161,33189,gl.canvas.width,gl.canvas.height),gl.framebufferRenderbuffer(36160,36096,36161,context.defaultDepthTarget),gl.bindRenderbuffer(36161,null);var vb=gl.createBuffer();gl.bindBuffer(34962,vb),gl.bufferData(34962,new Float32Array([-1,-1,-1,1,1,-1,1,1]),35044),gl.bindBuffer(34962,null),context.blitVB=vb;var vs=gl.createShader(35633);gl.shaderSource(vs,"attribute vec2 pos;varying lowp vec2 tex;void main() { tex = pos * 0.5 + vec2(0.5,0.5); gl_Position = vec4(pos, 0.0, 1.0); }"),gl.compileShader(vs);var fs=gl.createShader(35632);gl.shaderSource(fs,"varying lowp vec2 tex;uniform sampler2D sampler;void main() { gl_FragColor = texture2D(sampler, tex); }"),gl.compileShader(fs);var blitProgram=gl.createProgram();gl.attachShader(blitProgram,vs),gl.attachShader(blitProgram,fs),gl.linkProgram(blitProgram),context.blitProgram=blitProgram,context.blitPosLoc=gl.getAttribLocation(blitProgram,"pos"),gl.useProgram(blitProgram),gl.uniform1i(gl.getUniformLocation(blitProgram,"sampler"),0),gl.useProgram(null),context.defaultVao=void 0,gl.createVertexArray&&(context.defaultVao=gl.createVertexArray(),gl.bindVertexArray(context.defaultVao),gl.enableVertexAttribArray(context.blitPosLoc),gl.bindVertexArray(null))},resizeOffscreenFramebuffer:context=>{var gl=context.GLctx;if(context.defaultColorTarget){var prevTextureBinding=gl.getParameter(32873);gl.bindTexture(3553,context.defaultColorTarget),gl.texImage2D(3553,0,6408,gl.drawingBufferWidth,gl.drawingBufferHeight,0,6408,5121,null),gl.bindTexture(3553,prevTextureBinding)}if(context.defaultDepthTarget){var prevRenderBufferBinding=gl.getParameter(36007);gl.bindRenderbuffer(36161,context.defaultDepthTarget),gl.renderbufferStorage(36161,33189,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.bindRenderbuffer(36161,prevRenderBufferBinding)}},blitOffscreenFramebuffer:context=>{var gl=context.GLctx,prevScissorTest=gl.getParameter(3089);prevScissorTest&&gl.disable(3089);var prevFbo=gl.getParameter(36006);if(gl.blitFramebuffer&&!context.defaultFboForbidBlitFramebuffer)gl.bindFramebuffer(36008,context.defaultFbo),gl.bindFramebuffer(36009,null),gl.blitFramebuffer(0,0,gl.canvas.width,gl.canvas.height,0,0,gl.canvas.width,gl.canvas.height,16384,9728);else{gl.bindFramebuffer(36160,null);var prevProgram=gl.getParameter(35725);gl.useProgram(context.blitProgram);var prevVB=gl.getParameter(34964);gl.bindBuffer(34962,context.blitVB);var prevActiveTexture=gl.getParameter(34016);gl.activeTexture(33984);var prevTextureBinding=gl.getParameter(32873);gl.bindTexture(3553,context.defaultColorTarget);var prevBlend=gl.getParameter(3042);prevBlend&&gl.disable(3042);var prevCullFace=gl.getParameter(2884);prevCullFace&&gl.disable(2884);var prevDepthTest=gl.getParameter(2929);prevDepthTest&&gl.disable(2929);var prevStencilTest=gl.getParameter(2960);function draw(){gl.vertexAttribPointer(context.blitPosLoc,2,5126,!1,0,0),gl.drawArrays(5,0,4)}if(prevStencilTest&&gl.disable(2960),context.defaultVao){var prevVAO=gl.getParameter(34229);gl.bindVertexArray(context.defaultVao),draw(),gl.bindVertexArray(prevVAO)}else{for(var prevVertexAttribPointer={buffer:gl.getVertexAttrib(context.blitPosLoc,34975),size:gl.getVertexAttrib(context.blitPosLoc,34339),stride:gl.getVertexAttrib(context.blitPosLoc,34340),type:gl.getVertexAttrib(context.blitPosLoc,34341),normalized:gl.getVertexAttrib(context.blitPosLoc,34922),pointer:gl.getVertexAttribOffset(context.blitPosLoc,34373)},maxVertexAttribs=gl.getParameter(34921),prevVertexAttribEnables=[],i=0;i<maxVertexAttribs;++i){var prevEnabled=gl.getVertexAttrib(i,34338),wantEnabled=i==context.blitPosLoc;prevEnabled&&!wantEnabled&&gl.disableVertexAttribArray(i),!prevEnabled&&wantEnabled&&gl.enableVertexAttribArray(i),prevVertexAttribEnables[i]=prevEnabled}draw();for(i=0;i<maxVertexAttribs;++i){prevEnabled=prevVertexAttribEnables[i];var nowEnabled=i==context.blitPosLoc;prevEnabled&&!nowEnabled&&gl.enableVertexAttribArray(i),!prevEnabled&&nowEnabled&&gl.disableVertexAttribArray(i)}gl.bindBuffer(34962,prevVertexAttribPointer.buffer),gl.vertexAttribPointer(context.blitPosLoc,prevVertexAttribPointer.size,prevVertexAttribPointer.type,prevVertexAttribPointer.normalized,prevVertexAttribPointer.stride,prevVertexAttribPointer.offset)}prevStencilTest&&gl.enable(2960),prevDepthTest&&gl.enable(2929),prevCullFace&&gl.enable(2884),prevBlend&&gl.enable(3042),gl.bindTexture(3553,prevTextureBinding),gl.activeTexture(prevActiveTexture),gl.bindBuffer(34962,prevVB),gl.useProgram(prevProgram)}gl.bindFramebuffer(36160,prevFbo),prevScissorTest&&gl.enable(3089)},registerContext:(ctx,webGLContextAttributes)=>{var handle=GL.getNewId(GL.contexts),context={handle:handle,attributes:webGLContextAttributes,version:webGLContextAttributes.majorVersion,GLctx:ctx};return ctx.canvas&&(ctx.canvas.GLctxObject=context),GL.contexts[handle]=context,(void 0===webGLContextAttributes.enableExtensionsByDefault||webGLContextAttributes.enableExtensionsByDefault)&&GL.initExtensions(context),webGLContextAttributes.renderViaOffscreenBackBuffer&&GL.createOffscreenFramebuffer(context),handle},makeContextCurrent:contextHandle=>(GL.currentContext=GL.contexts[contextHandle],Module.ctx=GLctx=GL.currentContext?.GLctx,!(contextHandle&&!GLctx)),getContext:contextHandle=>GL.contexts[contextHandle],deleteContext:contextHandle=>{GL.currentContext===GL.contexts[contextHandle]&&(GL.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(GL.contexts[contextHandle].GLctx.canvas),GL.contexts[contextHandle]&&GL.contexts[contextHandle].GLctx.canvas&&(GL.contexts[contextHandle].GLctx.canvas.GLctxObject=void 0),GL.contexts[contextHandle]=null},initExtensions:context=>{if(context||=GL.currentContext,!context.initExtensionsDone){context.initExtensionsDone=!0;var GLctx=context.GLctx;webgl_enable_WEBGL_multi_draw(GLctx),webgl_enable_EXT_polygon_offset_clamp(GLctx),webgl_enable_EXT_clip_control(GLctx),webgl_enable_WEBGL_polygon_mode(GLctx),webgl_enable_ANGLE_instanced_arrays(GLctx),webgl_enable_OES_vertex_array_object(GLctx),webgl_enable_WEBGL_draw_buffers(GLctx),webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance(GLctx),webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance(GLctx),context.version>=2&&(GLctx.disjointTimerQueryExt=GLctx.getExtension("EXT_disjoint_timer_query_webgl2")),(context.version<2||!GLctx.disjointTimerQueryExt)&&(GLctx.disjointTimerQueryExt=GLctx.getExtension("EXT_disjoint_timer_query")),getEmscriptenSupportedExtensions(GLctx).forEach((ext=>{ext.includes("lose_context")||ext.includes("debug")||GLctx.getExtension(ext)}))}}},_emscripten_webgl_commit_frame=()=>GL.currentContext&&GL.currentContext.GLctx?GL.currentContext.defaultFbo?(GL.blitOffscreenFramebuffer(GL.currentContext),0):GL.currentContext.attributes.explicitSwapControl?0:-3:-3,setMainLoop=(iterFunc,fps,simulateInfiniteLoop,arg,noSetTiming)=>{assert(!MainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),MainLoop.func=iterFunc,MainLoop.arg=arg;var thisMainLoopId=MainLoop.currentlyRunningMainloop;function checkIsRunning(){return!(thisMainLoopId<MainLoop.currentlyRunningMainloop)||(assert(runtimeKeepaliveCounter>0),runtimeKeepaliveCounter-=1,maybeExit(),!1)}if(MainLoop.running=!1,MainLoop.runner=function(){if(!ABORT)if(MainLoop.queue.length>0){Date.now();var blocker=MainLoop.queue.shift();if(blocker.func(blocker.arg),MainLoop.remainingBlockers){var remaining=MainLoop.remainingBlockers,next=remaining%1==0?remaining-1:Math.floor(remaining);blocker.counted?MainLoop.remainingBlockers=next:(next+=.5,MainLoop.remainingBlockers=(8*remaining+next)/9)}if(MainLoop.updateStatus(),!checkIsRunning())return;setTimeout(MainLoop.runner,0)}else checkIsRunning()&&(MainLoop.currentFrameNumber=MainLoop.currentFrameNumber+1|0,1==MainLoop.timingMode&&MainLoop.timingValue>1&&MainLoop.currentFrameNumber%MainLoop.timingValue!=0?MainLoop.scheduler():(0==MainLoop.timingMode&&(MainLoop.tickStartTime=_emscripten_get_now()),"timeout"===MainLoop.method&&Module.ctx&&(warnOnce("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),MainLoop.method=""),MainLoop.runIter(iterFunc),checkIsRunning()&&MainLoop.scheduler()))},noSetTiming||(fps&&fps>0?_emscripten_set_main_loop_timing(0,1e3/fps):_emscripten_set_main_loop_timing(1,1),MainLoop.scheduler()),simulateInfiniteLoop)throw"unwind"},MainLoop={running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],preMainLoop:[],postMainLoop:[],pause(){MainLoop.scheduler=null,MainLoop.currentlyRunningMainloop++},resume(){MainLoop.currentlyRunningMainloop++;var timingMode=MainLoop.timingMode,timingValue=MainLoop.timingValue,func=MainLoop.func;MainLoop.func=null,setMainLoop(func,0,!1,MainLoop.arg,!0),_emscripten_set_main_loop_timing(timingMode,timingValue),MainLoop.scheduler()},updateStatus(){if(Module.setStatus){var message=Module.statusMessage||"Please wait...",remaining=MainLoop.remainingBlockers??0,expected=MainLoop.expectedBlockers??0;remaining?remaining<expected?Module.setStatus("{message} ({expected - remaining}/{expected})"):Module.setStatus(message):Module.setStatus("")}},init(){Module.preMainLoop&&MainLoop.preMainLoop.push(Module.preMainLoop),Module.postMainLoop&&MainLoop.postMainLoop.push(Module.postMainLoop)},runIter(func){if(!ABORT){for(var pre of MainLoop.preMainLoop)if(!1===pre())return;for(var post of(callUserCallback(func),MainLoop.postMainLoop))post();checkStackCookie()}},nextRAF:0,fakeRequestAnimationFrame(func){var now=Date.now();if(0===MainLoop.nextRAF)MainLoop.nextRAF=now+1e3/60;else for(;now+2>=MainLoop.nextRAF;)MainLoop.nextRAF+=1e3/60;var delay=Math.max(MainLoop.nextRAF-now,0);setTimeout(func,delay)},requestAnimationFrame(func){"function"!=typeof requestAnimationFrame?(0,MainLoop.fakeRequestAnimationFrame)(func):requestAnimationFrame(func)}},growMemory=size=>{var b=wasmMemory.buffer,pages=(size-b.byteLength+65535)/65536|0;try{return wasmMemory.grow(pages),updateMemoryViews(),1}catch(e){err(`growMemory: Attempted to grow heap from ${b.byteLength} bytes to ${size} bytes, but got error: ${e}`)}},JSEvents={memcpy(target,src,size){HEAP8.set(HEAP8.subarray(src,src+size),target)},removeAllEventListeners(){for(;JSEvents.eventHandlers.length;)JSEvents._removeHandler(JSEvents.eventHandlers.length-1);JSEvents.deferredCalls=[]},registerRemoveEventListeners(){JSEvents.removeEventListenersRegistered||(__ATEXIT__.push(JSEvents.removeAllEventListeners),JSEvents.removeEventListenersRegistered=!0)},inEventHandler:0,deferredCalls:[],deferCall(targetFunction,precedence,argsList){function arraysHaveEqualContent(arrA,arrB){if(arrA.length!=arrB.length)return!1;for(var i in arrA)if(arrA[i]!=arrB[i])return!1;return!0}for(var call of JSEvents.deferredCalls)if(call.targetFunction==targetFunction&&arraysHaveEqualContent(call.argsList,argsList))return;JSEvents.deferredCalls.push({targetFunction:targetFunction,precedence:precedence,argsList:argsList}),JSEvents.deferredCalls.sort(((x,y)=>x.precedence<y.precedence))},removeDeferredCalls(targetFunction){JSEvents.deferredCalls=JSEvents.deferredCalls.filter((call=>call.targetFunction!=targetFunction))},canPerformEventHandlerRequests:()=>navigator.userActivation?navigator.userActivation.isActive:JSEvents.inEventHandler&&JSEvents.currentEventHandler.allowsDeferredCalls,runDeferredCalls(){if(JSEvents.canPerformEventHandlerRequests()){var deferredCalls=JSEvents.deferredCalls;for(var call of(JSEvents.deferredCalls=[],deferredCalls))call.targetFunction(...call.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:(target,eventTypeString)=>{for(var i=0;i<JSEvents.eventHandlers.length;++i)JSEvents.eventHandlers[i].target!=target||eventTypeString&&eventTypeString!=JSEvents.eventHandlers[i].eventTypeString||JSEvents._removeHandler(i--)},_removeHandler(i){var h=JSEvents.eventHandlers[i];h.target.removeEventListener(h.eventTypeString,h.eventListenerFunc,h.useCapture),JSEvents.eventHandlers.splice(i,1)},registerOrRemoveHandler(eventHandler){if(!eventHandler.target)return err("registerOrRemoveHandler: the target element for event handler registration does not exist, when processing the following event handler registration:"),console.dir(eventHandler),-4;if(eventHandler.callbackfunc)eventHandler.eventListenerFunc=function(event){++JSEvents.inEventHandler,JSEvents.currentEventHandler=eventHandler,JSEvents.runDeferredCalls(),eventHandler.handlerFunc(event),JSEvents.runDeferredCalls(),--JSEvents.inEventHandler},eventHandler.target.addEventListener(eventHandler.eventTypeString,eventHandler.eventListenerFunc,eventHandler.useCapture),JSEvents.eventHandlers.push(eventHandler),JSEvents.registerRemoveEventListeners();else for(var i=0;i<JSEvents.eventHandlers.length;++i)JSEvents.eventHandlers[i].target==eventHandler.target&&JSEvents.eventHandlers[i].eventTypeString==eventHandler.eventTypeString&&JSEvents._removeHandler(i--);return 0},getNodeNameForTarget:target=>target?target==window?"#window":target==screen?"#screen":target?.nodeName||"":"",fullscreenEnabled:()=>document.fullscreenEnabled||document.webkitFullscreenEnabled},specialHTMLTargets=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0],findCanvasEventTarget=target=>{var cString;return target=(cString=target)>2?UTF8ToString(cString):cString,specialHTMLTargets[target]||("undefined"!=typeof document?document.querySelector(target):null)},webglPowerPreferences=["default","low-power","high-performance"],_emscripten_webgl_create_context=(target,attributes)=>{assert(attributes);var attr32=attributes>>2,powerPreference=HEAP32[attr32+2],contextAttributes={alpha:!!HEAP8[attributes+0],depth:!!HEAP8[attributes+1],stencil:!!HEAP8[attributes+2],antialias:!!HEAP8[attributes+3],premultipliedAlpha:!!HEAP8[attributes+4],preserveDrawingBuffer:!!HEAP8[attributes+5],powerPreference:webglPowerPreferences[powerPreference],failIfMajorPerformanceCaveat:!!HEAP8[attributes+12],majorVersion:HEAP32[attr32+4],minorVersion:HEAP32[attr32+5],enableExtensionsByDefault:HEAP8[attributes+24],explicitSwapControl:HEAP8[attributes+25],proxyContextToMainThread:HEAP32[attr32+7],renderViaOffscreenBackBuffer:HEAP8[attributes+32]},canvas=findCanvasEventTarget(target);return canvas?(contextAttributes.explicitSwapControl&&!contextAttributes.renderViaOffscreenBackBuffer&&(contextAttributes.renderViaOffscreenBackBuffer=!0),GL.createContext(canvas,contextAttributes)):0},stringToNewUTF8=str=>{var size=lengthBytesUTF8(str)+1,ret=_malloc(size);return ret&&stringToUTF8(str,ret,size),ret},ENV={},getEnvStrings=()=>{if(!getEnvStrings.strings){var env={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:thisProgram||"./this.program"};for(var x in ENV)void 0===ENV[x]?delete env[x]:env[x]=ENV[x];var strings=[];for(var x in env)strings.push(`${x}=${env[x]}`);getEnvStrings.strings=strings}return getEnvStrings.strings};var tempFixedLengthArray=[],writeI53ToI64=(ptr,num)=>{HEAPU32[ptr>>2]=num;var lower=HEAPU32[ptr>>2];HEAPU32[ptr+4>>2]=(num-lower)/4294967296;var deserialized=num>=0?(ptr=>HEAPU32[ptr>>2]+4294967296*HEAPU32[ptr+4>>2])(ptr):(ptr=>HEAPU32[ptr>>2]+4294967296*HEAP32[ptr+4>>2])(ptr),offset=ptr>>2;deserialized!=num&&warnOnce(`writeI53ToI64() out of range: serialized JS Number ${num} to Wasm heap as bytes lo=${ptrToString(HEAPU32[offset])}, hi=${ptrToString(HEAPU32[offset+1])}, which deserializes back to ${deserialized} instead!`)},webglGetExtensions=()=>{var exts=getEmscriptenSupportedExtensions(GLctx);return exts=exts.concat(exts.map((e=>"GL_"+e)))},emscriptenWebGLGet=(name_,p,type)=>{if(p){var ret=void 0;switch(name_){case 36346:ret=1;break;case 36344:return void(0!=type&&1!=type&&GL.recordError(1280));case 34814:case 36345:ret=0;break;case 34466:var formats=GLctx.getParameter(34467);ret=formats?formats.length:0;break;case 33309:if(GL.currentContext.version<2)return void GL.recordError(1282);ret=webglGetExtensions().length;break;case 33307:case 33308:if(GL.currentContext.version<2)return void GL.recordError(1280);ret=33307==name_?3:0}if(void 0===ret){var result=GLctx.getParameter(name_);switch(typeof result){case"number":ret=result;break;case"boolean":ret=result?1:0;break;case"string":return void GL.recordError(1280);case"object":if(null===result)switch(name_){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:ret=0;break;default:return void GL.recordError(1280)}else{if(result instanceof Float32Array||result instanceof Uint32Array||result instanceof Int32Array||result instanceof Array){for(var i=0;i<result.length;++i)switch(type){case 0:HEAP32[p+4*i>>2]=result[i];break;case 2:HEAPF32[p+4*i>>2]=result[i];break;case 4:HEAP8[p+i]=result[i]?1:0}return}try{ret=0|result.name}catch(e){return GL.recordError(1280),void err(`GL_INVALID_ENUM in glGet${type}v: Unknown object returned from WebGL getParameter(${name_})! (error: ${e})`)}}break;default:return GL.recordError(1280),void err(`GL_INVALID_ENUM in glGet${type}v: Native code calling glGet${type}v(${name_}) and it returns ${result} of type ${typeof result}!`)}}switch(type){case 1:writeI53ToI64(p,ret);break;case 0:HEAP32[p>>2]=ret;break;case 2:HEAPF32[p>>2]=ret;break;case 4:HEAP8[p]=ret?1:0}}else GL.recordError(1281)},webglGetLeftBracePos=name=>"]"==name.slice(-1)&&name.lastIndexOf("["),heapObjectForWebGLType=type=>0==(type-=5120)?HEAP8:1==type?HEAPU8:2==type?HEAP16:4==type?HEAP32:6==type?HEAPF32:5==type||28922==type||28520==type||30779==type||30782==type?HEAPU32:HEAPU16,toTypedArrayIndex=(pointer,heap)=>pointer>>>31-Math.clz32(heap.BYTES_PER_ELEMENT),emscriptenWebGLGetTexPixelData=(type,format,width,height,pixels,internalFormat)=>{var heap=heapObjectForWebGLType(type),sizePerPixel=(format=>({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[format-6402]||1))(format)*heap.BYTES_PER_ELEMENT,bytes=((width,height,sizePerPixel)=>{var x,y,plainRowSize=(GL.unpackRowLength||width)*sizePerPixel;return height*(x=plainRowSize,y=GL.unpackAlignment,x+y-1&-y)})(width,height,sizePerPixel);return heap.subarray(toTypedArrayIndex(pixels,heap),toTypedArrayIndex(pixels+bytes,heap))},webglGetUniformLocation=location=>{var p=GLctx.currentProgram;if(p){var webglLoc=p.uniformLocsById[location];return"number"==typeof webglLoc&&(p.uniformLocsById[location]=webglLoc=GLctx.getUniformLocation(p,p.uniformArrayNamesById[location]+(webglLoc>0?`[${webglLoc}]`:""))),webglLoc}GL.recordError(1282)},miniTempWebGLIntBuffers=[],miniTempWebGLFloatBuffers=[],GodotRuntime={get_func:function(ptr){return wasmTable.get(ptr)},error:function(){err.apply(null,Array.from(arguments))},print:function(){out.apply(null,Array.from(arguments))},malloc:function(p_size){return _malloc(p_size)},free:function(p_ptr){_free(p_ptr)},getHeapValue:function(p_ptr,p_type){return function(ptr,type="i8"){switch(type.endsWith("*")&&(type="*"),type){case"i1":case"i8":return HEAP8[ptr];case"i16":return HEAP16[ptr>>1];case"i32":return HEAP32[ptr>>2];case"i64":return HEAP64[ptr>>3];case"float":return HEAPF32[ptr>>2];case"double":return HEAPF64[ptr>>3];case"*":return HEAPU32[ptr>>2];default:abort(`invalid type for getValue: ${type}`)}}(p_ptr,p_type)},setHeapValue:function(p_ptr,p_value,p_type){!function(ptr,value,type="i8"){switch(type.endsWith("*")&&(type="*"),type){case"i1":case"i8":HEAP8[ptr]=value;break;case"i16":HEAP16[ptr>>1]=value;break;case"i32":HEAP32[ptr>>2]=value;break;case"i64":HEAP64[ptr>>3]=BigInt(value);break;case"float":HEAPF32[ptr>>2]=value;break;case"double":HEAPF64[ptr>>3]=value;break;case"*":HEAPU32[ptr>>2]=value;break;default:abort(`invalid type for setValue: ${type}`)}}(p_ptr,p_value,p_type)},heapSub:function(p_heap,p_ptr,p_len){const bytes=p_heap.BYTES_PER_ELEMENT;return p_heap.subarray(p_ptr/bytes,p_ptr/bytes+p_len)},heapSlice:function(p_heap,p_ptr,p_len){const bytes=p_heap.BYTES_PER_ELEMENT;return p_heap.slice(p_ptr/bytes,p_ptr/bytes+p_len)},heapCopy:function(p_dst,p_src,p_ptr){const bytes=p_src.BYTES_PER_ELEMENT;return p_dst.set(p_src,p_ptr/bytes)},parseString:function(p_ptr){return UTF8ToString(p_ptr)},parseStringArray:function(p_ptr,p_size){const strings=[];return GodotRuntime.heapSub(HEAP32,p_ptr,p_size).forEach((function(ptr){strings.push(GodotRuntime.parseString(ptr))})),strings},strlen:function(p_str){return lengthBytesUTF8(p_str)},allocString:function(p_str){const length=GodotRuntime.strlen(p_str)+1,c_str=GodotRuntime.malloc(length);return stringToUTF8(p_str,c_str,length),c_str},allocStringArray:function(p_strings){const size=p_strings.length,c_ptr=GodotRuntime.malloc(4*size);for(let i=0;i<size;i++)HEAP32[(c_ptr>>2)+i]=GodotRuntime.allocString(p_strings[i]);return c_ptr},freeStringArray:function(p_ptr,p_len){for(let i=0;i<p_len;i++)GodotRuntime.free(HEAP32[(p_ptr>>2)+i]);GodotRuntime.free(p_ptr)},stringToHeap:function(p_str,p_ptr,p_len){return stringToUTF8Array(p_str,HEAP8,p_ptr,p_len)}},GodotConfig={canvas:null,locale:"en",canvas_resize_policy:2,virtual_keyboard:!1,persistent_drops:!1,on_execute:null,on_exit:null,init_config:function(p_opts){GodotConfig.canvas_resize_policy=p_opts.canvasResizePolicy,GodotConfig.canvas=p_opts.canvas,GodotConfig.locale=p_opts.locale||GodotConfig.locale,GodotConfig.virtual_keyboard=p_opts.virtualKeyboard,GodotConfig.persistent_drops=!!p_opts.persistentDrops,GodotConfig.on_execute=p_opts.onExecute,GodotConfig.on_exit=p_opts.onExit,p_opts.focusCanvas&&GodotConfig.canvas.focus()},locate_file:function(file){return Module.locateFile(file)},clear:function(){GodotConfig.canvas=null,GodotConfig.locale="en",GodotConfig.canvas_resize_policy=2,GodotConfig.virtual_keyboard=!1,GodotConfig.persistent_drops=!1,GodotConfig.on_execute=null,GodotConfig.on_exit=null}},GodotFS={ENOENT:44,_idbfs:!1,_syncing:!1,_mount_points:[],is_persistent:function(){return GodotFS._idbfs?1:0},init:function(persistentPaths){if(GodotFS._idbfs=!1,!Array.isArray(persistentPaths))return Promise.reject(new Error("Persistent paths must be an array"));if(!persistentPaths.length)return Promise.resolve();return GodotFS._mount_points=persistentPaths.slice(),GodotFS._mount_points.forEach((function(path){!function(dir){try{FS.stat(dir)}catch(e){e.errno!==GodotFS.ENOENT&&GodotRuntime.error(e),FS.mkdirTree(dir)}}(path),FS.mount(IDBFS,{},path)})),new Promise((function(resolve,reject){FS.syncfs(!0,(function(err){err?(GodotFS._mount_points=[],GodotFS._idbfs=!1,GodotRuntime.print(`IndexedDB not available: ${err.message}`)):GodotFS._idbfs=!0,resolve(err)}))}))},deinit:function(){GodotFS._mount_points.forEach((function(path){try{FS.unmount(path)}catch(e){GodotRuntime.print("Already unmounted",e)}GodotFS._idbfs&&IDBFS.dbs[path]&&(IDBFS.dbs[path].close(),delete IDBFS.dbs[path])})),GodotFS._mount_points=[],GodotFS._idbfs=!1,GodotFS._syncing=!1},sync:function(){return GodotFS._syncing?(GodotRuntime.error("Already syncing!"),Promise.resolve()):(GodotFS._syncing=!0,new Promise((function(resolve,reject){FS.syncfs(!1,(function(error){error&&GodotRuntime.error(`Failed to save IDB file system: ${error.message}`),GodotFS._syncing=!1,resolve(error)}))})))},copy_to_fs:function(path,buffer){const idx=path.lastIndexOf("/");let dir="/";idx>0&&(dir=path.slice(0,idx));try{FS.stat(dir)}catch(e){e.errno!==GodotFS.ENOENT&&GodotRuntime.error(e),FS.mkdirTree(dir)}FS.writeFile(path,new Uint8Array(buffer))}},GodotOS={request_quit:function(){},_async_cbs:[],_fs_sync_promise:null,atexit:function(p_promise_cb){GodotOS._async_cbs.push(p_promise_cb)},cleanup:function(exit_code){const cb=GodotConfig.on_exit;GodotFS.deinit(),GodotConfig.clear(),cb&&cb(exit_code)},finish_async:function(callback){GodotOS._fs_sync_promise.then((function(err){const promises=[];return GodotOS._async_cbs.forEach((function(cb){promises.push(new Promise(cb))})),Promise.all(promises)})).then((function(){return GodotFS.sync()})).then((function(err){setTimeout((function(){callback()}),0)}))}},GodotAudio={MAX_VOLUME_CHANNELS:8,GodotChannel:{CHANNEL_L:0,CHANNEL_R:1,CHANNEL_C:3,CHANNEL_LFE:4,CHANNEL_RL:5,CHANNEL_RR:6,CHANNEL_SL:7,CHANNEL_SR:8},WebChannel:{CHANNEL_L:0,CHANNEL_R:1,CHANNEL_SL:2,CHANNEL_SR:3,CHANNEL_C:4,CHANNEL_LFE:5},samples:null,Sample:class{static getSample(id){if(!GodotAudio.samples.has(id))throw new ReferenceError(`Could not find sample "${id}"`);return GodotAudio.samples.get(id)}static getSampleOrNull(id){return GodotAudio.samples.get(id)??null}static create(params,options={}){const sample=new GodotAudio.Sample(params,options);return GodotAudio.samples.set(params.id,sample),sample}static delete(id){GodotAudio.samples.delete(id)}constructor(params,options={}){this.id=params.id,this._audioBuffer=null,this.numberOfChannels=options.numberOfChannels??2,this.sampleRate=options.sampleRate??44100,this.loopMode=options.loopMode??"disabled",this.loopBegin=options.loopBegin??0,this.loopEnd=options.loopEnd??0,this.setAudioBuffer(params.audioBuffer)}getAudioBuffer(){return this._duplicateAudioBuffer()}setAudioBuffer(val){this._audioBuffer=val}clear(){this.setAudioBuffer(null),GodotAudio.Sample.delete(this.id)}_duplicateAudioBuffer(){if(null==this._audioBuffer)throw new Error("couldn't duplicate a null audioBuffer");const channels=new Array(this._audioBuffer.numberOfChannels);for(let i=0;i<this._audioBuffer.numberOfChannels;i++){const channel=new Float32Array(this._audioBuffer.getChannelData(i));channels[i]=channel}const buffer=GodotAudio.ctx.createBuffer(this.numberOfChannels,this._audioBuffer.length,this._audioBuffer.sampleRate);for(let i=0;i<channels.length;i++)buffer.copyToChannel(channels[i],i,0);return buffer}},SampleNodeBus:class{static create(bus){return new GodotAudio.SampleNodeBus(bus)}constructor(bus){this._bus=bus,this._channelSplitter=GodotAudio.ctx.createChannelSplitter(6),this._l=GodotAudio.ctx.createGain(),this._r=GodotAudio.ctx.createGain(),this._sl=GodotAudio.ctx.createGain(),this._sr=GodotAudio.ctx.createGain(),this._c=GodotAudio.ctx.createGain(),this._lfe=GodotAudio.ctx.createGain(),this._channelMerger=GodotAudio.ctx.createChannelMerger(6),this._channelSplitter.connect(this._l,GodotAudio.WebChannel.CHANNEL_L),this._l.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_L),this._channelSplitter.connect(this._r,GodotAudio.WebChannel.CHANNEL_R),this._r.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_R),this._channelSplitter.connect(this._sl,GodotAudio.WebChannel.CHANNEL_SL),this._sl.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_SL),this._channelSplitter.connect(this._sr,GodotAudio.WebChannel.CHANNEL_SR),this._sr.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_SR),this._channelSplitter.connect(this._c,GodotAudio.WebChannel.CHANNEL_C),this._c.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_C),this._channelSplitter.connect(this._lfe,GodotAudio.WebChannel.CHANNEL_L),this._lfe.connect(this._channelMerger,GodotAudio.WebChannel.CHANNEL_L,GodotAudio.WebChannel.CHANNEL_LFE),this._channelMerger.connect(this._bus.getInputNode())}getInputNode(){return this._channelSplitter}getOutputNode(){return this._channelMerger}setVolume(volume){if(volume.length!==GodotAudio.MAX_VOLUME_CHANNELS)throw new Error(`Volume length isn't "${GodotAudio.MAX_VOLUME_CHANNELS}", is ${volume.length} instead`);this._l.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_L]??0,this._r.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_R]??0,this._sl.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_SL]??0,this._sr.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_SR]??0,this._c.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_C]??0,this._lfe.gain.value=volume[GodotAudio.GodotChannel.CHANNEL_LFE]??0}clear(){this._bus=null,this._channelSplitter.disconnect(),this._channelSplitter=null,this._l.disconnect(),this._l=null,this._r.disconnect(),this._r=null,this._sl.disconnect(),this._sl=null,this._sr.disconnect(),this._sr=null,this._c.disconnect(),this._c=null,this._lfe.disconnect(),this._lfe=null,this._channelMerger.disconnect(),this._channelMerger=null}},sampleNodes:null,SampleNode:class{static getSampleNode(id){if(!GodotAudio.sampleNodes.has(id))throw new ReferenceError(`Could not find sample node "${id}"`);return GodotAudio.sampleNodes.get(id)}static getSampleNodeOrNull(id){return GodotAudio.sampleNodes.get(id)??null}static stopSampleNode(id){const sampleNode=GodotAudio.SampleNode.getSampleNodeOrNull(id);null!=sampleNode&&sampleNode.stop()}static pauseSampleNode(id,enable){const sampleNode=GodotAudio.SampleNode.getSampleNodeOrNull(id);null!=sampleNode&&sampleNode.pause(enable)}static create(params,options={}){const sampleNode=new GodotAudio.SampleNode(params,options);return GodotAudio.sampleNodes.set(params.id,sampleNode),sampleNode}static delete(id){GodotAudio.sampleNodes.delete(id)}constructor(params,options={}){this.id=params.id,this.streamObjectId=params.streamObjectId,this.offset=options.offset??0,this.startTime=options.startTime??0,this.isPaused=!1,this.pauseTime=0,this._playbackRate=44100,this.loopMode=options.loopMode??this.getSample().loopMode??"disabled",this._pitchScale=1,this._sourceStartTime=0,this._sampleNodeBuses=new Map,this._source=GodotAudio.ctx.createBufferSource(),this._onended=null,this.setPlaybackRate(options.playbackRate??44100),this._source.buffer=this.getSample().getAudioBuffer(),this._addEndedListener();const bus=GodotAudio.Bus.getBus(params.busIndex);this.getSampleNodeBus(bus).setVolume(options.volume)}getPlaybackRate(){return this._playbackRate}setPlaybackRate(val){this._playbackRate=val,this._syncPlaybackRate()}getPitchScale(){return this._pitchScale}setPitchScale(val){this._pitchScale=val,this._syncPlaybackRate()}getSample(){return GodotAudio.Sample.getSample(this.streamObjectId)}getOutputNode(){return this._source}start(){this._resetSourceStartTime(),this._source.start(this.startTime,this.offset)}stop(){this.clear()}restart(){this.isPaused=!1,this.pauseTime=0,this._resetSourceStartTime(),this._restart()}pause(enable=!0){enable?this._pause():this._unpause()}connect(node){return this.getOutputNode().connect(node)}setVolumes(buses,volumes){for(let busIdx=0;busIdx<buses.length;busIdx++){this.getSampleNodeBus(buses[busIdx]).setVolume(volumes.slice(busIdx*GodotAudio.MAX_VOLUME_CHANNELS,busIdx*GodotAudio.MAX_VOLUME_CHANNELS+GodotAudio.MAX_VOLUME_CHANNELS))}}getSampleNodeBus(bus){if(!this._sampleNodeBuses.has(bus)){const sampleNodeBus=GodotAudio.SampleNodeBus.create(bus);this._sampleNodeBuses.set(bus,sampleNodeBus),this._source.connect(sampleNodeBus.getInputNode())}return this._sampleNodeBuses.get(bus)}clear(){this.isPaused=!1,this.pauseTime=0,null!=this._source&&(this._onended=null,this._source.stop(),this._source.disconnect(),this._source=null);for(const sampleNodeBus of this._sampleNodeBuses.values())sampleNodeBus.clear();this._sampleNodeBuses.clear(),GodotAudio.SampleNode.delete(this.id)}_resetSourceStartTime(){this._sourceStartTime=GodotAudio.ctx.currentTime}_syncPlaybackRate(){this._source.playbackRate.value=this.getPlaybackRate()*this.getPitchScale()}_restart(){null!=this._source&&this._source.disconnect(),this._source=GodotAudio.ctx.createBufferSource(),this._source.buffer=this.getSample().getAudioBuffer();for(const sampleNodeBus of this._sampleNodeBuses.values())this.connect(sampleNodeBus.getInputNode());this._addEndedListener();const pauseTime=this.isPaused?this.pauseTime:0;this._source.start(this.startTime,this.offset+pauseTime)}_pause(){this.isPaused=!0,this.pauseTime=(GodotAudio.ctx.currentTime-this._sourceStartTime)/this.getPlaybackRate(),this._source.stop()}_unpause(){this._restart(),this.isPaused=!1,this.pauseTime=0}_addEndedListener(){const self=this;this._onended=_=>{if(!self.isPaused)switch(self.getSample().loopMode){case"disabled":{const id=this.id;if(self.stop(),null!=GodotAudio.sampleFinishedCallback){const idCharPtr=GodotRuntime.allocString(id);GodotAudio.sampleFinishedCallback(idCharPtr),GodotRuntime.free(idCharPtr)}}break;case"forward":case"backward":self.restart()}}}},buses:null,busSolo:null,Bus:class{static getCount(){return GodotAudio.buses.length}static setCount(val){const buses=GodotAudio.buses;if(val!==buses.length)if(val<buses.length){const deletedBuses=buses.slice(val);for(let i=0;i<deletedBuses.length;i++){deletedBuses[i].clear()}GodotAudio.buses=buses.slice(0,val)}else for(let i=GodotAudio.buses.length;i<val;i++)GodotAudio.Bus.create()}static getBus(index){if(index<0||index>=GodotAudio.buses.length)throw new ReferenceError(`invalid bus index "${index}"`);return GodotAudio.buses[index]}static getBusOrNull(index){return index<0||index>=GodotAudio.buses.length?null:GodotAudio.buses[index]}static move(fromIndex,toIndex){const movedBus=GodotAudio.Bus.getBus(fromIndex),buses=GodotAudio.buses.filter(((_,i)=>i!==fromIndex));buses.splice(toIndex-1,0,movedBus),GodotAudio.buses=buses}static addAt(index){const newBus=GodotAudio.Bus.create();index!==newBus.getId()&&GodotAudio.Bus.move(newBus.getId(),index)}static create(){const newBus=new GodotAudio.Bus,isFirstBus=0===GodotAudio.buses.length;return GodotAudio.buses.push(newBus),isFirstBus?newBus.setSend(null):newBus.setSend(GodotAudio.Bus.getBus(0)),newBus}constructor(){this._sampleNodes=new Set,this.isSolo=!1,this._send=null,this._gainNode=GodotAudio.ctx.createGain(),this._soloNode=GodotAudio.ctx.createGain(),this._muteNode=GodotAudio.ctx.createGain(),this._gainNode.connect(this._soloNode),this._soloNode.connect(this._muteNode)}getId(){return GodotAudio.buses.indexOf(this)}getVolumeDb(){return GodotAudio.linear_to_db(this._gainNode.gain.value)}setVolumeDb(val){const linear=GodotAudio.db_to_linear(val);isFinite(linear)&&(this._gainNode.gain.value=linear)}getSend(){return this._send}setSend(val){if(this._send=val,null==val){if(0==this.getId())return void this.getOutputNode().connect(GodotAudio.ctx.destination);throw new Error(`Cannot send to "${val}" without the bus being at index 0 (current index: ${this.getId()})`)}this.connect(val)}getInputNode(){return this._gainNode}getOutputNode(){return this._muteNode}mute(enable){this._muteNode.gain.value=enable?0:1}solo(enable){if(this.isSolo!==enable)return enable?(null!=GodotAudio.busSolo&&GodotAudio.busSolo!==this&&GodotAudio.busSolo._disableSolo(),void this._enableSolo()):void this._disableSolo()}addSampleNode(sampleNode){this._sampleNodes.add(sampleNode),sampleNode.getOutputNode().connect(this.getInputNode())}removeSampleNode(sampleNode){this._sampleNodes.delete(sampleNode),sampleNode.getOutputNode().disconnect()}connect(bus){if(null==bus)throw new Error("cannot connect to null bus");return this.getOutputNode().disconnect(),this.getOutputNode().connect(bus.getInputNode()),bus}clear(){GodotAudio.buses=GodotAudio.buses.filter((v=>v!==this))}_syncSampleNodes(){const sampleNodes=Array.from(this._sampleNodes);for(let i=0;i<sampleNodes.length;i++){const sampleNode=sampleNodes[i];sampleNode.getOutputNode().disconnect(),sampleNode.getOutputNode().connect(this.getInputNode())}}_enableSolo(){this.isSolo=!0,GodotAudio.busSolo=this,this._soloNode.gain.value=1;const otherBuses=GodotAudio.buses.filter((otherBus=>otherBus!==this));for(let i=0;i<otherBuses.length;i++){otherBuses[i]._soloNode.gain.value=0}}_disableSolo(){this.isSolo=!1,GodotAudio.busSolo=null,this._soloNode.gain.value=1;const otherBuses=GodotAudio.buses.filter((otherBus=>otherBus!==this));for(let i=0;i<otherBuses.length;i++){otherBuses[i]._soloNode.gain.value=1}}},sampleFinishedCallback:null,ctx:null,input:null,driver:null,interval:0,linear_to_db:function(linear){return 8.685889638065037*Math.log(linear)},db_to_linear:function(db){return Math.exp(.11512925464970228*db)},init:function(mix_rate,latency,onstatechange,onlatencyupdate){GodotAudio.samples=new Map,GodotAudio.sampleNodes=new Map,GodotAudio.buses=[],GodotAudio.busSolo=null;const opts={};mix_rate&&(GodotAudio.sampleRate=mix_rate,opts.sampleRate=mix_rate);const ctx=createAudioContext();return GodotAudio.ctx=ctx,ctx.onstatechange=function(){let state=0;switch(ctx.state){case"suspended":state=0;break;case"running":state=1;break;case"closed":state=2}onstatechange(state)},ctx.onstatechange(),GodotAudio.interval=setInterval((function(){let computed_latency=0;ctx.baseLatency&&(computed_latency+=GodotAudio.ctx.baseLatency),ctx.outputLatency&&(computed_latency+=GodotAudio.ctx.outputLatency),onlatencyupdate(computed_latency)}),1e3),GodotOS.atexit(GodotAudio.close_async),ctx.destination.channelCount},create_input:function(callback){if(GodotAudio.input)return 0;function gotMediaInput(stream){try{GodotAudio.input=GodotAudio.ctx.createMediaStreamSource(stream),callback(GodotAudio.input)}catch(e){GodotRuntime.error("Failed creating input.",e)}}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:!0}).then(gotMediaInput,(function(e){GodotRuntime.error("Error getting user media.",e)}));else{if(navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia),!navigator.getUserMedia)return GodotRuntime.error("getUserMedia not available."),1;navigator.getUserMedia({audio:!0},gotMediaInput,(function(e){GodotRuntime.print(e)}))}return 0},close_async:function(resolve,reject){const ctx=GodotAudio.ctx;if(GodotAudio.ctx=null,!ctx)return void resolve();GodotAudio.interval&&(clearInterval(GodotAudio.interval),GodotAudio.interval=0),GodotAudio.input&&(GodotAudio.input.disconnect(),GodotAudio.input=null);let closed=Promise.resolve();GodotAudio.driver&&(closed=GodotAudio.driver.close()),closed.then((function(){return ctx.close()})).then((function(){ctx.onstatechange=null,resolve()})).catch((function(e){ctx.onstatechange=null,GodotRuntime.error("Error closing AudioContext",e),resolve()}))},start_sample:function(playbackObjectId,streamObjectId,busIndex,startOptions){GodotAudio.SampleNode.stopSampleNode(playbackObjectId);GodotAudio.SampleNode.create({busIndex:busIndex,id:playbackObjectId,streamObjectId:streamObjectId},startOptions).start()},stop_sample:function(playbackObjectId){GodotAudio.SampleNode.stopSampleNode(playbackObjectId)},sample_set_pause:function(playbackObjectId,pause){GodotAudio.SampleNode.pauseSampleNode(playbackObjectId,pause)},update_sample_pitch_scale:function(playbackObjectId,pitchScale){const sampleNode=GodotAudio.SampleNode.getSampleNodeOrNull(playbackObjectId);null!=sampleNode&&sampleNode.setPitchScale(pitchScale)},sample_set_volumes_linear:function(playbackObjectId,busIndexes,volumes){const sampleNode=GodotAudio.SampleNode.getSampleNodeOrNull(playbackObjectId);if(null==sampleNode)return;const buses=busIndexes.map((busIndex=>GodotAudio.Bus.getBus(busIndex)));sampleNode.setVolumes(buses,volumes)},set_sample_bus_count:function(count){GodotAudio.Bus.setCount(count)},remove_sample_bus:function(index){GodotAudio.Bus.getBus(index).clear()},add_sample_bus:function(atPos){GodotAudio.Bus.addAt(atPos)},move_sample_bus:function(busIndex,toPos){GodotAudio.Bus.move(busIndex,toPos)},set_sample_bus_send:function(busIndex,sendIndex){GodotAudio.Bus.getBus(busIndex).setSend(GodotAudio.Bus.getBus(sendIndex))},set_sample_bus_volume_db:function(busIndex,volumeDb){GodotAudio.Bus.getBus(busIndex).setVolumeDb(volumeDb)},set_sample_bus_solo:function(busIndex,enable){GodotAudio.Bus.getBus(busIndex).solo(enable)},set_sample_bus_mute:function(busIndex,enable){GodotAudio.Bus.getBus(busIndex).mute(enable)}};var GodotAudioScript={script:null,create:function(buffer_length,channel_count){return GodotAudioScript.script=GodotAudio.ctx.createScriptProcessor(buffer_length,2,channel_count),GodotAudio.driver=GodotAudioScript,GodotAudioScript.script.bufferSize},start:function(p_in_buf,p_in_size,p_out_buf,p_out_size,onprocess){GodotAudioScript.script.onaudioprocess=function(event){const inb=GodotRuntime.heapSub(HEAPF32,p_in_buf,p_in_size),input=event.inputBuffer;if(GodotAudio.input){const inlen=input.getChannelData(0).length;for(let ch=0;ch<2;ch++){const data=input.getChannelData(ch);for(let s=0;s<inlen;s++)inb[2*s+ch]=data[s]}}onprocess();const outb=GodotRuntime.heapSub(HEAPF32,p_out_buf,p_out_size),output=event.outputBuffer,channels=output.numberOfChannels;for(let ch=0;ch<channels;ch++){const data=output.getChannelData(ch);for(let sample=0;sample<data.length;sample++)data[sample]=outb[sample*channels+ch]}},GodotAudioScript.script.connect(GodotAudio.ctx.destination)},get_node:function(){return GodotAudioScript.script},close:function(){return new Promise((function(resolve,reject){GodotAudioScript.script.disconnect(),GodotAudioScript.script.onaudioprocess=null,GodotAudioScript.script=null,resolve()}))}};var GodotAudioWorklet={promise:null,worklet:null,ring_buffer:null,create:function(channels){const path=GodotConfig.locate_file("godot.audio.worklet.js");GodotAudioWorklet.promise=GodotAudio.ctx.audioWorklet.addModule(path).then((function(){return GodotAudioWorklet.worklet=new AudioWorkletNode(GodotAudio.ctx,"godot-processor",{outputChannelCount:[channels]}),Promise.resolve()})),GodotAudio.driver=GodotAudioWorklet},start:function(in_buf,out_buf,state){GodotAudioWorklet.promise.then((function(){const node=GodotAudioWorklet.worklet;node.connect(GodotAudio.ctx.destination),node.port.postMessage({cmd:"start",data:[state,in_buf,out_buf]}),node.port.onmessage=function(event){GodotRuntime.error(event.data)}}))},start_no_threads:function(p_out_buf,p_out_size,out_callback,p_in_buf,p_in_size,in_callback){GodotAudioWorklet.ring_buffer=new function(){let wpos=0,rpos=0,pending_samples=0;const wbuf=new Float32Array(p_out_size);this.receive=function(recv_buf){const buffer=GodotRuntime.heapSub(HEAPF32,p_in_buf,p_in_size),from=rpos;let to_write=recv_buf.length,high=0;rpos+to_write>=p_in_size&&(high=p_in_size-rpos,buffer.set(recv_buf.subarray(0,high),rpos),to_write-=high,rpos=0),to_write&&buffer.set(recv_buf.subarray(high,to_write),rpos),in_callback(from,recv_buf.length),rpos+=to_write},this.consumed=function(size,port){pending_samples+=size,function(port){if(0===pending_samples)return;const buffer=GodotRuntime.heapSub(HEAPF32,p_out_buf,p_out_size),size=buffer.length,tot_sent=pending_samples;if(out_callback(wpos,pending_samples),wpos+pending_samples>=size){const high=size-wpos;wbuf.set(buffer.subarray(wpos,size)),pending_samples-=high,wpos=0}pending_samples>0&&wbuf.set(buffer.subarray(wpos,wpos+pending_samples),tot_sent-pending_samples),port.postMessage({cmd:"chunk",data:wbuf.subarray(0,tot_sent)}),wpos+=pending_samples,pending_samples=0}(port)}},GodotAudioWorklet.promise.then((function(){const node=GodotAudioWorklet.worklet,buffer=GodotRuntime.heapSlice(HEAPF32,p_out_buf,p_out_size);node.connect(GodotAudio.ctx.destination),node.port.postMessage({cmd:"start_nothreads",data:[buffer,p_in_size]}),node.port.onmessage=function(event){if(GodotAudioWorklet.worklet)if("read"===event.data.cmd){const read=event.data.data;GodotAudioWorklet.ring_buffer.consumed(read,GodotAudioWorklet.worklet.port)}else if("input"===event.data.cmd){const buf=event.data.data;if(buf.length>p_in_size)return void GodotRuntime.error("Input chunk is too big");GodotAudioWorklet.ring_buffer.receive(buf)}else GodotRuntime.error(event.data)}}))},get_node:function(){return GodotAudioWorklet.worklet},close:function(){return new Promise((function(resolve,reject){if(null===GodotAudioWorklet.promise)return;GodotAudioWorklet.promise.then((function(){GodotAudioWorklet.worklet.port.postMessage({cmd:"stop",data:null}),GodotAudioWorklet.worklet.disconnect(),GodotAudioWorklet.worklet.port.onmessage=null,GodotAudioWorklet.worklet=null,GodotAudioWorklet.promise=null,resolve()})).catch((function(err){GodotRuntime.error(err)}))}))}};var GodotDisplayCursor={shape:"default",visible:!0,cursors:{},set_style:function(style){GodotConfig.canvas.style.cursor=style},set_shape:function(shape){GodotDisplayCursor.shape=shape;let css=shape;if(shape in GodotDisplayCursor.cursors){const c=GodotDisplayCursor.cursors[shape];css=`url("${c.url}") ${c.x} ${c.y}, default`}GodotDisplayCursor.visible&&GodotDisplayCursor.set_style(css)},clear:function(){GodotDisplayCursor.set_style(""),GodotDisplayCursor.shape="default",GodotDisplayCursor.visible=!0,Object.keys(GodotDisplayCursor.cursors).forEach((function(key){URL.revokeObjectURL(GodotDisplayCursor.cursors[key]),delete GodotDisplayCursor.cursors[key]}))},lockPointer:function(){const canvas=GodotConfig.canvas;canvas.requestPointerLock&&canvas.requestPointerLock()},releasePointer:function(){document.exitPointerLock&&document.exitPointerLock()},isPointerLocked:function(){return document.pointerLockElement===GodotConfig.canvas}},GodotEventListeners={handlers:[],has:function(target,event,method,capture){return-1!==GodotEventListeners.handlers.findIndex((function(e){return e.target===target&&e.event===event&&e.method===method&&e.capture===capture}))},add:function(target,event,method,capture){GodotEventListeners.has(target,event,method,capture)||(GodotEventListeners.handlers.push(new function(p_target,p_event,p_method,p_capture){this.target=p_target,this.event=p_event,this.method=p_method,this.capture=p_capture}(target,event,method,capture)),target.addEventListener(event,method,capture))},clear:function(){GodotEventListeners.handlers.forEach((function(h){h.target.removeEventListener(h.event,h.method,h.capture)})),GodotEventListeners.handlers.length=0}},_emscripten_webgl_get_current_context=()=>GL.currentContext?GL.currentContext.handle:0,GodotDisplayScreen={desired_size:[0,0],hidpi:!0,getPixelRatio:function(){return GodotDisplayScreen.hidpi&&window.devicePixelRatio||1},isFullscreen:function(){const elem=document.fullscreenElement||document.mozFullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;return elem?elem===GodotConfig.canvas:document.fullscreen||document.mozFullScreen||document.webkitIsFullscreen},hasFullscreen:function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled},requestFullscreen:function(){if(!GodotDisplayScreen.hasFullscreen())return 1;const canvas=GodotConfig.canvas;try{const promise=(canvas.requestFullscreen||canvas.msRequestFullscreen||canvas.mozRequestFullScreen||canvas.mozRequestFullscreen||canvas.webkitRequestFullscreen).call(canvas);promise&&promise.catch((function(){}))}catch(e){return 1}return 0},exitFullscreen:function(){if(!GodotDisplayScreen.isFullscreen())return 0;try{const promise=document.exitFullscreen();promise&&promise.catch((function(){}))}catch(e){return 1}return 0},_updateGL:function(){const gl_context_handle=_emscripten_webgl_get_current_context(),gl=GL.getContext(gl_context_handle);gl&&GL.resizeOffscreenFramebuffer(gl)},updateSize:function(){const isFullscreen=GodotDisplayScreen.isFullscreen(),wantsFullWindow=2===GodotConfig.canvas_resize_policy,noResize=0===GodotConfig.canvas_resize_policy,dWidth=GodotDisplayScreen.desired_size[0],dHeight=GodotDisplayScreen.desired_size[1],canvas=GodotConfig.canvas;let width=dWidth,height=dHeight;if(noResize)return canvas.width!==width||canvas.height!==height?(GodotDisplayScreen.desired_size=[canvas.width,canvas.height],GodotDisplayScreen._updateGL(),1):0;const scale=GodotDisplayScreen.getPixelRatio();(isFullscreen||wantsFullWindow)&&(width=window.innerWidth*scale,height=window.innerHeight*scale);const csw=width/scale+"px",csh=height/scale+"px";return canvas.style.width!==csw||canvas.style.height!==csh||canvas.width!==width||canvas.height!==height?(canvas.width=width,canvas.height=height,canvas.style.width=csw,canvas.style.height=csh,GodotDisplayScreen._updateGL(),1):0}},GodotDisplayVK={textinput:null,textarea:null,available:function(){return GodotConfig.virtual_keyboard&&"ontouchstart"in window},init:function(input_cb){function create(what){const elem=document.createElement(what);return elem.style.display="none",elem.style.position="absolute",elem.style.zIndex="-1",elem.style.background="transparent",elem.style.padding="0px",elem.style.margin="0px",elem.style.overflow="hidden",elem.style.width="0px",elem.style.height="0px",elem.style.border="0px",elem.style.outline="none",elem.readonly=!0,elem.disabled=!0,GodotEventListeners.add(elem,"input",(function(evt){const c_str=GodotRuntime.allocString(elem.value);input_cb(c_str,elem.selectionEnd),GodotRuntime.free(c_str)}),!1),GodotEventListeners.add(elem,"blur",(function(evt){elem.style.display="none",elem.readonly=!0,elem.disabled=!0}),!1),GodotConfig.canvas.insertAdjacentElement("beforebegin",elem),elem}GodotDisplayVK.textinput=create("input"),GodotDisplayVK.textarea=create("textarea"),GodotDisplayVK.updateSize()},show:function(text,type,start,end){if(!GodotDisplayVK.textinput||!GodotDisplayVK.textarea)return;""===GodotDisplayVK.textinput.style.display&&""===GodotDisplayVK.textarea.style.display||GodotDisplayVK.hide(),GodotDisplayVK.updateSize();let elem=GodotDisplayVK.textinput;switch(type){case 0:default:elem.type="text",elem.inputmode="";break;case 1:elem=GodotDisplayVK.textarea;break;case 2:elem.type="text",elem.inputmode="numeric";break;case 3:elem.type="text",elem.inputmode="decimal";break;case 4:elem.type="tel",elem.inputmode="";break;case 5:elem.type="email",elem.inputmode="";break;case 6:elem.type="password",elem.inputmode="";break;case 7:elem.type="url",elem.inputmode=""}elem.readonly=!1,elem.disabled=!1,elem.value=text,elem.style.display="block",elem.focus(),elem.setSelectionRange(start,end)},hide:function(){GodotDisplayVK.textinput&&GodotDisplayVK.textarea&&[GodotDisplayVK.textinput,GodotDisplayVK.textarea].forEach((function(elem){elem.blur(),elem.style.display="none",elem.value=""}))},updateSize:function(){if(!GodotDisplayVK.textinput||!GodotDisplayVK.textarea)return;const rect=GodotConfig.canvas.getBoundingClientRect();function update(elem){elem.style.left=`${rect.left}px`,elem.style.top=`${rect.top}px`,elem.style.width=`${rect.width}px`,elem.style.height=`${rect.height}px`}update(GodotDisplayVK.textinput),update(GodotDisplayVK.textarea)},clear:function(){GodotDisplayVK.textinput&&(GodotDisplayVK.textinput.remove(),GodotDisplayVK.textinput=null),GodotDisplayVK.textarea&&(GodotDisplayVK.textarea.remove(),GodotDisplayVK.textarea=null)}},GodotDisplay_getDPI=function(){const dpi=Math.round(96*window.devicePixelRatio);return dpi>=96?dpi:96};var IDHandler={_last_id:0,_references:{},get:function(p_id){return IDHandler._references[p_id]},add:function(p_data){const id=++IDHandler._last_id;return IDHandler._references[id]=p_data,id},remove:function(p_id){delete IDHandler._references[p_id]}},GodotFetch={onread:function(id,result){const obj=IDHandler.get(id);obj&&(result.value&&obj.chunks.push(result.value),obj.reading=!1,obj.done=result.done)},onresponse:function(id,response){const obj=IDHandler.get(id);if(!obj)return;let chunked=!1;response.headers.forEach((function(value,header){const v=value.toLowerCase().trim();"transfer-encoding"===header.toLowerCase().trim()&&"chunked"===v&&(chunked=!0)})),obj.status=response.status,obj.response=response,obj.reader=response.body.getReader(),obj.chunked=chunked},onerror:function(id,err){GodotRuntime.error(err);const obj=IDHandler.get(id);obj&&(obj.error=err)},create:function(method,url,headers,body){const obj={request:null,response:null,reader:null,error:null,done:!1,reading:!1,status:0,chunks:[]},id=IDHandler.add(obj),init={method:method,headers:headers,body:body};return obj.request=fetch(url,init),obj.request.then(GodotFetch.onresponse.bind(null,id)).catch(GodotFetch.onerror.bind(null,id)),id},free:function(id){const obj=IDHandler.get(id);obj&&(IDHandler.remove(id),obj.request&&obj.request.then((function(response){response.abort()})).catch((function(e){})))},read:function(id){const obj=IDHandler.get(id);if(obj&&obj.reader&&!obj.reading){if(obj.done)return void(obj.reader=null);obj.reading=!0,obj.reader.read().then(GodotFetch.onread.bind(null,id)).catch(GodotFetch.onerror.bind(null,id))}}};var GodotInputGamepads={samples:[],get_pads:function(){try{const pads=navigator.getGamepads();return pads||[]}catch(e){return[]}},get_samples:function(){return GodotInputGamepads.samples},get_sample:function(index){const samples=GodotInputGamepads.samples;return index<samples.length?samples[index]:null},sample:function(){const pads=GodotInputGamepads.get_pads(),samples=[];for(let i=0;i<pads.length;i++){const pad=pads[i];if(!pad){samples.push(null);continue}const s={standard:"standard"===pad.mapping,buttons:[],axes:[],connected:pad.connected};for(let b=0;b<pad.buttons.length;b++)s.buttons.push(pad.buttons[b].value);for(let a=0;a<pad.axes.length;a++)s.axes.push(pad.axes[a]);samples.push(s)}GodotInputGamepads.samples=samples},init:function(onchange){function add(pad){const guid=GodotInputGamepads.get_guid(pad),c_id=GodotRuntime.allocString(pad.id),c_guid=GodotRuntime.allocString(guid);onchange(pad.index,1,c_id,c_guid),GodotRuntime.free(c_id),GodotRuntime.free(c_guid)}GodotInputGamepads.samples=[];const pads=GodotInputGamepads.get_pads();for(let i=0;i<pads.length;i++)pads[i]&&add(pads[i]);GodotEventListeners.add(window,"gamepadconnected",(function(evt){evt.gamepad&&add(evt.gamepad)}),!1),GodotEventListeners.add(window,"gamepaddisconnected",(function(evt){evt.gamepad&&onchange(evt.gamepad.index,0)}),!1)},get_guid:function(pad){if(pad.mapping)return pad.mapping;const ua=navigator.userAgent;let os="Unknown";ua.indexOf("Android")>=0?os="Android":ua.indexOf("Linux")>=0?os="Linux":ua.indexOf("iPhone")>=0?os="iOS":ua.indexOf("Macintosh")>=0?os="MacOSX":ua.indexOf("Windows")>=0&&(os="Windows");const id=pad.id,exp1=/vendor: ([0-9a-f]{4}) product: ([0-9a-f]{4})/i,exp2=/^([0-9a-f]+)-([0-9a-f]+)-/i;let vendor="",product="";if(exp1.test(id)){const match=exp1.exec(id);vendor=match[1].padStart(4,"0"),product=match[2].padStart(4,"0")}else if(exp2.test(id)){const match=exp2.exec(id);vendor=match[1].padStart(4,"0"),product=match[2].padStart(4,"0")}return vendor&&product?os+vendor+product:`${os}Unknown`}},GodotInputDragDrop={promises:[],pending_files:[],add_entry:function(entry){entry.isDirectory?GodotInputDragDrop.add_dir(entry):entry.isFile?GodotInputDragDrop.add_file(entry):GodotRuntime.error("Unrecognized entry...",entry)},add_dir:function(entry){GodotInputDragDrop.promises.push(new Promise((function(resolve,reject){entry.createReader().readEntries((function(entries){for(let i=0;i<entries.length;i++)GodotInputDragDrop.add_entry(entries[i]);resolve()}))})))},add_file:function(entry){GodotInputDragDrop.promises.push(new Promise((function(resolve,reject){entry.file((function(file){const reader=new FileReader;reader.onload=function(){const f={path:file.relativePath||file.webkitRelativePath,name:file.name,type:file.type,size:file.size,data:reader.result};f.path||(f.path=f.name),GodotInputDragDrop.pending_files.push(f),resolve()},reader.onerror=function(){GodotRuntime.print("Error reading file"),reject()},reader.readAsArrayBuffer(file)}),(function(err){GodotRuntime.print("Error!"),reject()}))})))},process:function(resolve,reject){0!==GodotInputDragDrop.promises.length?GodotInputDragDrop.promises.pop().then((function(){setTimeout((function(){GodotInputDragDrop.process(resolve,reject)}),0)})):resolve()},_process_event:function(ev,callback){if(ev.preventDefault(),ev.dataTransfer.items)for(let i=0;i<ev.dataTransfer.items.length;i++){const item=ev.dataTransfer.items[i];let entry=null;"getAsEntry"in item?entry=item.getAsEntry():"webkitGetAsEntry"in item&&(entry=item.webkitGetAsEntry()),entry&&GodotInputDragDrop.add_entry(entry)}else GodotRuntime.error("File upload not supported");new Promise(GodotInputDragDrop.process).then((function(){const DROP=`/tmp/drop-${parseInt(Math.random()*(1<<30),10)}/`,drops=[],files=[];FS.mkdir(DROP.slice(0,-1)),GodotInputDragDrop.pending_files.forEach((elem=>{const path=elem.path;GodotFS.copy_to_fs(DROP+path,elem.data);let idx=path.indexOf("/");if(-1===idx)drops.push(DROP+path);else{const sub=path.substr(0,idx);idx=sub.indexOf("/"),idx<0&&-1===drops.indexOf(DROP+sub)&&drops.push(DROP+sub)}files.push(DROP+path)})),GodotInputDragDrop.promises=[],GodotInputDragDrop.pending_files=[],callback(drops),GodotConfig.persistent_drops?GodotOS.atexit((function(resolve,reject){GodotInputDragDrop.remove_drop(files,DROP),resolve()})):GodotInputDragDrop.remove_drop(files,DROP)}))},remove_drop:function(files,drop_path){const dirs=[drop_path.substr(0,drop_path.length-1)];files.forEach((function(file){FS.unlink(file);let dir=file.replace(drop_path,""),idx=dir.lastIndexOf("/");for(;idx>0;)dir=dir.substr(0,idx),-1===dirs.indexOf(drop_path+dir)&&dirs.push(drop_path+dir),idx=dir.lastIndexOf("/")})),dirs.sort((function(a,b){const al=(a.match(/\//g)||[]).length,bl=(b.match(/\//g)||[]).length;return al>bl?-1:al<bl?1:0})).forEach((function(dir){FS.rmdir(dir)}))},handler:function(callback){return function(ev){GodotInputDragDrop._process_event(ev,callback)}}},GodotIME={ime:null,active:!1,getModifiers:function(evt){return evt.shiftKey+0+(evt.altKey+0<<1)+(evt.ctrlKey+0<<2)+(evt.metaKey+0<<3)},ime_active:function(active){GodotIME.ime&&(active?(GodotIME.ime.style.display="block",setInterval((function(){GodotIME.active=!0,GodotIME.ime.focus()}),100)):(GodotIME.ime.style.display="none",GodotConfig.canvas.focus(),GodotIME.active=!1))},ime_position:function(x,y){if(GodotIME.ime){const canvas=GodotConfig.canvas,rect=canvas.getBoundingClientRect(),rw=canvas.width/rect.width,rh=canvas.height/rect.height,clx=x/rw+rect.x,cly=y/rh+rect.y;GodotIME.ime.style.left=`${clx}px`,GodotIME.ime.style.top=`${cly}px`}},init:function(ime_cb,key_cb,code,key){function key_event_cb(pressed,evt){const modifiers=GodotIME.getModifiers(evt);GodotRuntime.stringToHeap(evt.code,code,32),GodotRuntime.stringToHeap(evt.key,key,32),key_cb(pressed,evt.repeat,modifiers),evt.preventDefault()}function ime_event_cb(event){if(GodotIME.ime)if("compositionstart"===event.type)ime_cb(0,null),GodotIME.ime.innerHTML="";else if("compositionupdate"===event.type){const ptr=GodotRuntime.allocString(event.data);ime_cb(1,ptr),GodotRuntime.free(ptr)}else if("compositionend"===event.type){const ptr=GodotRuntime.allocString(event.data);ime_cb(2,ptr),GodotRuntime.free(ptr),GodotIME.ime.innerHTML=""}}const ime=document.createElement("div");ime.className="ime",ime.style.background="none",ime.style.opacity=0,ime.style.position="fixed",ime.style.textAlign="left",ime.style.fontSize="1px",ime.style.left="0px",ime.style.top="0px",ime.style.width="100%",ime.style.height="40px",ime.style.pointerEvents="none",ime.style.display="none",ime.contentEditable="true",GodotEventListeners.add(ime,"compositionstart",ime_event_cb,!1),GodotEventListeners.add(ime,"compositionupdate",ime_event_cb,!1),GodotEventListeners.add(ime,"compositionend",ime_event_cb,!1),GodotEventListeners.add(ime,"keydown",key_event_cb.bind(null,1),!1),GodotEventListeners.add(ime,"keyup",key_event_cb.bind(null,0),!1),ime.onblur=function(){this.style.display="none",GodotConfig.canvas.focus(),GodotIME.active=!1},GodotConfig.canvas.parentElement.appendChild(ime),GodotIME.ime=ime},clear:function(){GodotIME.ime&&(GodotIME.ime.remove(),GodotIME.ime=null)}},GodotInput_getModifiers=function(evt){return evt.shiftKey+0+(evt.altKey+0<<1)+(evt.ctrlKey+0<<2)+(evt.metaKey+0<<3)},GodotInput_computePosition=function(evt,rect){const canvas=GodotConfig.canvas,rw=canvas.width/rect.width,rh=canvas.height/rect.height;return[(evt.clientX-rect.x)*rw,(evt.clientY-rect.y)*rh]};var GodotPWA={hasUpdate:!1,updateState:function(cb,reg){reg&&reg.active&&(reg.waiting&&(GodotPWA.hasUpdate=!0,cb()),GodotEventListeners.add(reg,"updatefound",(function(){const installing=reg.installing;GodotEventListeners.add(installing,"statechange",(function(){"installed"===installing.state&&(GodotPWA.hasUpdate=!0,cb())}))})))}};var GodotWebSocket={_onopen:function(p_id,callback,event){const ref=IDHandler.get(p_id);if(!ref)return;const c_str=GodotRuntime.allocString(ref.protocol);callback(c_str),GodotRuntime.free(c_str)},_onmessage:function(p_id,callback,event){if(!IDHandler.get(p_id))return;let buffer,is_string=0;if(event.data instanceof ArrayBuffer)buffer=new Uint8Array(event.data);else{if(event.data instanceof Blob)return void GodotRuntime.error("Blob type not supported");if("string"!=typeof event.data)return void GodotRuntime.error("Unknown message type");{is_string=1;const enc=new TextEncoder("utf-8");buffer=new Uint8Array(enc.encode(event.data))}}const len=buffer.length*buffer.BYTES_PER_ELEMENT,out=GodotRuntime.malloc(len);HEAPU8.set(buffer,out),callback(out,len,is_string),GodotRuntime.free(out)},_onerror:function(p_id,callback,event){IDHandler.get(p_id)&&callback()},_onclose:function(p_id,callback,event){if(!IDHandler.get(p_id))return;const c_str=GodotRuntime.allocString(event.reason);callback(event.code,c_str,event.wasClean?1:0),GodotRuntime.free(c_str)},send:function(p_id,p_data){const ref=IDHandler.get(p_id);return ref&&ref.readyState===ref.OPEN?(ref.send(p_data),0):1},bufferedAmount:function(p_id){const ref=IDHandler.get(p_id);return ref?ref.bufferedAmount:0},create:function(socket,p_on_open,p_on_message,p_on_error,p_on_close){const id=IDHandler.add(socket);return socket.onopen=GodotWebSocket._onopen.bind(null,id,p_on_open),socket.onmessage=GodotWebSocket._onmessage.bind(null,id,p_on_message),socket.onerror=GodotWebSocket._onerror.bind(null,id,p_on_error),socket.onclose=GodotWebSocket._onclose.bind(null,id,p_on_close),id},close:function(p_id,p_code,p_reason){const ref=IDHandler.get(p_id);if(ref&&ref.readyState<ref.CLOSING){const code=p_code,reason=p_reason;ref.close(code,reason)}},destroy:function(p_id){const ref=IDHandler.get(p_id);ref&&(GodotWebSocket.close(p_id,3001,"destroyed"),IDHandler.remove(p_id),ref.onopen=null,ref.onmessage=null,ref.onerror=null,ref.onclose=null)}};var stackAlloc=sz=>__emscripten_stack_alloc(sz),stringToUTF8OnStack=str=>{var size=lengthBytesUTF8(str)+1,ret=stackAlloc(size);return stringToUTF8(str,ret,size),ret},ccall=(ident,returnType,argTypes,args,opts)=>{var toC={string:str=>{var ret=0;return null!=str&&0!==str&&(ret=stringToUTF8OnStack(str)),ret},array:arr=>{var array,buffer,ret=stackAlloc(arr.length);return buffer=ret,assert((array=arr).length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),HEAP8.set(array,buffer),ret}};var func=(ident=>{var func=Module["_"+ident];return assert(func,"Cannot call unknown function "+ident+", make sure it is exported"),func})(ident),cArgs=[],stack=0;if(assert("array"!==returnType,'Return type should not be "array".'),args)for(var i=0;i<args.length;i++){var converter=toC[argTypes[i]];converter?(0===stack&&(stack=_emscripten_stack_get_current()),cArgs[i]=converter(args[i])):cArgs[i]=args[i]}var ret=func(...cArgs);return ret=function(ret){return 0!==stack&&__emscripten_stack_restore(stack),function(ret){return"string"===returnType?UTF8ToString(ret):"boolean"===returnType?Boolean(ret):ret}(ret)}(ret)};FS.createPreloadedFile=(parent,name,url,canRead,canWrite,onload,onerror,dontCreateFile,canOwn,preFinish)=>{var fullname=name?PATH_FS.resolve(PATH.join2(parent,name)):parent,dep=getUniqueRunDependency(`cp ${fullname}`);function processData(byteArray){function finish(byteArray){preFinish?.(),dontCreateFile||((parent,name,fileData,canRead,canWrite,canOwn)=>{FS.createDataFile(parent,name,fileData,canRead,canWrite,canOwn)})(parent,name,byteArray,canRead,canWrite,canOwn),onload?.(),removeRunDependency(dep)}((byteArray,fullname,finish,onerror)=>{"undefined"!=typeof Browser&&Browser.init();var handled=!1;return preloadPlugins.forEach((plugin=>{handled||plugin.canHandle(fullname)&&(plugin.handle(byteArray,fullname,finish,onerror),handled=!0)})),handled})(byteArray,fullname,finish,(()=>{onerror?.(),removeRunDependency(dep)}))||finish(byteArray)}addRunDependency(dep),"string"==typeof url?((url,onload,onerror,noRunDep)=>{var dep=noRunDep?"":getUniqueRunDependency(`al ${url}`);readAsync(url).then((arrayBuffer=>{assert(arrayBuffer,`Loading data file "${url}" failed (no arrayBuffer).`),onload(new Uint8Array(arrayBuffer)),dep&&removeRunDependency(dep)}),(err=>{if(!onerror)throw`Loading data file "${url}" failed.`;onerror()})),dep&&addRunDependency(dep)})(url,processData,onerror):processData(url)},FS.staticInit(),Module.requestAnimationFrame=MainLoop.requestAnimationFrame,Module.pauseMainLoop=MainLoop.pause,Module.resumeMainLoop=MainLoop.resume,MainLoop.init();for(var i=0;i<32;++i)tempFixedLengthArray.push(new Array(i));var miniTempWebGLIntBuffersStorage=new Int32Array(288);for(i=0;i<=288;++i)miniTempWebGLIntBuffers[i]=miniTempWebGLIntBuffersStorage.subarray(0,i);var miniTempWebGLFloatBuffersStorage=new Float32Array(288);for(i=0;i<=288;++i)miniTempWebGLFloatBuffers[i]=miniTempWebGLFloatBuffersStorage.subarray(0,i);Module.request_quit=function(){GodotOS.request_quit()},Module.onExit=GodotOS.cleanup,GodotOS._fs_sync_promise=Promise.resolve(),Module.initConfig=GodotConfig.init_config,Module.initFS=GodotFS.init,Module.copyToFS=GodotFS.copy_to_fs,GodotOS.atexit((function(resolve,reject){GodotDisplayCursor.clear(),resolve()})),GodotOS.atexit((function(resolve,reject){GodotEventListeners.clear(),resolve()})),GodotOS.atexit((function(resolve,reject){GodotDisplayVK.clear(),resolve()})),GodotOS.atexit((function(resolve,reject){GodotIME.clear(),resolve()}));var wasmImports={__assert_fail:(condition,filename,line,func)=>abort(`Assertion failed: ${UTF8ToString(condition)}, at: `+[filename?UTF8ToString(filename):"unknown filename",line,func?UTF8ToString(func):"unknown function"]),__call_sighandler:(fp,sig)=>getWasmTableEntry(fp)(sig),__syscall__newselect:function(nfds,readfds,writefds,exceptfds,timeout){try{assert(nfds<=64,"nfds must be less than or equal to 64");for(var total=0,srcReadLow=readfds?HEAP32[readfds>>2]:0,srcReadHigh=readfds?HEAP32[readfds+4>>2]:0,srcWriteLow=writefds?HEAP32[writefds>>2]:0,srcWriteHigh=writefds?HEAP32[writefds+4>>2]:0,srcExceptLow=exceptfds?HEAP32[exceptfds>>2]:0,srcExceptHigh=exceptfds?HEAP32[exceptfds+4>>2]:0,dstReadLow=0,dstReadHigh=0,dstWriteLow=0,dstWriteHigh=0,dstExceptLow=0,dstExceptHigh=0,allLow=(readfds?HEAP32[readfds>>2]:0)|(writefds?HEAP32[writefds>>2]:0)|(exceptfds?HEAP32[exceptfds>>2]:0),allHigh=(readfds?HEAP32[readfds+4>>2]:0)|(writefds?HEAP32[writefds+4>>2]:0)|(exceptfds?HEAP32[exceptfds+4>>2]:0),check=(fd,low,high,val)=>fd<32?low&val:high&val,fd=0;fd<nfds;fd++){var mask=1<<fd%32;if(check(fd,allLow,allHigh,mask)){var stream=SYSCALLS.getStreamFromFD(fd),flags=SYSCALLS.DEFAULT_POLLMASK;if(stream.stream_ops.poll){var timeoutInMillis=-1;if(timeout)timeoutInMillis=1e3*((readfds?HEAP32[timeout>>2]:0)+(readfds?HEAP32[timeout+4>>2]:0)/1e6);flags=stream.stream_ops.poll(stream,timeoutInMillis)}1&flags&&check(fd,srcReadLow,srcReadHigh,mask)&&(fd<32?dstReadLow|=mask:dstReadHigh|=mask,total++),4&flags&&check(fd,srcWriteLow,srcWriteHigh,mask)&&(fd<32?dstWriteLow|=mask:dstWriteHigh|=mask,total++),2&flags&&check(fd,srcExceptLow,srcExceptHigh,mask)&&(fd<32?dstExceptLow|=mask:dstExceptHigh|=mask,total++)}}return readfds&&(HEAP32[readfds>>2]=dstReadLow,HEAP32[readfds+4>>2]=dstReadHigh),writefds&&(HEAP32[writefds>>2]=dstWriteLow,HEAP32[writefds+4>>2]=dstWriteHigh),exceptfds&&(HEAP32[exceptfds>>2]=dstExceptLow,HEAP32[exceptfds+4>>2]=dstExceptHigh),total}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_accept4:function(fd,addr,addrlen,flags,d1,d2){try{var sock=getSocketFromFD(fd),newsock=sock.sock_ops.accept(sock);if(addr)assert(!writeSockaddr(addr,newsock.family,DNS.lookup_name(newsock.daddr),newsock.dport,addrlen));return newsock.stream.fd}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_bind:function(fd,addr,addrlen,d1,d2,d3){try{var sock=getSocketFromFD(fd),info=getSocketAddress(addr,addrlen);return sock.sock_ops.bind(sock,info.addr,info.port),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_chdir:function(path){try{return path=SYSCALLS.getStr(path),FS.chdir(path),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_chmod:function(path,mode){try{return path=SYSCALLS.getStr(path),FS.chmod(path,mode),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_connect:function(fd,addr,addrlen,d1,d2,d3){try{var sock=getSocketFromFD(fd),info=getSocketAddress(addr,addrlen);return sock.sock_ops.connect(sock,info.addr,info.port),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_faccessat:function(dirfd,path,amode,flags){try{if(path=SYSCALLS.getStr(path),assert(0===flags||512==flags),path=SYSCALLS.calculateAt(dirfd,path),-8&amode)return-28;var node=FS.lookupPath(path,{follow:!0}).node;if(!node)return-44;var perms="";return 4&amode&&(perms+="r"),2&amode&&(perms+="w"),1&amode&&(perms+="x"),perms&&FS.nodePermissions(node,perms)?-2:0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_fchmod:function(fd,mode){try{return FS.fchmod(fd,mode),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_fcntl64:function(fd,cmd,varargs){SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(cmd){case 0:if((arg=syscallGetVarargI())<0)return-28;for(;FS.streams[arg];)arg++;return FS.dupStream(stream,arg).fd;case 1:case 2:case 13:case 14:return 0;case 3:return stream.flags;case 4:var arg=syscallGetVarargI();return stream.flags|=arg,0;case 12:arg=syscallGetVarargP();return HEAP16[arg+0>>1]=2,0}return-28}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_fstat64:function(fd,buf){try{var stream=SYSCALLS.getStreamFromFD(fd);return SYSCALLS.doStat(FS.stat,stream.path,buf)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_ftruncate64:function(fd,length){length=bigintToI53Checked(length);try{return isNaN(length)?61:(FS.ftruncate(fd,length),0)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_getcwd:function(buf,size){try{if(0===size)return-28;var cwd=FS.cwd(),cwdLengthInBytes=lengthBytesUTF8(cwd)+1;return size<cwdLengthInBytes?-68:(stringToUTF8(cwd,buf,size),cwdLengthInBytes)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_getdents64:function(fd,dirp,count){try{var stream=SYSCALLS.getStreamFromFD(fd);stream.getdents||=FS.readdir(stream.path);for(var pos=0,off=FS.llseek(stream,0,1),idx=Math.floor(off/280);idx<stream.getdents.length&&pos+280<=count;){var id,type,name=stream.getdents[idx];if("."===name)id=stream.node.id,type=4;else if(".."===name){id=FS.lookupPath(stream.path,{parent:!0}).node.id,type=4}else{var child=FS.lookupNode(stream.node,name);id=child.id,type=FS.isChrdev(child.mode)?2:FS.isDir(child.mode)?4:FS.isLink(child.mode)?10:8}assert(id),HEAP64[dirp+pos>>3]=BigInt(id),HEAP64[dirp+pos+8>>3]=BigInt(280*(idx+1)),HEAP16[dirp+pos+16>>1]=280,HEAP8[dirp+pos+18]=type,stringToUTF8(name,dirp+pos+19,256),pos+=280,idx+=1}return FS.llseek(stream,280*idx,0),pos}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_getsockname:function(fd,addr,addrlen,d1,d2,d3){try{var sock=getSocketFromFD(fd);return assert(!writeSockaddr(addr,sock.family,DNS.lookup_name(sock.saddr||"0.0.0.0"),sock.sport,addrlen)),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_getsockopt:function(fd,level,optname,optval,optlen,d1){try{var sock=getSocketFromFD(fd);return 1===level&&4===optname?(HEAP32[optval>>2]=sock.error,HEAP32[optlen>>2]=4,sock.error=null,0):-50}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_ioctl:function(fd,op,varargs){SYSCALLS.varargs=varargs;try{var stream=SYSCALLS.getStreamFromFD(fd);switch(op){case 21509:case 21510:case 21511:case 21512:case 21524:case 21515:return stream.tty?0:-59;case 21505:if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcgets){var termios=stream.tty.ops.ioctl_tcgets(stream),argp=syscallGetVarargP();HEAP32[argp>>2]=termios.c_iflag||0,HEAP32[argp+4>>2]=termios.c_oflag||0,HEAP32[argp+8>>2]=termios.c_cflag||0,HEAP32[argp+12>>2]=termios.c_lflag||0;for(var i=0;i<32;i++)HEAP8[argp+i+17]=termios.c_cc[i]||0;return 0}return 0;case 21506:case 21507:case 21508:if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tcsets){argp=syscallGetVarargP();var c_iflag=HEAP32[argp>>2],c_oflag=HEAP32[argp+4>>2],c_cflag=HEAP32[argp+8>>2],c_lflag=HEAP32[argp+12>>2],c_cc=[];for(i=0;i<32;i++)c_cc.push(HEAP8[argp+i+17]);return stream.tty.ops.ioctl_tcsets(stream.tty,op,{c_iflag:c_iflag,c_oflag:c_oflag,c_cflag:c_cflag,c_lflag:c_lflag,c_cc:c_cc})}return 0;case 21519:if(!stream.tty)return-59;argp=syscallGetVarargP();return HEAP32[argp>>2]=0,0;case 21520:return stream.tty?-28:-59;case 21531:argp=syscallGetVarargP();return FS.ioctl(stream,op,argp);case 21523:if(!stream.tty)return-59;if(stream.tty.ops.ioctl_tiocgwinsz){var winsize=stream.tty.ops.ioctl_tiocgwinsz(stream.tty);argp=syscallGetVarargP();HEAP16[argp>>1]=winsize[0],HEAP16[argp+2>>1]=winsize[1]}return 0;default:return-28}}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_listen:function(fd,backlog){try{var sock=getSocketFromFD(fd);return sock.sock_ops.listen(sock,backlog),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_lstat64:function(path,buf){try{return path=SYSCALLS.getStr(path),SYSCALLS.doStat(FS.lstat,path,buf)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_mkdirat:function(dirfd,path,mode){try{return path=SYSCALLS.getStr(path),path=SYSCALLS.calculateAt(dirfd,path),"/"===(path=PATH.normalize(path))[path.length-1]&&(path=path.substr(0,path.length-1)),FS.mkdir(path,mode,0),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_mknodat:function(dirfd,path,mode,dev){try{switch(path=SYSCALLS.getStr(path),path=SYSCALLS.calculateAt(dirfd,path),61440&mode){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return FS.mknod(path,mode,dev),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_newfstatat:function(dirfd,path,buf,flags){try{path=SYSCALLS.getStr(path);var nofollow=256&flags,allowEmpty=4096&flags;return assert(!(flags&=-6401),`unknown flags in __syscall_newfstatat: ${flags}`),path=SYSCALLS.calculateAt(dirfd,path,allowEmpty),SYSCALLS.doStat(nofollow?FS.lstat:FS.stat,path,buf)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_openat:function(dirfd,path,flags,varargs){SYSCALLS.varargs=varargs;try{path=SYSCALLS.getStr(path),path=SYSCALLS.calculateAt(dirfd,path);var mode=varargs?syscallGetVarargI():0;return FS.open(path,flags,mode).fd}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_poll:function(fds,nfds,timeout){try{for(var nonzero=0,i=0;i<nfds;i++){var pollfd=fds+8*i,fd=HEAP32[pollfd>>2],events=HEAP16[pollfd+4>>1],mask=32,stream=FS.getStream(fd);stream&&(mask=SYSCALLS.DEFAULT_POLLMASK,stream.stream_ops.poll&&(mask=stream.stream_ops.poll(stream,-1))),(mask&=24|events)&&nonzero++,HEAP16[pollfd+6>>1]=mask}return nonzero}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_readlinkat:function(dirfd,path,buf,bufsize){try{if(path=SYSCALLS.getStr(path),path=SYSCALLS.calculateAt(dirfd,path),bufsize<=0)return-28;var ret=FS.readlink(path),len=Math.min(bufsize,lengthBytesUTF8(ret)),endChar=HEAP8[buf+len];return stringToUTF8(ret,buf,bufsize+1),HEAP8[buf+len]=endChar,len}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_recvfrom:function(fd,buf,len,flags,addr,addrlen){try{var sock=getSocketFromFD(fd),msg=sock.sock_ops.recvmsg(sock,len);if(!msg)return 0;if(addr)assert(!writeSockaddr(addr,sock.family,DNS.lookup_name(msg.addr),msg.port,addrlen));return HEAPU8.set(msg.buffer,buf),msg.buffer.byteLength}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_renameat:function(olddirfd,oldpath,newdirfd,newpath){try{return oldpath=SYSCALLS.getStr(oldpath),newpath=SYSCALLS.getStr(newpath),oldpath=SYSCALLS.calculateAt(olddirfd,oldpath),newpath=SYSCALLS.calculateAt(newdirfd,newpath),FS.rename(oldpath,newpath),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_rmdir:function(path){try{return path=SYSCALLS.getStr(path),FS.rmdir(path),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_sendto:function(fd,message,length,flags,addr,addr_len){try{var sock=getSocketFromFD(fd);if(!addr)return FS.write(sock.stream,HEAP8,message,length);var dest=getSocketAddress(addr,addr_len);return sock.sock_ops.sendmsg(sock,HEAP8,message,length,dest.addr,dest.port)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_socket:function(domain,type,protocol){try{var sock=SOCKFS.createSocket(domain,type,protocol);return assert(sock.stream.fd<64),sock.stream.fd}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_stat64:function(path,buf){try{return path=SYSCALLS.getStr(path),SYSCALLS.doStat(FS.stat,path,buf)}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_statfs64:function(path,size,buf){try{assert(64===size);var stats=FS.statfs(SYSCALLS.getStr(path));return HEAP32[buf+4>>2]=stats.bsize,HEAP32[buf+40>>2]=stats.bsize,HEAP32[buf+8>>2]=stats.blocks,HEAP32[buf+12>>2]=stats.bfree,HEAP32[buf+16>>2]=stats.bavail,HEAP32[buf+20>>2]=stats.files,HEAP32[buf+24>>2]=stats.ffree,HEAP32[buf+28>>2]=stats.fsid,HEAP32[buf+44>>2]=stats.flags,HEAP32[buf+36>>2]=stats.namelen,0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_symlinkat:function(target,dirfd,linkpath){try{return target=SYSCALLS.getStr(target),linkpath=SYSCALLS.getStr(linkpath),linkpath=SYSCALLS.calculateAt(dirfd,linkpath),FS.symlink(target,linkpath),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},__syscall_unlinkat:function(dirfd,path,flags){try{return path=SYSCALLS.getStr(path),path=SYSCALLS.calculateAt(dirfd,path),0===flags?FS.unlink(path):512===flags?FS.rmdir(path):abort("Invalid flags passed to unlinkat"),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return-e.errno}},_abort_js:()=>abort("native code called abort()"),_emscripten_get_now_is_monotonic:()=>1,_emscripten_runtime_keepalive_clear:__emscripten_runtime_keepalive_clear,_gmtime_js:function(time,tmPtr){time=bigintToI53Checked(time);var date=new Date(1e3*time);HEAP32[tmPtr>>2]=date.getUTCSeconds(),HEAP32[tmPtr+4>>2]=date.getUTCMinutes(),HEAP32[tmPtr+8>>2]=date.getUTCHours(),HEAP32[tmPtr+12>>2]=date.getUTCDate(),HEAP32[tmPtr+16>>2]=date.getUTCMonth(),HEAP32[tmPtr+20>>2]=date.getUTCFullYear()-1900,HEAP32[tmPtr+24>>2]=date.getUTCDay();var start=Date.UTC(date.getUTCFullYear(),0,1,0,0,0,0),yday=(date.getTime()-start)/864e5|0;HEAP32[tmPtr+28>>2]=yday},_localtime_js:function(time,tmPtr){time=bigintToI53Checked(time);var date=new Date(1e3*time);HEAP32[tmPtr>>2]=date.getSeconds(),HEAP32[tmPtr+4>>2]=date.getMinutes(),HEAP32[tmPtr+8>>2]=date.getHours(),HEAP32[tmPtr+12>>2]=date.getDate(),HEAP32[tmPtr+16>>2]=date.getMonth(),HEAP32[tmPtr+20>>2]=date.getFullYear()-1900,HEAP32[tmPtr+24>>2]=date.getDay();var yday=0|(date=>{var year;return((year=date.getFullYear())%4!=0||year%100==0&&year%400!=0?MONTH_DAYS_REGULAR_CUMULATIVE:MONTH_DAYS_LEAP_CUMULATIVE)[date.getMonth()]+date.getDate()-1})(date);HEAP32[tmPtr+28>>2]=yday,HEAP32[tmPtr+36>>2]=-60*date.getTimezoneOffset();var start=new Date(date.getFullYear(),0,1),summerOffset=new Date(date.getFullYear(),6,1).getTimezoneOffset(),winterOffset=start.getTimezoneOffset(),dst=0|(summerOffset!=winterOffset&&date.getTimezoneOffset()==Math.min(winterOffset,summerOffset));HEAP32[tmPtr+32>>2]=dst},_setitimer_js:(which,timeout_ms)=>{if(timers[which]&&(clearTimeout(timers[which].id),delete timers[which]),!timeout_ms)return 0;var id=setTimeout((()=>{assert(which in timers),delete timers[which],callUserCallback((()=>__emscripten_timeout(which,_emscripten_get_now())))}),timeout_ms);return timers[which]={id:id,timeout_ms:timeout_ms},0},_tzset_js:(timezone,daylight,std_name,dst_name)=>{var currentYear=(new Date).getFullYear(),winter=new Date(currentYear,0,1),summer=new Date(currentYear,6,1),winterOffset=winter.getTimezoneOffset(),summerOffset=summer.getTimezoneOffset(),stdTimezoneOffset=Math.max(winterOffset,summerOffset);HEAPU32[timezone>>2]=60*stdTimezoneOffset,HEAP32[daylight>>2]=Number(winterOffset!=summerOffset);var extractZone=timezoneOffset=>{var sign=timezoneOffset>=0?"-":"+",absOffset=Math.abs(timezoneOffset);return`UTC${sign}${String(Math.floor(absOffset/60)).padStart(2,"0")}${String(absOffset%60).padStart(2,"0")}`},winterName=extractZone(winterOffset),summerName=extractZone(summerOffset);assert(winterName),assert(summerName),assert(lengthBytesUTF8(winterName)<=16,`timezone name truncated to fit in TZNAME_MAX (${winterName})`),assert(lengthBytesUTF8(summerName)<=16,`timezone name truncated to fit in TZNAME_MAX (${summerName})`),summerOffset<winterOffset?(stringToUTF8(winterName,std_name,17),stringToUTF8(summerName,dst_name,17)):(stringToUTF8(winterName,dst_name,17),stringToUTF8(summerName,std_name,17))},emscripten_cancel_main_loop:()=>{MainLoop.pause(),MainLoop.func=null},emscripten_date_now:()=>Date.now(),emscripten_err:str=>err(UTF8ToString(str)),emscripten_force_exit:status=>{__emscripten_runtime_keepalive_clear(),_exit(status)},emscripten_get_now:_emscripten_get_now,emscripten_resize_heap:requestedSize=>{var oldSize=HEAPU8.length;assert((requestedSize>>>=0)>oldSize);var size,alignment;if(requestedSize>2147483648)return err(`Cannot enlarge memory, requested ${requestedSize} bytes, but the limit is 2147483648 bytes!`),!1;for(var cutDown=1;cutDown<=4;cutDown*=2){var overGrownHeapSize=oldSize*(1+.2/cutDown);overGrownHeapSize=Math.min(overGrownHeapSize,requestedSize+100663296);var newSize=Math.min(2147483648,(size=Math.max(requestedSize,overGrownHeapSize),assert(alignment=65536,"alignment argument is required"),Math.ceil(size/alignment)*alignment));if(growMemory(newSize))return!0}return err(`Failed to grow the heap from ${oldSize} bytes to ${newSize} bytes, not enough memory!`),!1},emscripten_set_canvas_element_size:(target,width,height)=>{var canvas=findCanvasEventTarget(target);return canvas?(canvas.width=width,canvas.height=height,canvas.GLctxObject&&GL.resizeOffscreenFramebuffer(canvas.GLctxObject),0):-4},emscripten_set_main_loop:(func,fps,simulateInfiniteLoop)=>{var iterFunc=getWasmTableEntry(func);setMainLoop(iterFunc,fps,simulateInfiniteLoop)},emscripten_webgl_commit_frame:_emscripten_webgl_commit_frame,emscripten_webgl_create_context:_emscripten_webgl_create_context,emscripten_webgl_destroy_context:contextHandle=>{GL.currentContext==contextHandle&&(GL.currentContext=0),GL.deleteContext(contextHandle)},emscripten_webgl_enable_extension:(contextHandle,extension)=>{var context=GL.getContext(contextHandle),extString=UTF8ToString(extension);return extString.startsWith("GL_")&&(extString=extString.substr(3)),"ANGLE_instanced_arrays"==extString&&webgl_enable_ANGLE_instanced_arrays(GLctx),"OES_vertex_array_object"==extString&&webgl_enable_OES_vertex_array_object(GLctx),"WEBGL_draw_buffers"==extString&&webgl_enable_WEBGL_draw_buffers(GLctx),"WEBGL_draw_instanced_base_vertex_base_instance"==extString&&webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance(GLctx),"WEBGL_multi_draw_instanced_base_vertex_base_instance"==extString&&webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance(GLctx),"WEBGL_multi_draw"==extString&&webgl_enable_WEBGL_multi_draw(GLctx),"EXT_polygon_offset_clamp"==extString&&webgl_enable_EXT_polygon_offset_clamp(GLctx),"EXT_clip_control"==extString&&webgl_enable_EXT_clip_control(GLctx),"WEBGL_polygon_mode"==extString&&webgl_enable_WEBGL_polygon_mode(GLctx),!!context.GLctx.getExtension(extString)},emscripten_webgl_get_supported_extensions:()=>stringToNewUTF8(GLctx.getSupportedExtensions().join(" ")),emscripten_webgl_make_context_current:contextHandle=>GL.makeContextCurrent(contextHandle)?0:-5,environ_get:(__environ,environ_buf)=>{var bufSize=0;return getEnvStrings().forEach(((string,i)=>{var ptr=environ_buf+bufSize;HEAPU32[__environ+4*i>>2]=ptr,((str,buffer)=>{for(var i=0;i<str.length;++i)assert(str.charCodeAt(i)===(255&str.charCodeAt(i))),HEAP8[buffer++]=str.charCodeAt(i);HEAP8[buffer]=0})(string,ptr),bufSize+=string.length+1})),0},environ_sizes_get:(penviron_count,penviron_buf_size)=>{var strings=getEnvStrings();HEAPU32[penviron_count>>2]=strings.length;var bufSize=0;return strings.forEach((string=>bufSize+=string.length+1)),HEAPU32[penviron_buf_size>>2]=bufSize,0},exit:_exit,fd_close:function(fd){try{var stream=SYSCALLS.getStreamFromFD(fd);return FS.close(stream),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return e.errno}},fd_fdstat_get:function(fd,pbuf){try{var stream=SYSCALLS.getStreamFromFD(fd),type=stream.tty?2:FS.isDir(stream.mode)?3:FS.isLink(stream.mode)?7:4;return HEAP8[pbuf]=type,HEAP16[pbuf+2>>1]=0,HEAP64[pbuf+8>>3]=BigInt(0),HEAP64[pbuf+16>>3]=BigInt(0),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return e.errno}},fd_read:function(fd,iov,iovcnt,pnum){try{var num=((stream,iov,iovcnt,offset)=>{for(var ret=0,i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>2],len=HEAPU32[iov+4>>2];iov+=8;var curr=FS.read(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;if(ret+=curr,curr<len)break;void 0!==offset&&(offset+=curr)}return ret})(SYSCALLS.getStreamFromFD(fd),iov,iovcnt);return HEAPU32[pnum>>2]=num,0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return e.errno}},fd_seek:function(fd,offset,whence,newOffset){offset=bigintToI53Checked(offset);try{if(isNaN(offset))return 61;var stream=SYSCALLS.getStreamFromFD(fd);return FS.llseek(stream,offset,whence),HEAP64[newOffset>>3]=BigInt(stream.position),stream.getdents&&0===offset&&0===whence&&(stream.getdents=null),0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return e.errno}},fd_write:function(fd,iov,iovcnt,pnum){try{var num=((stream,iov,iovcnt,offset)=>{for(var ret=0,i=0;i<iovcnt;i++){var ptr=HEAPU32[iov>>2],len=HEAPU32[iov+4>>2];iov+=8;var curr=FS.write(stream,HEAP8,ptr,len,offset);if(curr<0)return-1;if(ret+=curr,curr<len)break;void 0!==offset&&(offset+=curr)}return ret})(SYSCALLS.getStreamFromFD(fd),iov,iovcnt);return HEAPU32[pnum>>2]=num,0}catch(e){if(void 0===FS||"ErrnoError"!==e.name)throw e;return e.errno}},getaddrinfo:(node,service,hint,out)=>{var ai,addr=0,port=0,flags=0,family=0,type=0,proto=0;function allocaddrinfo(family,type,proto,canon,addr,port){var sa,salen,ai;return salen=10===family?28:16,addr=10===family?inetNtop6(addr):inetNtop4(addr),sa=_malloc(salen),assert(!writeSockaddr(sa,family,addr,port)),ai=_malloc(32),HEAP32[ai+4>>2]=family,HEAP32[ai+8>>2]=type,HEAP32[ai+12>>2]=proto,HEAPU32[ai+24>>2]=canon,HEAPU32[ai+20>>2]=sa,HEAP32[ai+16>>2]=10===family?28:16,HEAP32[ai+28>>2]=0,ai}if(hint&&(flags=HEAP32[hint>>2],family=HEAP32[hint+4>>2],type=HEAP32[hint+8>>2],proto=HEAP32[hint+12>>2]),type&&!proto&&(proto=2===type?17:6),!type&&proto&&(type=17===proto?2:1),0===proto&&(proto=6),0===type&&(type=1),!node&&!service)return-2;if(-1088&flags)return-1;if(0!==hint&&2&HEAP32[hint>>2]&&!node)return-1;if(32&flags)return-2;if(0!==type&&1!==type&&2!==type)return-7;if(0!==family&&2!==family&&10!==family)return-6;if(service&&(service=UTF8ToString(service),port=parseInt(service,10),isNaN(port)))return 1024&flags?-2:-8;if(!node)return 0===family&&(family=2),1&flags||(addr=2===family?_htonl(2130706433):[0,0,0,_htonl(1)]),ai=allocaddrinfo(family,type,proto,null,addr,port),HEAPU32[out>>2]=ai,0;if(node=UTF8ToString(node),null!==(addr=inetPton4(node)))if(0===family||2===family)family=2;else{if(!(10===family&&8&flags))return-2;addr=[0,0,_htonl(65535),addr],family=10}else if(null!==(addr=inetPton6(node))){if(0!==family&&10!==family)return-2;family=10}return null!=addr?(ai=allocaddrinfo(family,type,proto,node,addr,port),HEAPU32[out>>2]=ai,0):4&flags?-2:(node=DNS.lookup_name(node),addr=inetPton4(node),0===family?family=2:10===family&&(addr=[0,0,_htonl(65535),addr]),ai=allocaddrinfo(family,type,proto,null,addr,port),HEAPU32[out>>2]=ai,0)},getnameinfo:(sa,salen,node,nodelen,serv,servlen,flags)=>{var info=readSockaddr(sa,salen);if(info.errno)return-6;var port=info.port,addr=info.addr,overflowed=!1;if(node&&nodelen){var lookup;if(1&flags||!(lookup=DNS.lookup_addr(addr))){if(8&flags)return-2}else addr=lookup;stringToUTF8(addr,node,nodelen)+1>=nodelen&&(overflowed=!0)}serv&&servlen&&(stringToUTF8(port=""+port,serv,servlen)+1>=servlen&&(overflowed=!0));return overflowed?-12:0},glActiveTexture:x0=>GLctx.activeTexture(x0),glAttachShader:(program,shader)=>{GLctx.attachShader(GL.programs[program],GL.shaders[shader])},glBeginTransformFeedback:x0=>GLctx.beginTransformFeedback(x0),glBindBuffer:(target,buffer)=>{35051==target?GLctx.currentPixelPackBufferBinding=buffer:35052==target&&(GLctx.currentPixelUnpackBufferBinding=buffer),GLctx.bindBuffer(target,GL.buffers[buffer])},glBindBufferBase:(target,index,buffer)=>{GLctx.bindBufferBase(target,index,GL.buffers[buffer])},glBindBufferRange:(target,index,buffer,offset,ptrsize)=>{GLctx.bindBufferRange(target,index,GL.buffers[buffer],offset,ptrsize)},glBindFramebuffer:(target,framebuffer)=>{GLctx.bindFramebuffer(target,framebuffer?GL.framebuffers[framebuffer]:GL.currentContext.defaultFbo)},glBindRenderbuffer:(target,renderbuffer)=>{GLctx.bindRenderbuffer(target,GL.renderbuffers[renderbuffer])},glBindTexture:(target,texture)=>{GLctx.bindTexture(target,GL.textures[texture])},glBindVertexArray:vao=>{GLctx.bindVertexArray(GL.vaos[vao])},glBlendColor:(x0,x1,x2,x3)=>GLctx.blendColor(x0,x1,x2,x3),glBlendEquation:x0=>GLctx.blendEquation(x0),glBlendFunc:(x0,x1)=>GLctx.blendFunc(x0,x1),glBlendFuncSeparate:(x0,x1,x2,x3)=>GLctx.blendFuncSeparate(x0,x1,x2,x3),glBlitFramebuffer:(x0,x1,x2,x3,x4,x5,x6,x7,x8,x9)=>GLctx.blitFramebuffer(x0,x1,x2,x3,x4,x5,x6,x7,x8,x9),glBufferData:(target,size,data,usage)=>{GL.currentContext.version>=2?data&&size?GLctx.bufferData(target,HEAPU8,usage,data,size):GLctx.bufferData(target,size,usage):GLctx.bufferData(target,data?HEAPU8.subarray(data,data+size):size,usage)},glBufferSubData:(target,offset,size,data)=>{GL.currentContext.version>=2?size&&GLctx.bufferSubData(target,offset,HEAPU8,data,size):GLctx.bufferSubData(target,offset,HEAPU8.subarray(data,data+size))},glCheckFramebufferStatus:x0=>GLctx.checkFramebufferStatus(x0),glClear:x0=>GLctx.clear(x0),glClearBufferfv:(buffer,drawbuffer,value)=>{GLctx.clearBufferfv(buffer,drawbuffer,HEAPF32,value>>2)},glClearColor:(x0,x1,x2,x3)=>GLctx.clearColor(x0,x1,x2,x3),glClearDepthf:x0=>GLctx.clearDepth(x0),glColorMask:(red,green,blue,alpha)=>{GLctx.colorMask(!!red,!!green,!!blue,!!alpha)},glCompileShader:shader=>{GLctx.compileShader(GL.shaders[shader])},glCompressedTexImage2D:(target,level,internalFormat,width,height,border,imageSize,data)=>{if(GL.currentContext.version>=2)return GLctx.currentPixelUnpackBufferBinding||!imageSize?void GLctx.compressedTexImage2D(target,level,internalFormat,width,height,border,imageSize,data):void GLctx.compressedTexImage2D(target,level,internalFormat,width,height,border,HEAPU8,data,imageSize);GLctx.compressedTexImage2D(target,level,internalFormat,width,height,border,HEAPU8.subarray(data,data+imageSize))},glCompressedTexImage3D:(target,level,internalFormat,width,height,depth,border,imageSize,data)=>{GLctx.currentPixelUnpackBufferBinding?GLctx.compressedTexImage3D(target,level,internalFormat,width,height,depth,border,imageSize,data):GLctx.compressedTexImage3D(target,level,internalFormat,width,height,depth,border,HEAPU8,data,imageSize)},glCompressedTexSubImage3D:(target,level,xoffset,yoffset,zoffset,width,height,depth,format,imageSize,data)=>{GLctx.currentPixelUnpackBufferBinding?GLctx.compressedTexSubImage3D(target,level,xoffset,yoffset,zoffset,width,height,depth,format,imageSize,data):GLctx.compressedTexSubImage3D(target,level,xoffset,yoffset,zoffset,width,height,depth,format,HEAPU8,data,imageSize)},glCopyBufferSubData:(x0,x1,x2,x3,x4)=>GLctx.copyBufferSubData(x0,x1,x2,x3,x4),glCreateProgram:()=>{var id=GL.getNewId(GL.programs),program=GLctx.createProgram();return program.name=id,program.maxUniformLength=program.maxAttributeLength=program.maxUniformBlockNameLength=0,program.uniformIdCounter=1,GL.programs[id]=program,id},glCreateShader:shaderType=>{var id=GL.getNewId(GL.shaders);return GL.shaders[id]=GLctx.createShader(shaderType),id},glCullFace:x0=>GLctx.cullFace(x0),glDeleteBuffers:(n,buffers)=>{for(var i=0;i<n;i++){var id=HEAP32[buffers+4*i>>2],buffer=GL.buffers[id];buffer&&(GLctx.deleteBuffer(buffer),buffer.name=0,GL.buffers[id]=null,id==GLctx.currentPixelPackBufferBinding&&(GLctx.currentPixelPackBufferBinding=0),id==GLctx.currentPixelUnpackBufferBinding&&(GLctx.currentPixelUnpackBufferBinding=0))}},glDeleteFramebuffers:(n,framebuffers)=>{for(var i=0;i<n;++i){var id=HEAP32[framebuffers+4*i>>2],framebuffer=GL.framebuffers[id];framebuffer&&(GLctx.deleteFramebuffer(framebuffer),framebuffer.name=0,GL.framebuffers[id]=null)}},glDeleteProgram:id=>{if(id){var program=GL.programs[id];program?(GLctx.deleteProgram(program),program.name=0,GL.programs[id]=null):GL.recordError(1281)}},glDeleteQueries:(n,ids)=>{for(var i=0;i<n;i++){var id=HEAP32[ids+4*i>>2],query=GL.queries[id];query&&(GLctx.deleteQuery(query),GL.queries[id]=null)}},glDeleteRenderbuffers:(n,renderbuffers)=>{for(var i=0;i<n;i++){var id=HEAP32[renderbuffers+4*i>>2],renderbuffer=GL.renderbuffers[id];renderbuffer&&(GLctx.deleteRenderbuffer(renderbuffer),renderbuffer.name=0,GL.renderbuffers[id]=null)}},glDeleteShader:id=>{if(id){var shader=GL.shaders[id];shader?(GLctx.deleteShader(shader),GL.shaders[id]=null):GL.recordError(1281)}},glDeleteSync:id=>{if(id){var sync=GL.syncs[id];sync?(GLctx.deleteSync(sync),sync.name=0,GL.syncs[id]=null):GL.recordError(1281)}},glDeleteTextures:(n,textures)=>{for(var i=0;i<n;i++){var id=HEAP32[textures+4*i>>2],texture=GL.textures[id];texture&&(GLctx.deleteTexture(texture),texture.name=0,GL.textures[id]=null)}},glDeleteVertexArrays:(n,vaos)=>{for(var i=0;i<n;i++){var id=HEAP32[vaos+4*i>>2];GLctx.deleteVertexArray(GL.vaos[id]),GL.vaos[id]=null}},glDepthFunc:x0=>GLctx.depthFunc(x0),glDepthMask:flag=>{GLctx.depthMask(!!flag)},glDisable:x0=>GLctx.disable(x0),glDisableVertexAttribArray:index=>{GLctx.disableVertexAttribArray(index)},glDrawArrays:(mode,first,count)=>{GLctx.drawArrays(mode,first,count)},glDrawArraysInstanced:(mode,first,count,primcount)=>{GLctx.drawArraysInstanced(mode,first,count,primcount)},glDrawBuffers:(n,bufs)=>{for(var bufArray=tempFixedLengthArray[n],i=0;i<n;i++)bufArray[i]=HEAP32[bufs+4*i>>2];GLctx.drawBuffers(bufArray)},glDrawElements:(mode,count,type,indices)=>{GLctx.drawElements(mode,count,type,indices)},glDrawElementsInstanced:(mode,count,type,indices,primcount)=>{GLctx.drawElementsInstanced(mode,count,type,indices,primcount)},glEnable:x0=>GLctx.enable(x0),glEnableVertexAttribArray:index=>{GLctx.enableVertexAttribArray(index)},glEndTransformFeedback:()=>GLctx.endTransformFeedback(),glFenceSync:(condition,flags)=>{var sync=GLctx.fenceSync(condition,flags);if(sync){var id=GL.getNewId(GL.syncs);return sync.name=id,GL.syncs[id]=sync,id}return 0},glFinish:()=>GLctx.finish(),glFramebufferRenderbuffer:(target,attachment,renderbuffertarget,renderbuffer)=>{GLctx.framebufferRenderbuffer(target,attachment,renderbuffertarget,GL.renderbuffers[renderbuffer])},glFramebufferTexture2D:(target,attachment,textarget,texture,level)=>{GLctx.framebufferTexture2D(target,attachment,textarget,GL.textures[texture],level)},glFramebufferTextureLayer:(target,attachment,texture,level,layer)=>{GLctx.framebufferTextureLayer(target,attachment,GL.textures[texture],level,layer)},glFrontFace:x0=>GLctx.frontFace(x0),glGenBuffers:(n,buffers)=>{GL.genObject(n,buffers,"createBuffer",GL.buffers)},glGenFramebuffers:(n,ids)=>{GL.genObject(n,ids,"createFramebuffer",GL.framebuffers)},glGenQueries:(n,ids)=>{GL.genObject(n,ids,"createQuery",GL.queries)},glGenRenderbuffers:(n,renderbuffers)=>{GL.genObject(n,renderbuffers,"createRenderbuffer",GL.renderbuffers)},glGenTextures:(n,textures)=>{GL.genObject(n,textures,"createTexture",GL.textures)},glGenVertexArrays:(n,arrays)=>{GL.genObject(n,arrays,"createVertexArray",GL.vaos)},glGenerateMipmap:x0=>GLctx.generateMipmap(x0),glGetFloatv:(name_,p)=>emscriptenWebGLGet(name_,p,2),glGetInteger64v:(name_,p)=>{emscriptenWebGLGet(name_,p,1)},glGetIntegerv:(name_,p)=>emscriptenWebGLGet(name_,p,0),glGetProgramInfoLog:(program,maxLength,length,infoLog)=>{var log=GLctx.getProgramInfoLog(GL.programs[program]);null===log&&(log="(unknown error)");var numBytesWrittenExclNull=maxLength>0&&infoLog?stringToUTF8(log,infoLog,maxLength):0;length&&(HEAP32[length>>2]=numBytesWrittenExclNull)},glGetProgramiv:(program,pname,p)=>{if(p)if(program>=GL.counter)GL.recordError(1281);else if(program=GL.programs[program],35716==pname){var log=GLctx.getProgramInfoLog(program);null===log&&(log="(unknown error)"),HEAP32[p>>2]=log.length+1}else if(35719==pname){if(!program.maxUniformLength)for(var numActiveUniforms=GLctx.getProgramParameter(program,35718),i=0;i<numActiveUniforms;++i)program.maxUniformLength=Math.max(program.maxUniformLength,GLctx.getActiveUniform(program,i).name.length+1);HEAP32[p>>2]=program.maxUniformLength}else if(35722==pname){if(!program.maxAttributeLength){var numActiveAttributes=GLctx.getProgramParameter(program,35721);for(i=0;i<numActiveAttributes;++i)program.maxAttributeLength=Math.max(program.maxAttributeLength,GLctx.getActiveAttrib(program,i).name.length+1)}HEAP32[p>>2]=program.maxAttributeLength}else if(35381==pname){if(!program.maxUniformBlockNameLength){var numActiveUniformBlocks=GLctx.getProgramParameter(program,35382);for(i=0;i<numActiveUniformBlocks;++i)program.maxUniformBlockNameLength=Math.max(program.maxUniformBlockNameLength,GLctx.getActiveUniformBlockName(program,i).length+1)}HEAP32[p>>2]=program.maxUniformBlockNameLength}else HEAP32[p>>2]=GLctx.getProgramParameter(program,pname);else GL.recordError(1281)},glGetShaderInfoLog:(shader,maxLength,length,infoLog)=>{var log=GLctx.getShaderInfoLog(GL.shaders[shader]);null===log&&(log="(unknown error)");var numBytesWrittenExclNull=maxLength>0&&infoLog?stringToUTF8(log,infoLog,maxLength):0;length&&(HEAP32[length>>2]=numBytesWrittenExclNull)},glGetShaderiv:(shader,pname,p)=>{if(p)if(35716==pname){var log=GLctx.getShaderInfoLog(GL.shaders[shader]);null===log&&(log="(unknown error)");var logLength=log?log.length+1:0;HEAP32[p>>2]=logLength}else if(35720==pname){var source=GLctx.getShaderSource(GL.shaders[shader]),sourceLength=source?source.length+1:0;HEAP32[p>>2]=sourceLength}else HEAP32[p>>2]=GLctx.getShaderParameter(GL.shaders[shader],pname);else GL.recordError(1281)},glGetString:name_=>{var ret=GL.stringCache[name_];if(!ret){switch(name_){case 7939:ret=stringToNewUTF8(webglGetExtensions().join(" "));break;case 7936:case 7937:case 37445:case 37446:var s=GLctx.getParameter(name_);s||GL.recordError(1280),ret=s?stringToNewUTF8(s):0;break;case 7938:var webGLVersion=GLctx.getParameter(7938),glVersion=`OpenGL ES 2.0 (${webGLVersion})`;GL.currentContext.version>=2&&(glVersion=`OpenGL ES 3.0 (${webGLVersion})`),ret=stringToNewUTF8(glVersion);break;case 35724:var glslVersion=GLctx.getParameter(35724),ver_num=glslVersion.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==ver_num&&(3==ver_num[1].length&&(ver_num[1]=ver_num[1]+"0"),glslVersion=`OpenGL ES GLSL ES ${ver_num[1]} (${glslVersion})`),ret=stringToNewUTF8(glslVersion);break;default:GL.recordError(1280)}GL.stringCache[name_]=ret}return ret},glGetSynciv:(sync,pname,bufSize,length,values)=>{if(bufSize<0)GL.recordError(1281);else if(values){var ret=GLctx.getSyncParameter(GL.syncs[sync],pname);null!==ret&&(HEAP32[values>>2]=ret,length&&(HEAP32[length>>2]=1))}else GL.recordError(1281)},glGetUniformBlockIndex:(program,uniformBlockName)=>GLctx.getUniformBlockIndex(GL.programs[program],UTF8ToString(uniformBlockName)),glGetUniformLocation:(program,name)=>{if(name=UTF8ToString(name),program=GL.programs[program]){(program=>{var i,j,uniformLocsById=program.uniformLocsById,uniformSizeAndIdsByName=program.uniformSizeAndIdsByName;if(!uniformLocsById){program.uniformLocsById=uniformLocsById={},program.uniformArrayNamesById={};var numActiveUniforms=GLctx.getProgramParameter(program,35718);for(i=0;i<numActiveUniforms;++i){var u=GLctx.getActiveUniform(program,i),nm=u.name,sz=u.size,lb=webglGetLeftBracePos(nm),arrayName=lb>0?nm.slice(0,lb):nm,id=program.uniformIdCounter;for(program.uniformIdCounter+=sz,uniformSizeAndIdsByName[arrayName]=[sz,id],j=0;j<sz;++j)uniformLocsById[id]=j,program.uniformArrayNamesById[id++]=arrayName}}})(program);var uniformLocsById=program.uniformLocsById,arrayIndex=0,uniformBaseName=name,leftBrace=webglGetLeftBracePos(name);leftBrace>0&&(arrayIndex=jstoi_q(name.slice(leftBrace+1))>>>0,uniformBaseName=name.slice(0,leftBrace));var sizeAndId=program.uniformSizeAndIdsByName[uniformBaseName];if(sizeAndId&&arrayIndex<sizeAndId[0]&&(uniformLocsById[arrayIndex+=sizeAndId[1]]=uniformLocsById[arrayIndex]||GLctx.getUniformLocation(program,name)))return arrayIndex}else GL.recordError(1281);return-1},glLinkProgram:program=>{program=GL.programs[program],GLctx.linkProgram(program),program.uniformLocsById=0,program.uniformSizeAndIdsByName={}},glPixelStorei:(pname,param)=>{3317==pname?GL.unpackAlignment=param:3314==pname&&(GL.unpackRowLength=param),GLctx.pixelStorei(pname,param)},glReadBuffer:x0=>GLctx.readBuffer(x0),glReadPixels:(x,y,width,height,format,type,pixels)=>{if(GL.currentContext.version>=2){if(GLctx.currentPixelPackBufferBinding)return void GLctx.readPixels(x,y,width,height,format,type,pixels);var heap=heapObjectForWebGLType(type),target=toTypedArrayIndex(pixels,heap);GLctx.readPixels(x,y,width,height,format,type,heap,target)}else{var pixelData=emscriptenWebGLGetTexPixelData(type,format,width,height,pixels);pixelData?GLctx.readPixels(x,y,width,height,format,type,pixelData):GL.recordError(1280)}},glRenderbufferStorage:(x0,x1,x2,x3)=>GLctx.renderbufferStorage(x0,x1,x2,x3),glRenderbufferStorageMultisample:(x0,x1,x2,x3,x4)=>GLctx.renderbufferStorageMultisample(x0,x1,x2,x3,x4),glScissor:(x0,x1,x2,x3)=>GLctx.scissor(x0,x1,x2,x3),glShaderSource:(shader,count,string,length)=>{var source=GL.getSource(shader,count,string,length);GLctx.shaderSource(GL.shaders[shader],source)},glTexImage2D:(target,level,internalFormat,width,height,border,format,type,pixels)=>{if(GL.currentContext.version>=2){if(GLctx.currentPixelUnpackBufferBinding)return void GLctx.texImage2D(target,level,internalFormat,width,height,border,format,type,pixels);if(pixels){var heap=heapObjectForWebGLType(type),index=toTypedArrayIndex(pixels,heap);return void GLctx.texImage2D(target,level,internalFormat,width,height,border,format,type,heap,index)}}var pixelData=pixels?emscriptenWebGLGetTexPixelData(type,format,width,height,pixels):null;GLctx.texImage2D(target,level,internalFormat,width,height,border,format,type,pixelData)},glTexImage3D:(target,level,internalFormat,width,height,depth,border,format,type,pixels)=>{if(GLctx.currentPixelUnpackBufferBinding)GLctx.texImage3D(target,level,internalFormat,width,height,depth,border,format,type,pixels);else if(pixels){var heap=heapObjectForWebGLType(type);GLctx.texImage3D(target,level,internalFormat,width,height,depth,border,format,type,heap,toTypedArrayIndex(pixels,heap))}else GLctx.texImage3D(target,level,internalFormat,width,height,depth,border,format,type,null)},glTexParameterf:(x0,x1,x2)=>GLctx.texParameterf(x0,x1,x2),glTexParameteri:(x0,x1,x2)=>GLctx.texParameteri(x0,x1,x2),glTexStorage2D:(x0,x1,x2,x3,x4)=>GLctx.texStorage2D(x0,x1,x2,x3,x4),glTexSubImage3D:(target,level,xoffset,yoffset,zoffset,width,height,depth,format,type,pixels)=>{if(GLctx.currentPixelUnpackBufferBinding)GLctx.texSubImage3D(target,level,xoffset,yoffset,zoffset,width,height,depth,format,type,pixels);else if(pixels){var heap=heapObjectForWebGLType(type);GLctx.texSubImage3D(target,level,xoffset,yoffset,zoffset,width,height,depth,format,type,heap,toTypedArrayIndex(pixels,heap))}else GLctx.texSubImage3D(target,level,xoffset,yoffset,zoffset,width,height,depth,format,type,null)},glTransformFeedbackVaryings:(program,count,varyings,bufferMode)=>{program=GL.programs[program];for(var vars=[],i=0;i<count;i++)vars.push(UTF8ToString(HEAP32[varyings+4*i>>2]));GLctx.transformFeedbackVaryings(program,vars,bufferMode)},glUniform1f:(location,v0)=>{GLctx.uniform1f(webglGetUniformLocation(location),v0)},glUniform1i:(location,v0)=>{GLctx.uniform1i(webglGetUniformLocation(location),v0)},glUniform1iv:(location,count,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniform1iv(webglGetUniformLocation(location),HEAP32,value>>2,count);else{if(count<=288)for(var view=miniTempWebGLIntBuffers[count],i=0;i<count;++i)view[i]=HEAP32[value+4*i>>2];else view=HEAP32.subarray(value>>2,value+4*count>>2);GLctx.uniform1iv(webglGetUniformLocation(location),view)}},glUniform1ui:(location,v0)=>{GLctx.uniform1ui(webglGetUniformLocation(location),v0)},glUniform1uiv:(location,count,value)=>{count&&GLctx.uniform1uiv(webglGetUniformLocation(location),HEAPU32,value>>2,count)},glUniform2f:(location,v0,v1)=>{GLctx.uniform2f(webglGetUniformLocation(location),v0,v1)},glUniform2fv:(location,count,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniform2fv(webglGetUniformLocation(location),HEAPF32,value>>2,2*count);else{if(count<=144)for(var view=miniTempWebGLFloatBuffers[count*=2],i=0;i<count;i+=2)view[i]=HEAPF32[value+4*i>>2],view[i+1]=HEAPF32[value+(4*i+4)>>2];else view=HEAPF32.subarray(value>>2,value+8*count>>2);GLctx.uniform2fv(webglGetUniformLocation(location),view)}},glUniform2iv:(location,count,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniform2iv(webglGetUniformLocation(location),HEAP32,value>>2,2*count);else{if(count<=144)for(var view=miniTempWebGLIntBuffers[count*=2],i=0;i<count;i+=2)view[i]=HEAP32[value+4*i>>2],view[i+1]=HEAP32[value+(4*i+4)>>2];else view=HEAP32.subarray(value>>2,value+8*count>>2);GLctx.uniform2iv(webglGetUniformLocation(location),view)}},glUniform3fv:(location,count,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniform3fv(webglGetUniformLocation(location),HEAPF32,value>>2,3*count);else{if(count<=96)for(var view=miniTempWebGLFloatBuffers[count*=3],i=0;i<count;i+=3)view[i]=HEAPF32[value+4*i>>2],view[i+1]=HEAPF32[value+(4*i+4)>>2],view[i+2]=HEAPF32[value+(4*i+8)>>2];else view=HEAPF32.subarray(value>>2,value+12*count>>2);GLctx.uniform3fv(webglGetUniformLocation(location),view)}},glUniform4f:(location,v0,v1,v2,v3)=>{GLctx.uniform4f(webglGetUniformLocation(location),v0,v1,v2,v3)},glUniform4fv:(location,count,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniform4fv(webglGetUniformLocation(location),HEAPF32,value>>2,4*count);else{if(count<=72){var view=miniTempWebGLFloatBuffers[4*count],heap=HEAPF32;value>>=2,count*=4;for(var i=0;i<count;i+=4){var dst=value+i;view[i]=heap[dst],view[i+1]=heap[dst+1],view[i+2]=heap[dst+2],view[i+3]=heap[dst+3]}}else view=HEAPF32.subarray(value>>2,value+16*count>>2);GLctx.uniform4fv(webglGetUniformLocation(location),view)}},glUniformBlockBinding:(program,uniformBlockIndex,uniformBlockBinding)=>{program=GL.programs[program],GLctx.uniformBlockBinding(program,uniformBlockIndex,uniformBlockBinding)},glUniformMatrix3fv:(location,count,transpose,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniformMatrix3fv(webglGetUniformLocation(location),!!transpose,HEAPF32,value>>2,9*count);else{if(count<=32)for(var view=miniTempWebGLFloatBuffers[count*=9],i=0;i<count;i+=9)view[i]=HEAPF32[value+4*i>>2],view[i+1]=HEAPF32[value+(4*i+4)>>2],view[i+2]=HEAPF32[value+(4*i+8)>>2],view[i+3]=HEAPF32[value+(4*i+12)>>2],view[i+4]=HEAPF32[value+(4*i+16)>>2],view[i+5]=HEAPF32[value+(4*i+20)>>2],view[i+6]=HEAPF32[value+(4*i+24)>>2],view[i+7]=HEAPF32[value+(4*i+28)>>2],view[i+8]=HEAPF32[value+(4*i+32)>>2];else view=HEAPF32.subarray(value>>2,value+36*count>>2);GLctx.uniformMatrix3fv(webglGetUniformLocation(location),!!transpose,view)}},glUniformMatrix4fv:(location,count,transpose,value)=>{if(GL.currentContext.version>=2)count&&GLctx.uniformMatrix4fv(webglGetUniformLocation(location),!!transpose,HEAPF32,value>>2,16*count);else{if(count<=18){var view=miniTempWebGLFloatBuffers[16*count],heap=HEAPF32;value>>=2,count*=16;for(var i=0;i<count;i+=16){var dst=value+i;view[i]=heap[dst],view[i+1]=heap[dst+1],view[i+2]=heap[dst+2],view[i+3]=heap[dst+3],view[i+4]=heap[dst+4],view[i+5]=heap[dst+5],view[i+6]=heap[dst+6],view[i+7]=heap[dst+7],view[i+8]=heap[dst+8],view[i+9]=heap[dst+9],view[i+10]=heap[dst+10],view[i+11]=heap[dst+11],view[i+12]=heap[dst+12],view[i+13]=heap[dst+13],view[i+14]=heap[dst+14],view[i+15]=heap[dst+15]}}else view=HEAPF32.subarray(value>>2,value+64*count>>2);GLctx.uniformMatrix4fv(webglGetUniformLocation(location),!!transpose,view)}},glUseProgram:program=>{program=GL.programs[program],GLctx.useProgram(program),GLctx.currentProgram=program},glVertexAttrib4f:(x0,x1,x2,x3,x4)=>GLctx.vertexAttrib4f(x0,x1,x2,x3,x4),glVertexAttribDivisor:(index,divisor)=>{GLctx.vertexAttribDivisor(index,divisor)},glVertexAttribI4ui:(x0,x1,x2,x3,x4)=>GLctx.vertexAttribI4ui(x0,x1,x2,x3,x4),glVertexAttribIPointer:(index,size,type,stride,ptr)=>{GLctx.vertexAttribIPointer(index,size,type,stride,ptr)},glVertexAttribPointer:(index,size,type,normalized,stride,ptr)=>{GLctx.vertexAttribPointer(index,size,type,!!normalized,stride,ptr)},glViewport:(x0,x1,x2,x3)=>GLctx.viewport(x0,x1,x2,x3),godot_audio_has_script_processor:function(){return 1},godot_audio_has_worklet:function(){return 0},godot_audio_init:function(p_mix_rate,p_latency,p_state_change,p_latency_update){const statechange=GodotRuntime.get_func(p_state_change),latencyupdate=GodotRuntime.get_func(p_latency_update),mix_rate=GodotRuntime.getHeapValue(p_mix_rate,"i32"),channels=GodotAudio.init(mix_rate,p_latency,statechange,latencyupdate);return GodotRuntime.setHeapValue(p_mix_rate,GodotAudio.ctx.sampleRate,"i32"),channels},godot_audio_input_start:function(){return GodotAudio.create_input((function(input){input.connect(GodotAudio.driver.get_node())}))},godot_audio_input_stop:function(){if(GodotAudio.input){const tracks=GodotAudio.input.mediaStream.getTracks();for(let i=0;i<tracks.length;i++)tracks[i].stop();GodotAudio.input.disconnect(),GodotAudio.input=null}},godot_audio_is_available:function(){return 1},godot_audio_resume:function(){GodotAudio.ctx&&"running"!==GodotAudio.ctx.state&&GodotAudio.ctx.resume()},godot_audio_sample_bus_add:function(atPos){GodotAudio.add_sample_bus(atPos)},godot_audio_sample_bus_move:function(fromPos,toPos){GodotAudio.move_sample_bus(fromPos,toPos)},godot_audio_sample_bus_remove:function(index){GodotAudio.remove_sample_bus(index)},godot_audio_sample_bus_set_count:function(count){GodotAudio.set_sample_bus_count(count)},godot_audio_sample_bus_set_mute:function(bus,enable){GodotAudio.set_sample_bus_mute(bus,Boolean(enable))},godot_audio_sample_bus_set_send:function(bus,sendIndex){GodotAudio.set_sample_bus_send(bus,sendIndex)},godot_audio_sample_bus_set_solo:function(bus,enable){GodotAudio.set_sample_bus_solo(bus,Boolean(enable))},godot_audio_sample_bus_set_volume_db:function(bus,volumeDb){GodotAudio.set_sample_bus_volume_db(bus,volumeDb)},godot_audio_sample_is_active:function(playbackObjectIdStrPtr){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr);return Number(GodotAudio.sampleNodes.has(playbackObjectId))},godot_audio_sample_register_stream:function(streamObjectIdStrPtr,framesPtr,framesTotal,loopModeStrPtr,loopBegin,loopEnd){const streamObjectId=GodotRuntime.parseString(streamObjectIdStrPtr),loopMode=GodotRuntime.parseString(loopModeStrPtr),sampleRate=GodotAudio.ctx.sampleRate,subLeft=GodotRuntime.heapSub(HEAPF32,framesPtr,framesTotal),subRight=GodotRuntime.heapSub(HEAPF32,framesPtr+4*framesTotal,framesTotal),audioBuffer=GodotAudio.ctx.createBuffer(2,framesTotal,sampleRate);audioBuffer.copyToChannel(new Float32Array(subLeft),0,0),audioBuffer.copyToChannel(new Float32Array(subRight),1,0),GodotAudio.Sample.create({id:streamObjectId,audioBuffer:audioBuffer},{loopBegin:loopBegin,loopEnd:loopEnd,loopMode:loopMode,numberOfChannels:2,sampleRate:sampleRate})},godot_audio_sample_set_finished_callback:function(callbackPtr){GodotAudio.sampleFinishedCallback=GodotRuntime.get_func(callbackPtr)},godot_audio_sample_set_pause:function(playbackObjectIdStrPtr,pause){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr);GodotAudio.sample_set_pause(playbackObjectId,Boolean(pause))},godot_audio_sample_set_volumes_linear:function(playbackObjectIdStrPtr,busesPtr,busesSize,volumesPtr,volumesSize){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr),buses=GodotRuntime.heapSub(HEAP32,busesPtr,busesSize),volumes=GodotRuntime.heapSub(HEAPF32,volumesPtr,volumesSize);GodotAudio.sample_set_volumes_linear(playbackObjectId,Array.from(buses),volumes)},godot_audio_sample_start:function(playbackObjectIdStrPtr,streamObjectIdStrPtr,busIndex,offset,volumePtr){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr),streamObjectId=GodotRuntime.parseString(streamObjectIdStrPtr),startOptions={offset:offset,volume:GodotRuntime.heapSub(HEAPF32,volumePtr,8),playbackRate:1};GodotAudio.start_sample(playbackObjectId,streamObjectId,busIndex,startOptions)},godot_audio_sample_stop:function(playbackObjectIdStrPtr){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr);GodotAudio.stop_sample(playbackObjectId)},godot_audio_sample_stream_is_registered:function(streamObjectIdStrPtr){const streamObjectId=GodotRuntime.parseString(streamObjectIdStrPtr);return Number(null!=GodotAudio.Sample.getSampleOrNull(streamObjectId))},godot_audio_sample_unregister_stream:function(streamObjectIdStrPtr){const streamObjectId=GodotRuntime.parseString(streamObjectIdStrPtr),sample=GodotAudio.Sample.getSampleOrNull(streamObjectId);null!=sample&&sample.clear()},godot_audio_sample_update_pitch_scale:function(playbackObjectIdStrPtr,pitchScale){const playbackObjectId=GodotRuntime.parseString(playbackObjectIdStrPtr);GodotAudio.update_sample_pitch_scale(playbackObjectId,pitchScale)},godot_audio_script_create:function(buffer_length,channel_count){const buf_len=GodotRuntime.getHeapValue(buffer_length,"i32");try{const out_len=GodotAudioScript.create(buf_len,channel_count);GodotRuntime.setHeapValue(buffer_length,out_len,"i32")}catch(e){return GodotRuntime.error("Error starting AudioDriverScriptProcessor",e),1}return 0},godot_audio_script_start:function(p_in_buf,p_in_size,p_out_buf,p_out_size,p_cb){const onprocess=GodotRuntime.get_func(p_cb);GodotAudioScript.start(p_in_buf,p_in_size,p_out_buf,p_out_size,onprocess)},godot_audio_worklet_create:function(channels){try{GodotAudioWorklet.create(channels)}catch(e){return GodotRuntime.error("Error starting AudioDriverWorklet",e),1}return 0},godot_audio_worklet_start_no_threads:function(p_out_buf,p_out_size,p_out_callback,p_in_buf,p_in_size,p_in_callback){const out_callback=GodotRuntime.get_func(p_out_callback),in_callback=GodotRuntime.get_func(p_in_callback);GodotAudioWorklet.start_no_threads(p_out_buf,p_out_size,out_callback,p_in_buf,p_in_size,in_callback)},godot_js_config_canvas_id_get:function(p_ptr,p_ptr_max){GodotRuntime.stringToHeap(`#${GodotConfig.canvas.id}`,p_ptr,p_ptr_max)},godot_js_config_locale_get:function(p_ptr,p_ptr_max){GodotRuntime.stringToHeap(GodotConfig.locale,p_ptr,p_ptr_max)},godot_js_display_alert:function(p_text){window.alert(GodotRuntime.parseString(p_text))},godot_js_display_canvas_focus:function(){GodotConfig.canvas.focus()},godot_js_display_canvas_is_focused:function(){return document.activeElement===GodotConfig.canvas},godot_js_display_clipboard_get:function(callback){const func=GodotRuntime.get_func(callback);try{navigator.clipboard.readText().then((function(result){const ptr=GodotRuntime.allocString(result);func(ptr),GodotRuntime.free(ptr)})).catch((function(e){}))}catch(e){}},godot_js_display_clipboard_set:function(p_text){const text=GodotRuntime.parseString(p_text);return navigator.clipboard&&navigator.clipboard.writeText?(navigator.clipboard.writeText(text).catch((function(e){GodotRuntime.error("Setting OS clipboard is only possible from an input callback for the Web platform. Exception:",e)})),0):1},godot_js_display_cursor_is_hidden:function(){return!GodotDisplayCursor.visible},godot_js_display_cursor_is_locked:function(){return GodotDisplayCursor.isPointerLocked()?1:0},godot_js_display_cursor_lock_set:function(p_lock){p_lock?GodotDisplayCursor.lockPointer():GodotDisplayCursor.releasePointer()},godot_js_display_cursor_set_custom_shape:function(p_shape,p_ptr,p_len,p_hotspot_x,p_hotspot_y){const shape=GodotRuntime.parseString(p_shape),old_shape=GodotDisplayCursor.cursors[shape];if(p_len>0){const png=new Blob([GodotRuntime.heapSlice(HEAPU8,p_ptr,p_len)],{type:"image/png"}),url=URL.createObjectURL(png);GodotDisplayCursor.cursors[shape]={url:url,x:p_hotspot_x,y:p_hotspot_y}}else delete GodotDisplayCursor.cursors[shape];shape===GodotDisplayCursor.shape&&GodotDisplayCursor.set_shape(GodotDisplayCursor.shape),old_shape&&URL.revokeObjectURL(old_shape.url)},godot_js_display_cursor_set_shape:function(p_string){GodotDisplayCursor.set_shape(GodotRuntime.parseString(p_string))},godot_js_display_cursor_set_visible:function(p_visible){const visible=0!==p_visible;visible!==GodotDisplayCursor.visible&&(GodotDisplayCursor.visible=visible,visible?GodotDisplayCursor.set_shape(GodotDisplayCursor.shape):GodotDisplayCursor.set_style("none"))},godot_js_display_desired_size_set:function(width,height){GodotDisplayScreen.desired_size=[width,height],GodotDisplayScreen.updateSize()},godot_js_display_fullscreen_cb:function(callback){const canvas=GodotConfig.canvas,func=GodotRuntime.get_func(callback);function change_cb(evt){evt.target===canvas&&func(GodotDisplayScreen.isFullscreen())}GodotEventListeners.add(document,"fullscreenchange",change_cb,!1),GodotEventListeners.add(document,"mozfullscreenchange",change_cb,!1),GodotEventListeners.add(document,"webkitfullscreenchange",change_cb,!1)},godot_js_display_fullscreen_exit:function(){return GodotDisplayScreen.exitFullscreen()},godot_js_display_fullscreen_request:function(){return GodotDisplayScreen.requestFullscreen()},godot_js_display_has_webgl:function(p_version){if(1!==p_version&&2!==p_version)return!1;try{return!!document.createElement("canvas").getContext(2===p_version?"webgl2":"webgl")}catch(e){}return!1},godot_js_display_is_swap_ok_cancel:function(){const plat=navigator.platform||"";return-1!==["Windows","Win64","Win32","WinCE"].indexOf(plat)?1:0},godot_js_display_notification_cb:function(callback,p_enter,p_exit,p_in,p_out){const canvas=GodotConfig.canvas,func=GodotRuntime.get_func(callback),notif=[p_enter,p_exit,p_in,p_out];["mouseover","mouseleave","focus","blur"].forEach((function(evt_name,idx){GodotEventListeners.add(canvas,evt_name,(function(){func(notif[idx])}),!0)}))},godot_js_display_pixel_ratio_get:function(){return GodotDisplayScreen.getPixelRatio()},godot_js_display_screen_dpi_get:function(){return GodotDisplay_getDPI()},godot_js_display_screen_size_get:function(width,height){const scale=GodotDisplayScreen.getPixelRatio();GodotRuntime.setHeapValue(width,window.screen.width*scale,"i32"),GodotRuntime.setHeapValue(height,window.screen.height*scale,"i32")},godot_js_display_setup_canvas:function(p_width,p_height,p_fullscreen,p_hidpi){const canvas=GodotConfig.canvas;switch(GodotEventListeners.add(canvas,"contextmenu",(function(ev){ev.preventDefault()}),!1),GodotEventListeners.add(canvas,"webglcontextlost",(function(ev){alert("WebGL context lost, please reload the page"),ev.preventDefault()}),!1),GodotDisplayScreen.hidpi=!!p_hidpi,GodotConfig.canvas_resize_policy){case 0:GodotDisplayScreen.desired_size=[canvas.width,canvas.height];break;case 1:GodotDisplayScreen.desired_size=[p_width,p_height];break;default:canvas.style.position="absolute",canvas.style.top=0,canvas.style.left=0}GodotDisplayScreen.updateSize(),p_fullscreen&&GodotDisplayScreen.requestFullscreen()},godot_js_display_size_update:function(){const updated=GodotDisplayScreen.updateSize();return updated&&GodotDisplayVK.updateSize(),updated},godot_js_display_touchscreen_is_available:function(){return"ontouchstart"in window},godot_js_display_tts_available:function(){return"speechSynthesis"in window},godot_js_display_vk_available:function(){return GodotDisplayVK.available()},godot_js_display_vk_cb:function(p_input_cb){const input_cb=GodotRuntime.get_func(p_input_cb);GodotDisplayVK.available()&&GodotDisplayVK.init(input_cb)},godot_js_display_vk_hide:function(){GodotDisplayVK.hide()},godot_js_display_vk_show:function(p_text,p_type,p_start,p_end){const text=GodotRuntime.parseString(p_text),start=p_start>0?p_start:0,end=p_end>0?p_end:start;GodotDisplayVK.show(text,p_type,start,end)},godot_js_display_window_blur_cb:function(callback){const func=GodotRuntime.get_func(callback);GodotEventListeners.add(window,"blur",(function(){func()}),!1)},godot_js_display_window_icon_set:function(p_ptr,p_len){},godot_js_display_window_size_get:function(p_width,p_height){GodotRuntime.setHeapValue(p_width,GodotConfig.canvas.width,"i32"),GodotRuntime.setHeapValue(p_height,GodotConfig.canvas.height,"i32")},godot_js_display_window_title_set:function(p_data){},godot_js_fetch_create:function(p_method,p_url,p_headers,p_headers_size,p_body,p_body_size){const method=GodotRuntime.parseString(p_method),url=GodotRuntime.parseString(p_url),headers=GodotRuntime.parseStringArray(p_headers,p_headers_size),body=p_body_size?GodotRuntime.heapSlice(HEAP8,p_body,p_body_size):null;return GodotFetch.create(method,url,headers.map((function(hv){const idx=hv.indexOf(":");return idx<=0?[]:[hv.slice(0,idx).trim(),hv.slice(idx+1).trim()]})).filter((function(v){return 2===v.length})),body)},godot_js_fetch_free:function(id){GodotFetch.free(id)},godot_js_fetch_http_status_get:function(p_id){const obj=IDHandler.get(p_id);return obj&&obj.response?obj.status:0},godot_js_fetch_is_chunked:function(p_id){const obj=IDHandler.get(p_id);return obj&&obj.response?obj.chunked?1:0:-1},godot_js_fetch_read_chunk:function(p_id,p_buf,p_buf_size){const obj=IDHandler.get(p_id);if(!obj||!obj.response)return 0;let to_read=p_buf_size;const chunks=obj.chunks;for(;to_read&&chunks.length;){const chunk=obj.chunks[0];chunk.length>to_read?(GodotRuntime.heapCopy(HEAP8,chunk.slice(0,to_read),p_buf),chunks[0]=chunk.slice(to_read),to_read=0):(GodotRuntime.heapCopy(HEAP8,chunk,p_buf),to_read-=chunk.length,chunks.pop())}return chunks.length||GodotFetch.read(p_id),p_buf_size-to_read},godot_js_fetch_read_headers:function(p_id,p_parse_cb,p_ref){const obj=IDHandler.get(p_id);if(!obj||!obj.response)return 1;const cb=GodotRuntime.get_func(p_parse_cb),arr=[];obj.response.headers.forEach((function(v,h){arr.push(`${h}:${v}`)}));const c_ptr=GodotRuntime.allocStringArray(arr);return cb(arr.length,c_ptr,p_ref),GodotRuntime.freeStringArray(c_ptr,arr.length),0},godot_js_fetch_state_get:function(p_id){const obj=IDHandler.get(p_id);return obj?obj.error?-1:obj.response?obj.reader?1:obj.done?2:-1:0:-1},godot_js_input_drop_files_cb:function(callback){const func=GodotRuntime.get_func(callback),canvas=GodotConfig.canvas;GodotEventListeners.add(canvas,"dragover",(function(ev){ev.preventDefault()}),!1),GodotEventListeners.add(canvas,"drop",GodotInputDragDrop.handler((function(files){const args=files||[];if(!args.length)return;const argc=args.length,argv=GodotRuntime.allocStringArray(args);func(argv,argc),GodotRuntime.freeStringArray(argv,argc)})))},godot_js_input_gamepad_cb:function(change_cb){const onchange=GodotRuntime.get_func(change_cb);GodotInputGamepads.init(onchange)},godot_js_input_gamepad_sample:function(){return GodotInputGamepads.sample(),0},godot_js_input_gamepad_sample_count:function(){return GodotInputGamepads.get_samples().length},godot_js_input_gamepad_sample_get:function(p_index,r_btns,r_btns_num,r_axes,r_axes_num,r_standard){const sample=GodotInputGamepads.get_sample(p_index);if(!sample||!sample.connected)return 1;const btns=sample.buttons,btns_len=btns.length<16?btns.length:16;for(let i=0;i<btns_len;i++)GodotRuntime.setHeapValue(r_btns+(i<<2),btns[i],"float");GodotRuntime.setHeapValue(r_btns_num,btns_len,"i32");const axes=sample.axes,axes_len=axes.length<10?axes.length:10;for(let i=0;i<axes_len;i++)GodotRuntime.setHeapValue(r_axes+(i<<2),axes[i],"float");GodotRuntime.setHeapValue(r_axes_num,axes_len,"i32");const is_standard=sample.standard?1:0;return GodotRuntime.setHeapValue(r_standard,is_standard,"i32"),0},godot_js_input_key_cb:function(callback,code,key){const func=GodotRuntime.get_func(callback);function key_cb(pressed,evt){const modifiers=GodotInput_getModifiers(evt);GodotRuntime.stringToHeap(evt.code,code,32),GodotRuntime.stringToHeap(evt.key,key,32),func(pressed,evt.repeat,modifiers),evt.preventDefault()}GodotEventListeners.add(GodotConfig.canvas,"keydown",key_cb.bind(null,1),!1),GodotEventListeners.add(GodotConfig.canvas,"keyup",key_cb.bind(null,0),!1)},godot_js_input_mouse_button_cb:function(callback){const func=GodotRuntime.get_func(callback),canvas=GodotConfig.canvas;function button_cb(p_pressed,evt){const rect=canvas.getBoundingClientRect(),pos=GodotInput_computePosition(evt,rect),modifiers=GodotInput_getModifiers(evt);p_pressed&&GodotConfig.canvas.focus(),func(p_pressed,evt.button,pos[0],pos[1],modifiers)&&evt.preventDefault()}GodotEventListeners.add(canvas,"mousedown",button_cb.bind(null,1),!1),GodotEventListeners.add(window,"mouseup",button_cb.bind(null,0),!1)},godot_js_input_mouse_move_cb:function(callback){const func=GodotRuntime.get_func(callback),canvas=GodotConfig.canvas;GodotEventListeners.add(window,"mousemove",(function(evt){const rect=canvas.getBoundingClientRect(),pos=GodotInput_computePosition(evt,rect),rw=canvas.width/rect.width,rh=canvas.height/rect.height,rel_pos_x=evt.movementX*rw,rel_pos_y=evt.movementY*rh,modifiers=GodotInput_getModifiers(evt);func(pos[0],pos[1],rel_pos_x,rel_pos_y,modifiers)}),!1)},godot_js_input_mouse_wheel_cb:function(callback){const func=GodotRuntime.get_func(callback);GodotEventListeners.add(GodotConfig.canvas,"wheel",(function(evt){func(evt.deltaX||0,evt.deltaY||0)&&evt.preventDefault()}),!1)},godot_js_input_paste_cb:function(callback){const func=GodotRuntime.get_func(callback);GodotEventListeners.add(window,"paste",(function(evt){const text=evt.clipboardData.getData("text"),ptr=GodotRuntime.allocString(text);func(ptr),GodotRuntime.free(ptr)}),!1)},godot_js_input_touch_cb:function(callback,ids,coords){const func=GodotRuntime.get_func(callback),canvas=GodotConfig.canvas;function touch_cb(type,evt){0===type&&GodotConfig.canvas.focus();const rect=canvas.getBoundingClientRect(),touches=evt.changedTouches;for(let i=0;i<touches.length;i++){const touch=touches[i],pos=GodotInput_computePosition(touch,rect);GodotRuntime.setHeapValue(coords+2*i*8,pos[0],"double"),GodotRuntime.setHeapValue(coords+8*(2*i+1),pos[1],"double"),GodotRuntime.setHeapValue(ids+4*i,touch.identifier,"i32")}func(type,touches.length),evt.cancelable&&evt.preventDefault()}GodotEventListeners.add(canvas,"touchstart",touch_cb.bind(null,0),!1),GodotEventListeners.add(canvas,"touchend",touch_cb.bind(null,1),!1),GodotEventListeners.add(canvas,"touchcancel",touch_cb.bind(null,1),!1),GodotEventListeners.add(canvas,"touchmove",touch_cb.bind(null,2),!1)},godot_js_input_vibrate_handheld:function(p_duration_ms){"function"!=typeof navigator.vibrate?GodotRuntime.print("This browser does not support vibration."):navigator.vibrate(p_duration_ms)},godot_js_is_ime_focused:function(){return GodotIME.active},godot_js_os_download_buffer:function(p_ptr,p_size,p_name,p_mime){const buf=GodotRuntime.heapSlice(HEAP8,p_ptr,p_size),name=GodotRuntime.parseString(p_name),mime=GodotRuntime.parseString(p_mime),blob=new Blob([buf],{type:mime}),url=window.URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download=name,a.style.display="none",document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(url)},godot_js_os_execute:function(p_json){const json_args=GodotRuntime.parseString(p_json),args=JSON.parse(json_args);return GodotConfig.on_execute?(GodotConfig.on_execute(args),0):1},godot_js_os_finish_async:function(p_callback){const func=GodotRuntime.get_func(p_callback);GodotOS.finish_async(func)},godot_js_os_fs_is_persistent:function(){return GodotFS.is_persistent()},godot_js_os_fs_sync:function(callback){const func=GodotRuntime.get_func(callback);GodotOS._fs_sync_promise=GodotFS.sync(),GodotOS._fs_sync_promise.then((function(err){func()}))},godot_js_os_has_feature:function(p_ftr){const ftr=GodotRuntime.parseString(p_ftr),ua=navigator.userAgent;return"web_macos"===ftr?-1!==ua.indexOf("Mac")?1:0:"web_windows"===ftr?-1!==ua.indexOf("Windows")?1:0:"web_android"===ftr?-1!==ua.indexOf("Android")?1:0:"web_ios"===ftr?-1!==ua.indexOf("iPhone")||-1!==ua.indexOf("iPad")||-1!==ua.indexOf("iPod")?1:0:"web_linuxbsd"===ftr&&(-1!==ua.indexOf("CrOS")||-1!==ua.indexOf("BSD")||-1!==ua.indexOf("Linux")||-1!==ua.indexOf("X11"))?1:0},godot_js_os_hw_concurrency_get:function(){const concurrency=navigator.hardwareConcurrency||1;return concurrency<2?concurrency:2},godot_js_os_request_quit_cb:function(p_callback){GodotOS.request_quit=GodotRuntime.get_func(p_callback)},godot_js_os_shell_open:function(p_uri){window.open(GodotRuntime.parseString(p_uri),"_blank")},godot_js_pwa_cb:function(p_update_cb){if("serviceWorker"in navigator){const cb=GodotRuntime.get_func(p_update_cb);navigator.serviceWorker.getRegistration().then(GodotPWA.updateState.bind(null,cb))}},godot_js_pwa_update:function(){return"serviceWorker"in navigator&&GodotPWA.hasUpdate?(navigator.serviceWorker.getRegistration().then((function(reg){reg&&reg.waiting&&reg.waiting.postMessage("update")})),0):1},godot_js_set_ime_active:function(p_active){GodotIME.ime_active(p_active)},godot_js_set_ime_cb:function(p_ime_cb,p_key_cb,code,key){},godot_js_set_ime_position:function(p_x,p_y){GodotIME.ime_position(p_x,p_y)},godot_js_tts_get_voices:function(p_callback){const func=GodotRuntime.get_func(p_callback);try{const arr=[],voices=window.speechSynthesis.getVoices();for(let i=0;i<voices.length;i++)arr.push(`${voices[i].lang};${voices[i].name}`);const c_ptr=GodotRuntime.allocStringArray(arr);func(arr.length,c_ptr),GodotRuntime.freeStringArray(c_ptr,arr.length)}catch(e){}},godot_js_tts_is_paused:function(){return window.speechSynthesis.paused},godot_js_tts_is_speaking:function(){return window.speechSynthesis.speaking},godot_js_tts_pause:function(){window.speechSynthesis.pause()},godot_js_tts_resume:function(){window.speechSynthesis.resume()},godot_js_tts_speak:function(p_text,p_voice,p_volume,p_pitch,p_rate,p_utterance_id,p_callback){const func=GodotRuntime.get_func(p_callback),utterance=new SpeechSynthesisUtterance(GodotRuntime.parseString(p_text));utterance.rate=p_rate,utterance.pitch=p_pitch,utterance.volume=p_volume/100,utterance.addEventListener("end",(function(evt){evt.currentTarget.cb(1,evt.currentTarget.id,0)})),utterance.addEventListener("start",(function(evt){evt.currentTarget.cb(0,evt.currentTarget.id,0)})),utterance.addEventListener("error",(function(evt){evt.currentTarget.cb(2,evt.currentTarget.id,0)})),utterance.addEventListener("boundary",(function(evt){evt.currentTarget.cb(3,evt.currentTarget.id,evt.charIndex)})),utterance.id=p_utterance_id,utterance.cb=func;const voice=GodotRuntime.parseString(p_voice),voices=window.speechSynthesis.getVoices();for(let i=0;i<voices.length;i++)if(voices[i].name===voice){utterance.voice=voices[i];break}window.speechSynthesis.resume(),window.speechSynthesis.speak(utterance)},godot_js_tts_stop:function(){window.speechSynthesis.cancel(),window.speechSynthesis.resume()},godot_js_websocket_buffered_amount:function(p_id){return GodotWebSocket.bufferedAmount(p_id)},godot_js_websocket_close:function(p_id,p_code,p_reason){const code=p_code,reason=GodotRuntime.parseString(p_reason);GodotWebSocket.close(p_id,code,reason)},godot_js_websocket_create:function(p_ref,p_url,p_proto,p_on_open,p_on_message,p_on_error,p_on_close){const on_open=GodotRuntime.get_func(p_on_open).bind(null,p_ref),on_message=GodotRuntime.get_func(p_on_message).bind(null,p_ref),on_error=GodotRuntime.get_func(p_on_error).bind(null,p_ref),on_close=GodotRuntime.get_func(p_on_close).bind(null,p_ref),url=GodotRuntime.parseString(p_url),protos=GodotRuntime.parseString(p_proto);let socket=null;try{socket=protos?new WebSocket(url,protos.split(",")):new WebSocket(url)}catch(e){return 0}return socket.binaryType="arraybuffer",GodotWebSocket.create(socket,on_open,on_message,on_error,on_close)},godot_js_websocket_destroy:function(p_id){GodotWebSocket.destroy(p_id)},godot_js_websocket_send:function(p_id,p_buf,p_buf_len,p_raw){const bytes_array=new Uint8Array(p_buf_len);let i=0;for(i=0;i<p_buf_len;i++)bytes_array[i]=GodotRuntime.getHeapValue(p_buf+i,"i8");let out=bytes_array.buffer;return p_raw||(out=new TextDecoder("utf-8").decode(bytes_array)),GodotWebSocket.send(p_id,out)},godot_webgl2_glFramebufferTextureMultisampleMultiviewOVR:function(target,attachment,texture,level,samples,base_view_index,num_views){const context=GL.currentContext;if(void 0===context.oculusMultiviewExt){const ext=context.GLctx.getExtension("OCULUS_multiview");if(!ext)return void GodotRuntime.error("Trying to call glFramebufferTextureMultisampleMultiviewOVR() without the OCULUS_multiview extension");context.oculusMultiviewExt=ext}context.oculusMultiviewExt.framebufferTextureMultisampleMultiviewOVR(target,attachment,GL.textures[texture],level,samples,base_view_index,num_views)},godot_webgl2_glFramebufferTextureMultiviewOVR:function(target,attachment,texture,level,base_view_index,num_views){const context=GL.currentContext;if(void 0===context.multiviewExt){const ext=context.GLctx.getExtension("OVR_multiview2");if(!ext)return void GodotRuntime.error("Trying to call glFramebufferTextureMultiviewOVR() without the OVR_multiview2 extension");context.multiviewExt=ext}context.multiviewExt.framebufferTextureMultiviewOVR(target,attachment,GL.textures[texture],level,base_view_index,num_views)},godot_webgl2_glGetBufferSubData:function(target,offset,size,data){const gl_context_handle=_emscripten_webgl_get_current_context(),gl=GL.getContext(gl_context_handle);gl&&gl.GLctx.getBufferSubData(target,offset,HEAPU8,data,size)},proc_exit:_proc_exit},wasmExports=function(){function receiveInstance(instance,module){var cb;return wasmExports=instance.exports,assert(wasmMemory=wasmExports.memory,"memory not found in wasm exports"),updateMemoryViews(),assert(wasmTable=wasmExports.__indirect_function_table,"table not found in wasm exports"),cb=wasmExports.__wasm_call_ctors,__ATINIT__.unshift(cb),removeRunDependency("wasm-instantiate"),wasmExports}addRunDependency("wasm-instantiate");var binary,binaryFile,imports,callback,trueModule=Module,info={env:wasmImports,wasi_snapshot_preview1:wasmImports};if(Module.instantiateWasm)try{return Module.instantiateWasm(info,receiveInstance)}catch(e){err(`Module.instantiateWasm callback failed with error: ${e}`),readyPromiseReject(e)}return wasmBinaryFile??=findWasmBinary(),(binary=wasmBinary,binaryFile=wasmBinaryFile,imports=info,callback=function(result){assert(Module===trueModule,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),trueModule=null,receiveInstance(result.instance)},binary||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(binaryFile)||"function"!=typeof fetch?instantiateArrayBuffer(binaryFile,imports,callback):fetch(binaryFile,{credentials:"same-origin"}).then((response=>WebAssembly.instantiateStreaming(response,imports).then(callback,(function(reason){return err(`wasm streaming compile failed: ${reason}`),err("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(binaryFile,imports,callback)}))))).catch(readyPromiseReject),{}}(),_main=(createExportWrapper("__wasm_call_ctors",0),Module.__Z14godot_web_mainiPPc=createExportWrapper("_Z14godot_web_mainiPPc",2),Module._main=createExportWrapper("__main_argc_argv",2)),_malloc=createExportWrapper("malloc",1),_free=createExportWrapper("free",1),_fflush=createExportWrapper("fflush",1),_htonl=createExportWrapper("htonl",1),_htons=createExportWrapper("htons",1),_ntohs=createExportWrapper("ntohs",1),_strerror=createExportWrapper("strerror",1),___funcs_on_exit=createExportWrapper("__funcs_on_exit",0),__emscripten_timeout=createExportWrapper("_emscripten_timeout",2),_emscripten_stack_init=()=>(_emscripten_stack_init=wasmExports.emscripten_stack_init)(),_emscripten_stack_get_end=()=>(_emscripten_stack_get_end=wasmExports.emscripten_stack_get_end)(),__emscripten_stack_restore=a0=>(__emscripten_stack_restore=wasmExports._emscripten_stack_restore)(a0),__emscripten_stack_alloc=a0=>(__emscripten_stack_alloc=wasmExports._emscripten_stack_alloc)(a0),_emscripten_stack_get_current=()=>(_emscripten_stack_get_current=wasmExports.emscripten_stack_get_current)();Module.callMain=callMain,Module.cwrap=(ident,returnType,argTypes,opts)=>(...args)=>ccall(ident,returnType,argTypes,args);["writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getTempRet0","setTempRet0","emscriptenLog","readEmAsmArgs","listenOnce","autoResumeAudioContext","getDynCaller","dynCall","setWasmTableEntry","asmjsMangle","HandleAllocator","getNativeTypeSize","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","uleb128Encode","sigToWasmTypes","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayToString","AsciiToString","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","registerKeyEventCallback","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","polyfillSetImmediate","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","Browser_asyncPrepareDataCounter","arraySum","addDays","FS_unlink","FS_mkdirTree","_setNetworkCallback","emscriptenWebGLGetUniform","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","runAndAbortIfError","emscriptenWebGLGetIndexed","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"].forEach((function(sym){unexportedRuntimeSymbol(sym)}));var calledRun;function callMain(args=[]){assert(0==runDependencies,'cannot call main when async dependencies remain! (listen on Module["onRuntimeInitialized"])'),assert(0==__ATPRERUN__.length,"cannot call main when preRun functions remain to be called");var entryFunction=_main;args.unshift(thisProgram);var argc=args.length,argv=stackAlloc(4*(argc+1)),argv_ptr=argv;args.forEach((arg=>{HEAPU32[argv_ptr>>2]=stringToUTF8OnStack(arg),argv_ptr+=4})),HEAPU32[argv_ptr>>2]=0;try{var ret=entryFunction(argc,argv);return exitJS(ret,!0),ret}catch(e){return handleException(e)}}function stackCheckInit(){var max;_emscripten_stack_init(),assert(!(3&(max=_emscripten_stack_get_end()))),0==max&&(max+=4),HEAPU32[max>>2]=34821223,HEAPU32[max+4>>2]=2310721022,HEAPU32[0]=1668509029}function run(args=arguments_){function doRun(){calledRun||(calledRun=!0,Module.calledRun=!0,ABORT||(assert(!runtimeInitialized),runtimeInitialized=!0,checkStackCookie(),Module.noFSInit||FS.initialized||FS.init(),FS.ignorePermissions=!1,TTY.init(),SOCKFS.root=FS.mount(SOCKFS,{},null),callRuntimeCallbacks(__ATINIT__),checkStackCookie(),callRuntimeCallbacks(__ATMAIN__),readyPromiseResolve(Module),Module.onRuntimeInitialized?.(),shouldRunNow&&callMain(args),function(){if(checkStackCookie(),Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)cb=Module.postRun.shift(),__ATPOSTRUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPOSTRUN__)}()))}runDependencies>0||(stackCheckInit(),function(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)cb=Module.preRun.shift(),__ATPRERUN__.unshift(cb);var cb;callRuntimeCallbacks(__ATPRERUN__)}(),runDependencies>0||(Module.setStatus?(Module.setStatus("Running..."),setTimeout((()=>{setTimeout((()=>Module.setStatus("")),1),doRun()}),1)):doRun(),checkStackCookie()))}if(["run","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","out","err","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","writeI53ToI64","readI53FromI64","readI53FromU64","INT53_MAX","INT53_MIN","bigintToI53Checked","stackSave","stackRestore","stackAlloc","ptrToString","zeroMemory","exitJS","getHeapMax","growMemory","ENV","ERRNO_CODES","strError","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","jstoi_q","jstoi_s","getExecutableName","getWasmTableEntry","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","asyncLoad","alignMemory","mmapAlloc","wasmTable","noExitRuntime","getCFunc","ccall","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","intArrayFromString","stringToAscii","UTF16Decoder","stringToNewUTF8","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","getEnvStrings","doReadv","doWritev","initRandomFill","randomFill","promiseMap","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","isLeapYear","ydayFromDate","SYSCALLS","getSocketFromFD","getSocketAddress","preloadPlugins","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar_buffer","FS_stdin_getChar","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createDataFile","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","GL","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","AL","GLUT","EGL","GLEW","IDBStore","SDL","SDL_gfx","webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance","webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance","allocateUTF8","allocateUTF8OnStack","print","printErr","GodotWebSocket","GodotAudio","GodotAudioWorklet","GodotAudioScript","GodotDisplayVK","GodotDisplayCursor","GodotDisplayScreen","GodotDisplay","GodotFetch","IDHandler","GodotConfig","GodotFS","GodotOS","GodotEventListeners","GodotPWA","GodotRuntime","GodotIME","GodotInputGamepads","GodotInputDragDrop","GodotInput","GodotWebGL2","IDBFS"].forEach(unexportedRuntimeSymbol),dependenciesFulfilled=function runCaller(){calledRun||run(),calledRun||(dependenciesFulfilled=runCaller)},Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!1;Module.noInitialRun&&(shouldRunNow=!1),run(),moduleRtn=readyPromise;for(const prop of Object.keys(Module))prop in moduleArg||Object.defineProperty(moduleArg,prop,{configurable:!0,get(){abort(`Access to module property ('${prop}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return moduleRtn}})();"object"==typeof exports&&"object"==typeof module?module.exports=Godot:"function"==typeof define&&define.amd&&define([],(()=>Godot));

const Features = {
  /**
   * Check whether WebGL is available. Optionally, specify a particular version of WebGL to check for.
   *
   * @param {number=} [majorVersion=1] The major WebGL version to check for.
   * @returns {boolean} If the given major version of WebGL is available.
   * @function Engine.isWebGLAvailable
   */
  isWebGLAvailable: function (majorVersion = 1) {
    return true;
  },

  /**
   * Check whether the Fetch API available and supports streaming responses.
   *
   * @returns {boolean} If the Fetch API is available and supports streaming responses.
   * @function Engine.isFetchAvailable
   */
  isFetchAvailable: function () {
    return (
      "fetch" in window &&
      "Response" in window &&
      "body" in window.Response.prototype
    );
  },

  /**
   * Check whether the engine is running in a Secure Context.
   *
   * @returns {boolean} If the engine is running in a Secure Context.
   * @function Engine.isSecureContext
   */
  isSecureContext: function () {
    return window["isSecureContext"] === true;
  },

  /**
   * Check whether the engine is cross origin isolated.
   * This value is dependent on Cross-Origin-Opener-Policy and Cross-Origin-Embedder-Policy headers sent by the server.
   *
   * @returns {boolean} If the engine is running in a Secure Context.
   * @function Engine.isSecureContext
   */
  isCrossOriginIsolated: function () {
    return window["crossOriginIsolated"] === true;
  },

  /**
   * Check whether SharedBufferArray is available.
   *
   * Most browsers require the page to be running in a secure context, and the
   * the server to provide specific CORS headers for SharedArrayBuffer to be available.
   *
   * @returns {boolean} If SharedArrayBuffer is available.
   * @function Engine.isSharedArrayBufferAvailable
   */
  isSharedArrayBufferAvailable: function () {
    return "SharedArrayBuffer" in window;
  },

  /**
   * Check whether the AudioContext supports AudioWorkletNodes.
   *
   * @returns {boolean} If AudioWorkletNode is available.
   * @function Engine.isAudioWorkletAvailable
   */
  isAudioWorkletAvailable: function () {
    return true;
    return "AudioContext" in window && "audioWorklet" in AudioContext.prototype;
  },

  /**
   * Return an array of missing required features (as string).
   *
   * @returns {Array<string>} A list of human-readable missing features.
   * @function Engine.getMissingFeatures
   * @param {{threads: (boolean|undefined)}} supportedFeatures
   */
  getMissingFeatures: function (supportedFeatures = {}) {
    const {
      // Quotes are needed for the Closure compiler.
      threads: supportsThreads = true,
    } = supportedFeatures;

    const missing = [];
    if (!Features.isWebGLAvailable(2)) {
      missing.push(
        "WebGL2 - Check web browser configuration and hardware support"
      );
    }
    if (!Features.isFetchAvailable()) {
      missing.push("Fetch - Check web browser version");
    }
    if (!Features.isSecureContext()) {
      missing.push(
        "Secure Context - Check web server configuration (use HTTPS)"
      );
    }

    if (supportsThreads) {
      if (!Features.isCrossOriginIsolated()) {
        missing.push(
          "Cross-Origin Isolation - Check that the web server configuration sends the correct headers."
        );
      }
      if (!Features.isSharedArrayBufferAvailable()) {
        missing.push(
          "SharedArrayBuffer - Check that the web server configuration sends the correct headers."
        );
      }
    }

    // Audio is normally optional since we have a dummy fallback.
    return missing;
  },
};

const Preloader = /** @constructor */ function () {
  // eslint-disable-line no-unused-vars
  function getTrackedResponse(response, load_status) {
    function onloadprogress(reader, controller) {
      return reader.read().then(function (result) {
        if (load_status.done) {
          return Promise.resolve();
        }
        if (result.value) {
          controller.enqueue(result.value);
          load_status.loaded += result.value.length;
        }
        if (!result.done) {
          return onloadprogress(reader, controller);
        }
        load_status.done = true;
        return Promise.resolve();
      });
    }
    const reader = response.body.getReader();
    return new Response(
      new ReadableStream({
        start: function (controller) {
          onloadprogress(reader, controller).then(function () {
            controller.close();
          });
        },
      }),
      {
        headers: response.headers,
      }
    );
  }

  function loadFetch(file, tracker, fileSize, raw) {
    tracker[file] = {
      total: fileSize || 0,
      loaded: 0,
      done: false,
    };
    return new Promise((resolve, reject) => {
      const fs = wx.getFileSystemManager();
      fs.readFile({
        filePath: file,
        success: (res) => resolve(res.data),
        fail: (reason) => {
          reject(reason.errMsg);
        },
      });
    });
  }

  function retry(func, attempts = 1) {
    function onerror(err) {
      if (attempts <= 1) {
        return Promise.reject(err);
      }
      return new Promise(function (resolve, reject) {
        setTimeout(function () {
          retry(func, attempts - 1)
            .then(resolve)
            .catch(reject);
        }, 1000);
      });
    }
    return func().catch(onerror);
  }

  const DOWNLOAD_ATTEMPTS_MAX = 4;
  const loadingFiles = {};
  const lastProgress = {
    loaded: 0,
    total: 0,
  };
  let progressFunc = null;

  const animateProgress = function () {
    let loaded = 0;
    let total = 0;
    let totalIsValid = true;
    let progressIsFinal = true;

    Object.keys(loadingFiles).forEach(function (file) {
      const stat = loadingFiles[file];
      if (!stat.done) {
        progressIsFinal = false;
      }
      if (!totalIsValid || stat.total === 0) {
        totalIsValid = false;
        total = 0;
      } else {
        total += stat.total;
      }
      loaded += stat.loaded;
    });
    if (loaded !== lastProgress.loaded || total !== lastProgress.total) {
      lastProgress.loaded = loaded;
      lastProgress.total = total;
      if (typeof progressFunc === "function") {
        progressFunc(loaded, total);
      }
    }
    if (!progressIsFinal) {
      requestAnimationFrame(animateProgress);
    }
  };

  this.animateProgress = animateProgress;

  this.setProgressFunc = function (callback) {
    progressFunc = callback;
  };

  this.loadPromise = function (file, fileSize, raw = false) {
    return retry(
      loadFetch.bind(null, file, loadingFiles, fileSize, raw),
      DOWNLOAD_ATTEMPTS_MAX
    );
  };

  this.preloadedFiles = [];
  this.preload = function (pathOrBuffer, destPath, fileSize) {
    let buffer = null;
    if (typeof pathOrBuffer === "string") {
      const me = this;
      return this.loadPromise(pathOrBuffer, fileSize).then(function (buf) {
        me.preloadedFiles.push({
          path: destPath || pathOrBuffer,
          buffer: buf,
        });
        return Promise.resolve();
      });
    } else if (pathOrBuffer instanceof ArrayBuffer) {
      buffer = new Uint8Array(pathOrBuffer);
    } else if (ArrayBuffer.isView(pathOrBuffer)) {
      buffer = new Uint8Array(pathOrBuffer.buffer);
    }
    if (buffer) {
      this.preloadedFiles.push({
        path: destPath,
        buffer: pathOrBuffer,
      });
      return Promise.resolve();
    }
    return Promise.reject(new Error("Invalid object for preloading"));
  };
};

/**
 * An object used to configure the Engine instance based on godot export options, and to override those in custom HTML
 * templates if needed.
 *
 * @header Engine configuration
 * @summary The Engine configuration object. This is just a typedef, create it like a regular object, e.g.:
 *
 * ``const MyConfig = { executable: 'godot', unloadAfterInit: false }``
 *
 * @typedef {Object} EngineConfig
 */
const EngineConfig = {}; // eslint-disable-line no-unused-vars

/**
 * @struct
 * @constructor
 * @ignore
 */
const InternalConfig = function (initConfig) {
  // eslint-disable-line no-unused-vars
  const cfg = /** @lends {InternalConfig.prototype} */ {
    /**
     * Whether to unload the engine automatically after the instance is initialized.
     *
     * @memberof EngineConfig
     * @default
     * @type {boolean}
     */
    unloadAfterInit: true,
    /**
     * The HTML DOM Canvas object to use.
     *
     * By default, the first canvas element in the document will be used is none is specified.
     *
     * @memberof EngineConfig
     * @default
     * @type {?HTMLCanvasElement}
     */
    canvas: null,
    /**
     * The name of the WASM file without the extension. (Set by Godot Editor export process).
     *
     * @memberof EngineConfig
     * @default
     * @type {string}
     */
    executable: "",
    /**
     * An alternative name for the game pck to load. The executable name is used otherwise.
     *
     * @memberof EngineConfig
     * @default
     * @type {?string}
     */
    mainPack: null,
    /**
     * Specify a language code to select the proper localization for the game.
     *
     * The browser locale will be used if none is specified. See complete list of
     * :ref:`supported locales <doc_locales>`.
     *
     * @memberof EngineConfig
     * @type {?string}
     * @default
     */
    locale: null,
    /**
     * The canvas resize policy determines how the canvas should be resized by Godot.
     *
     * ``0`` means Godot won't do any resizing. This is useful if you want to control the canvas size from
     * javascript code in your template.
     *
     * ``1`` means Godot will resize the canvas on start, and when changing window size via engine functions.
     *
     * ``2`` means Godot will adapt the canvas size to match the whole browser window.
     *
     * @memberof EngineConfig
     * @type {number}
     * @default
     */
    canvasResizePolicy: 0,
    /**
     * The arguments to be passed as command line arguments on startup.
     *
     * See :ref:`command line tutorial <doc_command_line_tutorial>`.
     *
     * **Note**: :js:meth:`startGame <Engine.prototype.startGame>` will always add the ``--main-pack`` argument.
     *
     * @memberof EngineConfig
     * @type {Array<string>}
     * @default
     */
    args: [],
    /**
     * When enabled, the game canvas will automatically grab the focus when the engine starts.
     *
     * @memberof EngineConfig
     * @type {boolean}
     * @default
     */
    focusCanvas: true,
    /**
     * When enabled, this will turn on experimental virtual keyboard support on mobile.
     *
     * @memberof EngineConfig
     * @type {boolean}
     * @default
     */
    experimentalVK: false,
    /**
     * The progressive web app service worker to install.
     * @memberof EngineConfig
     * @default
     * @type {string}
     */
    serviceWorker: "",
    /**
     * @ignore
     * @type {Array.<string>}
     */
    persistentPaths: ["/userfs"],
    /**
     * @ignore
     * @type {boolean}
     */
    persistentDrops: false,
    /**
     * @ignore
     * @type {Array.<string>}
     */
    gdextensionLibs: [],
    /**
     * @ignore
     * @type {Array.<string>}
     */
    fileSizes: [],
    /**
     * A callback function for handling Godot's ``OS.execute`` calls.
     *
     * This is for example used in the Web Editor template to switch between project manager and editor, and for running the game.
     *
     * @callback EngineConfig.onExecute
     * @param {string} path The path that Godot's wants executed.
     * @param {Array.<string>} args The arguments of the "command" to execute.
     */
    /**
     * @ignore
     * @type {?function(string, Array.<string>)}
     */
    onExecute: null,
    /**
     * A callback function for being notified when the Godot instance quits.
     *
     * **Note**: This function will not be called if the engine crashes or become unresponsive.
     *
     * @callback EngineConfig.onExit
     * @param {number} status_code The status code returned by Godot on exit.
     */
    /**
     * @ignore
     * @type {?function(number)}
     */
    onExit: null,
    /**
     * A callback function for displaying download progress.
     *
     * The function is called once per frame while downloading files, so the usage of ``requestAnimationFrame()``
     * is not necessary.
     *
     * If the callback function receives a total amount of bytes as 0, this means that it is impossible to calculate.
     * Possible reasons include:
     *
     * -  Files are delivered with server-side chunked compression
     * -  Files are delivered with server-side compression on Chromium
     * -  Not all file downloads have started yet (usually on servers without multi-threading)
     *
     * @callback EngineConfig.onProgress
     * @param {number} current The current amount of downloaded bytes so far.
     * @param {number} total The total amount of bytes to be downloaded.
     */
    /**
     * @ignore
     * @type {?function(number, number)}
     */
    onProgress: null,
    /**
     * A callback function for handling the standard output stream. This method should usually only be used in debug pages.
     *
     * By default, ``console.log()`` is used.
     *
     * @callback EngineConfig.onPrint
     * @param {...*} [var_args] A variadic number of arguments to be printed.
     */
    /**
     * @ignore
     * @type {?function(...*)}
     */
    onPrint: function () {
      console.log.apply(console, Array.from(arguments)); // eslint-disable-line no-console
    },
    /**
     * A callback function for handling the standard error stream. This method should usually only be used in debug pages.
     *
     * By default, ``console.error()`` is used.
     *
     * @callback EngineConfig.onPrintError
     * @param {...*} [var_args] A variadic number of arguments to be printed as errors.
     */
    /**
     * @ignore
     * @type {?function(...*)}
     */
    onPrintError: function (var_args) {
      console.error.apply(console, Array.from(arguments)); // eslint-disable-line no-console
    },
  };

  /**
   * @ignore
   * @struct
   * @constructor
   * @param {EngineConfig} opts
   */
  function Config(opts) {
    this.update(opts);
  }

  Config.prototype = cfg;

  /**
   * @ignore
   * @param {EngineConfig} opts
   */
  Config.prototype.update = function (opts) {
    const config = opts || {};
    // NOTE: We must explicitly pass the default, accessing it via
    // the key will fail due to closure compiler renames.
    function parse(key, def) {
      if (typeof config[key] === "undefined") {
        return def;
      }
      return config[key];
    }
    // Module config
    this.unloadAfterInit = parse("unloadAfterInit", this.unloadAfterInit);
    this.onPrintError = parse("onPrintError", this.onPrintError);
    this.onPrint = parse("onPrint", this.onPrint);
    this.onProgress = parse("onProgress", this.onProgress);

    // Godot config
    this.canvas = parse("canvas", this.canvas);
    this.executable = parse("executable", this.executable);
    this.mainPack = parse("mainPack", this.mainPack);
    this.locale = parse("locale", this.locale);
    this.canvasResizePolicy = parse(
      "canvasResizePolicy",
      this.canvasResizePolicy
    );
    this.persistentPaths = parse("persistentPaths", this.persistentPaths);
    this.persistentDrops = parse("persistentDrops", this.persistentDrops);
    this.experimentalVK = parse("experimentalVK", this.experimentalVK);
    this.focusCanvas = parse("focusCanvas", this.focusCanvas);
    this.serviceWorker = parse("serviceWorker", this.serviceWorker);
    this.gdextensionLibs = parse("gdextensionLibs", this.gdextensionLibs);
    this.fileSizes = parse("fileSizes", this.fileSizes);
    this.args = parse("args", this.args);
    this.onExecute = parse("onExecute", this.onExecute);
    this.onExit = parse("onExit", this.onExit);
  };

  /**
   * @ignore
   * @param {string} loadPath
   * @param {Response} response
   */
  Config.prototype.getModuleConfig = function (loadPath, response) {
    let r = response;
    const gdext = this.gdextensionLibs;
    return {
      print: this.onPrint,
      printErr: this.onPrintError,
      thisProgram: this.executable,
      noExitRuntime: false,
      dynamicLibraries: [`${loadPath}.side.wasm`].concat(this.gdextensionLibs),
      instantiateWasm: function (imports, onSuccess) {
        function done(result) {
          onSuccess(result["instance"], result["module"]);
        }
        if (typeof WebAssembly.instantiateStreaming !== "undefined") {
          WebAssembly.instantiateStreaming(Promise.resolve(r), imports).then(
            done
          );
        } else {
          WebAssembly.instantiate(loadPath + ".wasm.br", imports).then(done);
        }
        r = null;
        return {};
      },
      locateFile: function (path) {
        if (!path.startsWith("godot.")) {
          return path;
        } else if (path.endsWith(".worker.js")) {
          return `${loadPath}.worker.js`;
        } else if (path.endsWith(".audio.worklet.js")) {
          return `${loadPath}.audio.worklet.js`;
        } else if (path.endsWith(".js")) {
          return `${loadPath}.js`;
        } else if (path in gdext) {
          return path;
        } else if (path.endsWith(".side.wasm")) {
          return `${loadPath}.side.wasm`;
        } else if (path.endsWith(".wasm")) {
          return `${loadPath}.wasm`;
        }
        return path;
      },
    };
  };

  /**
   * @ignore
   * @param {function()} cleanup
   */
  Config.prototype.getGodotConfig = function (cleanup) {
    // Canvas can grab focus on click, or key events won't work.
    if (this.canvas.tabIndex < 0) {
      this.canvas.tabIndex = 0;
    }

    // Browser locale, or custom one if defined.
    let locale = this.locale;
    if (!locale) {
      locale = navigator.languages
        ? navigator.languages[0]
        : navigator.language;
      locale = locale.split(".")[0];
    }
    locale = locale.replace("-", "_");
    const onExit = this.onExit;

    // Godot configuration.
    return {
      canvas: this.canvas,
      canvasResizePolicy: this.canvasResizePolicy,
      locale: locale,
      persistentDrops: this.persistentDrops,
      virtualKeyboard: this.experimentalVK,
      focusCanvas: this.focusCanvas,
      onExecute: this.onExecute,
      onExit: function (p_code) {
        cleanup(); // We always need to call the cleanup callback to free memory.
        if (typeof onExit === "function") {
          onExit(p_code);
        }
      },
    };
  };
  return new Config(initConfig);
};

/**
 * Projects exported for the Web expose the :js:class:`Engine` class to the JavaScript environment, that allows
 * fine control over the engine's start-up process.
 *
 * This API is built in an asynchronous manner and requires basic understanding
 * of `Promises <https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises>`__.
 *
 * @module Engine
 * @header Web export JavaScript reference
 */
const Engine = (function () {
  const preloader = new Preloader();

  let loadPromise = null;
  let loadPath = "";
  let initPromise = null;

  /**
   * @classdesc The ``Engine`` class provides methods for loading and starting exported projects on the Web. For default export
   * settings, this is already part of the exported HTML page. To understand practical use of the ``Engine`` class,
   * see :ref:`Custom HTML page for Web export <doc_customizing_html5_shell>`.
   *
   * @description Create a new Engine instance with the given configuration.
   *
   * @global
   * @constructor
   * @param {EngineConfig} initConfig The initial config for this instance.
   */
  function Engine(initConfig) {
    // eslint-disable-line no-shadow
    this.config = new InternalConfig(initConfig);
    this.rtenv = null;
  }

  /**
   * Load the engine from the specified base path.
   *
   * @param {string} basePath Base path of the engine to load.
   * @param {number=} [size=0] The file size if known.
   * @returns {Promise} A Promise that resolves once the engine is loaded.
   *
   * @function Engine.load
   */
  Engine.load = function (basePath, size) {
    if (loadPromise == null) {
      loadPath = basePath;
      loadPromise = preloader.loadPromise(`${loadPath}.wasm.br`, size, true);
      requestAnimationFrame(preloader.animateProgress);
    }
    return loadPromise;
  };

  /**
   * Unload the engine to free memory.
   *
   * This method will be called automatically depending on the configuration. See :js:attr:`unloadAfterInit`.
   *
   * @function Engine.unload
   */
  Engine.unload = function () {
    loadPromise = null;
  };

  /**
   * Safe Engine constructor, creates a new prototype for every new instance to avoid prototype pollution.
   * @ignore
   * @constructor
   */
  function SafeEngine(initConfig) {
    const proto = /** @lends Engine.prototype */ {
      /**
       * Initialize the engine instance. Optionally, pass the base path to the engine to load it,
       * if it hasn't been loaded yet. See :js:meth:`Engine.load`.
       *
       * @param {string=} basePath Base path of the engine to load.
       * @return {Promise} A ``Promise`` that resolves once the engine is loaded and initialized.
       */
      init: function (basePath) {
        if (initPromise) {
          return initPromise;
        }
        if (loadPromise == null) {
          if (!basePath) {
            initPromise = Promise.reject(
              new Error(
                "A base path must be provided when calling `init` and the engine is not loaded."
              )
            );
            return initPromise;
          }
          Engine.load(basePath, this.config.fileSizes[`${basePath}.wasm`]);
        }
        const me = this;

        function doInit(promise) {
          // Care! Promise chaining is bogus with old emscripten versions.
          // This caused a regression with the Mono build (which uses an older emscripten version).
          // Make sure to test that when refactoring.
          return new Promise(function (resolve, reject) {
            promise.then(function (response) {
              const cloned = response;
              Godot(me.config.getModuleConfig(loadPath, cloned)).then(function (
                module
              ) {
                me.rtenv = module;
                resolve();
              });
            });
          });
        }
        preloader.setProgressFunc(this.config.onProgress);
        initPromise = doInit(loadPromise);
        return initPromise;
      },

      /**
       * Load a file so it is available in the instance's file system once it runs. Must be called **before** starting the
       * instance.
       *
       * If not provided, the ``path`` is derived from the URL of the loaded file.
       *
       * @param {string|ArrayBuffer} file The file to preload.
       *
       * If a ``string`` the file will be loaded from that path.
       *
       * If an ``ArrayBuffer`` or a view on one, the buffer will used as the content of the file.
       *
       * @param {string=} path Path by which the file will be accessible. Required, if ``file`` is not a string.
       *
       * @returns {Promise} A Promise that resolves once the file is loaded.
       */
      preloadFile: function (file, path) {
        return preloader.preload(file, path, this.config.fileSizes[file]);
      },

      /**
       * Start the engine instance using the given override configuration (if any).
       * :js:meth:`startGame <Engine.prototype.startGame>` can be used in typical cases instead.
       *
       * This will initialize the instance if it is not initialized. For manual initialization, see :js:meth:`init <Engine.prototype.init>`.
       * The engine must be loaded beforehand.
       *
       * Fails if a canvas cannot be found on the page, or not specified in the configuration.
       *
       * @param {EngineConfig} override An optional configuration override.
       * @return {Promise} Promise that resolves once the engine started.
       */
      start: function (override) {
        this.config.update(override);
        const me = this;
        return me.init().then(function () {
          if (!me.rtenv) {
            return Promise.reject(
              new Error(
                "The engine must be initialized before it can be started"
              )
            );
          }

          let config = {};
          try {
            config = me.config.getGodotConfig(function () {
              me.rtenv = null;
            });
          } catch (e) {
            return Promise.reject(e);
          }
          // Godot configuration.
          me.rtenv["initConfig"](config);

          // Preload GDExtension libraries.
          if (
            me.config.gdextensionLibs.length > 0 &&
            !me.rtenv["loadDynamicLibrary"]
          ) {
            return Promise.reject(
              new Error(
                "GDExtension libraries are not supported by this engine version. " +
                  'Enable "Extensions Support" for your export preset and/or build your custom template with "dlink_enabled=yes".'
              )
            );
          }
          return new Promise(function (resolve, reject) {
            for (const file of preloader.preloadedFiles) {
              me.rtenv["copyToFS"](file.path, file.buffer);
            }
            preloader.preloadedFiles.length = 0; // Clear memory
            me.rtenv["callMain"](me.config.args);
            initPromise = null;
            me.installServiceWorker();
            resolve();
          });
        });
      },

      /**
       * Start the game instance using the given configuration override (if any).
       *
       * This will initialize the instance if it is not initialized. For manual initialization, see :js:meth:`init <Engine.prototype.init>`.
       *
       * This will load the engine if it is not loaded, and preload the main pck.
       *
       * This method expects the initial config (or the override) to have both the :js:attr:`executable` and :js:attr:`mainPack`
       * properties set (normally done by the editor during export).
       *
       * @param {EngineConfig} override An optional configuration override.
       * @return {Promise} Promise that resolves once the game started.
       */
      startGame: function (override) {
        this.config.update(override);
        // Add main-pack argument.
        const exe = this.config.executable;
        const pack = this.config.mainPack || `${exe}.pck`;
        this.config.args = ["--main-pack", pack].concat(this.config.args);
        // Start and init with execName as loadPath if not inited.
        const me = this;
        return Promise.all([this.init(exe), this.preloadFile(pack, pack)]).then(
          function () {
            return me.start.apply(me);
          }
        );
      },

      /**
       * Create a file at the specified ``path`` with the passed as ``buffer`` in the instance's file system.
       *
       * @param {string} path The location where the file will be created.
       * @param {ArrayBuffer} buffer The content of the file.
       */
      copyToFS: function (path, buffer) {
        if (this.rtenv == null) {
          throw new Error("Engine must be inited before copying files");
        }
        this.rtenv["copyToFS"](path, buffer);
      },

      /**
       * Request that the current instance quit.
       *
       * This is akin the user pressing the close button in the window manager, and will
       * have no effect if the engine has crashed, or is stuck in a loop.
       *
       */
      requestQuit: function () {
        if (this.rtenv) {
          this.rtenv["request_quit"]();
        }
      },

      /**
       * Install the progressive-web app service worker.
       * @returns {Promise} The service worker registration promise.
       */
      installServiceWorker: function () {
        if (this.config.serviceWorker && "serviceWorker" in navigator) {
          return navigator.serviceWorker.register(this.config.serviceWorker);
        }
        return Promise.resolve();
      },
    };

    Engine.prototype = proto;
    // Closure compiler exported instance methods.
    Engine.prototype["init"] = Engine.prototype.init;
    Engine.prototype["preloadFile"] = Engine.prototype.preloadFile;
    Engine.prototype["start"] = Engine.prototype.start;
    Engine.prototype["startGame"] = Engine.prototype.startGame;
    Engine.prototype["copyToFS"] = Engine.prototype.copyToFS;
    Engine.prototype["requestQuit"] = Engine.prototype.requestQuit;
    Engine.prototype["installServiceWorker"] =
      Engine.prototype.installServiceWorker;
    // Also expose static methods as instance methods
    Engine.prototype["load"] = Engine.load;
    Engine.prototype["unload"] = Engine.unload;
    return new Engine(initConfig);
  }

  // Closure compiler exported static methods.
  SafeEngine["load"] = Engine.load;
  SafeEngine["unload"] = Engine.unload;

  // Feature-detection utilities.
  SafeEngine["isWebGLAvailable"] = Features.isWebGLAvailable;
  SafeEngine["isFetchAvailable"] = Features.isFetchAvailable;
  SafeEngine["isSecureContext"] = Features.isSecureContext;
  SafeEngine["isCrossOriginIsolated"] = Features.isCrossOriginIsolated;
  SafeEngine["isSharedArrayBufferAvailable"] =
    Features.isSharedArrayBufferAvailable;
  SafeEngine["isAudioWorkletAvailable"] = Features.isAudioWorkletAvailable;
  SafeEngine["getMissingFeatures"] = Features.getMissingFeatures;

  return SafeEngine;
})();

GameGlobal.Engine = Engine;
